<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Unidad 4 Cadenas de Markov de Tiempo Contínuo | Simulación de Procesos y Sistemas</title>
<meta name="description" content="En esta unidad, consideramos un sistema estocástico que se observa continuamente a lo largo del tiempo, siendo \(X_t\) el estado en el momento \(t\), con \(t \geq 0\). Siguiendo la definición de...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Unidad 4 Cadenas de Markov de Tiempo Contínuo | Simulación de Procesos y Sistemas">
<meta property="og:type" content="book">
<meta property="og:description" content="En esta unidad, consideramos un sistema estocástico que se observa continuamente a lo largo del tiempo, siendo \(X_t\) el estado en el momento \(t\), con \(t \geq 0\). Siguiendo la definición de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unidad 4 Cadenas de Markov de Tiempo Contínuo | Simulación de Procesos y Sistemas">
<meta name="twitter:description" content="En esta unidad, consideramos un sistema estocástico que se observa continuamente a lo largo del tiempo, siendo \(X_t\) el estado en el momento \(t\), con \(t \geq 0\). Siguiendo la definición de...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Simulación de Procesos y Sistemas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Antes de comenzar</a></li>
<li><a class="" href="software.html">Software</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Conceptos básicos</a></li>
<li><a class="" href="cmtd.html"><span class="header-section-number">2</span> Cadenas de Markov de Tiempo Discreto</a></li>
<li><a class="" href="poissonprocess.html"><span class="header-section-number">3</span> Proceso de Poisson</a></li>
<li><a class="active" href="CMTC.html"><span class="header-section-number">4</span> Cadenas de Markov de Tiempo Contínuo</a></li>
<li><a class="" href="COLAS.html"><span class="header-section-number">5</span> Sistemas de colas</a></li>
<li><a class="" href="SIMSIST.html"><span class="header-section-number">6</span> Aplicaciones prácticas</a></li>
<li><a class="" href="simmerunidad.html"><span class="header-section-number">7</span> Simulación DES con simmer</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="CMTC" class="section level1" number="4">
<h1>
<span class="header-section-number">Unidad 4</span> Cadenas de Markov de Tiempo Contínuo<a class="anchor" aria-label="anchor" href="#CMTC"><i class="fas fa-link"></i></a>
</h1>
<p>En esta unidad, consideramos un sistema estocástico que se observa continuamente a lo largo del tiempo, siendo <span class="math inline">\(X_t\)</span> el estado en el momento <span class="math inline">\(t\)</span>, con <span class="math inline">\(t \geq 0\)</span>. Siguiendo la definición de las CMTD, a continuación definimos las cadenas de Markov de tiempo continuo (CMTC).</p>
<div class="yellowbox">
<div class="definition">
<p><span id="def:cmtc001" class="definition"><strong>Definición 4.1  </strong></span>Un proceso estocástico <span class="math inline">\(\{X_t; t \geq 0\}\)</span> con espacio de estados <span class="math inline">\(S\)</span> es una cadena de Markov de tiempo continuo, CMTC, si para todo <span class="math inline">\(i\)</span> y <span class="math inline">\(j\)</span> en <span class="math inline">\(S\)</span>, y <span class="math inline">\(t, s \geq 0\)</span>, cumple la propiedad de Markov:</p>
<p><span class="math display">\[P(X_{s+t} = j \mid X_s = i, X_u, 0 \leq u \leq s) = P(X_{s+t} = j \mid X_s = i).\]</span></p>
</div>
</div>
<p>La CMTC <span class="math inline">\(\{X_t; t \geq 0\}\)</span> se denomina homogénea si el cambio entre dos instantes cualesquiera depende exclusivamente del tiempo transcurrido, esto es para cualquier <span class="math inline">\(t, s \geq 0\)</span>,</p>
<p><span class="math display">\[P(X_{s+t} = j \mid X_s = i) = P(X_t = j \mid X_0 = i).\]</span></p>
<p>En toda esta unidad asumimos que las CMTC con las que trabajamos son homogéneas y tienen espacio de estados finito <span class="math inline">\(S=\{1, 2,,...,N\}\)</span> de forma que podemos definir la probabilidad de pasar del estado <span class="math inline">\(i\)</span> al estado <span class="math inline">\(j\)</span> en un periodo de amplitud <span class="math inline">\(t, (0,t],\)</span> como:</p>
<p><span class="math display">\[p_{ij}(t) = P(X_t = j \mid X_0 = i), \quad 1 \leq i, j \leq N.\]</span></p>
<p>La matriz de probabilidad de transición <span class="math inline">\(P(t)\)</span> de una CMTC <span class="math inline">\(\{X_t; t \geq 0\}\)</span> viene dada por las distribuciones de probabilidad condicionadas (por filas) de pasar de un estado <span class="math inline">\(i\)</span> a un estado <span class="math inline">\(j\)</span> en un periodo de tiempo de amplitud <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[P(t) = 
\begin{pmatrix}
p_{11}(t) &amp; p_{12}(t) &amp; ... &amp; p_{1N}(t)\\
p_{21}(t) &amp; p_{22}(t) &amp; ... &amp; p_{2N}(t)\\
... &amp; ... &amp; ... &amp; ...\\
p_{N1}(t) &amp; p_{N2}(t) &amp; ... &amp; p_{NN}(t)
\end{pmatrix}\]</span></p>
<p>Dicha matriz de transición verifica que:</p>
<ul>
<li>Todos sus elementos son probabilidades condicionadas <span class="math inline">\(\{p_{ij}(t); j \in S\}\)</span>
</li>
</ul>
<p><span class="math display">\[1 \geq p_{ij}(t) \geq 0, \quad  1 \leq i, j \leq N; t \geq 0\]</span></p>
<ul>
<li>La suma de las probabilidades en cada fila, esto es, de acceder a cualquiera de los estados a partir de un estado <span class="math inline">\(i\)</span> es igual a 1.</li>
</ul>
<p><span class="math display">\[\sum_{j=1}^N p_{ij}(t) = 1, \quad  1 \leq i, j \leq N; t \geq 0\]</span></p>
<ul>
<li>Ecuaciones de Chapman-Kolmogorov</li>
</ul>
<p><span class="math display">\[p_{ij}(s+t) =  \sum_{k=1}^N p_{ik}(s)p_{kj}(t) =  \sum_{k=1}^N p_{ik}(t)p_{kj}(s)   , \quad  1 \leq i, j \leq N; t \geq 0\]</span></p>
<p>La dificultad principal con <span class="math inline">\(P(t)\)</span> es que resulta díficil de obtener de forma inmediata para la mayoría de las CMTC, al contrario de lo que ocurría con las CMTD. Necesitamos un método simple que nos permita describir de forma rápida el comportamiento del proceso. A continuación, sentamos las bases para el estudio de las CMTC a partir de los tiempos de permanencia en cada uno de los estados del proceso. Dado que la única distribución que verifica la propiedad de pérdida de memoria es la exponencial, la utilizaremos como base para la construcción de una CMTC.</p>
<div id="CMTCA" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Evolución del proceso<a class="anchor" aria-label="anchor" href="#CMTCA"><i class="fas fa-link"></i></a>
</h2>
<p>Sea <span class="math inline">\(X_t\)</span> el estado de un sistema en el instante temporal <span class="math inline">\(t\)</span>. Supongamos que el espacio de estados del proceso estocástico <span class="math inline">\(\{X_t; t \geq 0\}\)</span> es <span class="math inline">\(S=\{1, 2,...,N\}\)</span>. La evolución aleatoria del sistema se produce de la siguiente manera:</p>
<ul>
<li><p>Supongamos que el sistema comienza en el estado <span class="math inline">\(i\)</span> y permanece allí durante un tiempo <span class="math inline">\(Exp(r_i)\)</span> que denominamos <strong>tiempo de permanencia</strong> en el estado <span class="math inline">\(i\)</span>, con <span class="math inline">\(r_i\)</span> la <strong>tasa media de permanencia</strong>; recordemos que en la distribución exponencial las tasas medias son el recíproco de los tiempos medios.</p></li>
<li><p>Al final del tiempo de permanencia en el estado <span class="math inline">\(i\)</span>, el sistema realiza una transición repentina al estado <span class="math inline">\(j\)</span> con probabilidad <span class="math inline">\(p_{ij}\)</span>, independientemente del tiempo que el sistema haya permanecido en el estado <span class="math inline">\(i\)</span>. Una vez en el estado <span class="math inline">\(j\)</span>, permanece allí durante un tiempo <span class="math inline">\(Exp(r_j)\)</span>.</p></li>
<li><p>A continuación pasa a un nuevo estado <span class="math inline">\(k\)</span> con una probabilidad <span class="math inline">\(p_{jk}\)</span>, independientemente de la historia del sistema hasta el momento, y repite este comportamiento hasta que finaliza el tiempo de observación del proceso.</p></li>
</ul>
<p>Conviene hacer tres observaciones con respecto al funcionamiento del sistema:</p>
<ul>
<li>En primer lugar, las probabilidades de salto <span class="math inline">\(p_{ij}\)</span> no deben deben confundirse con las probabilidades de transición <span class="math inline">\(p_{ij}(t)\)</span>. En este caso, <span class="math inline">\(p_{ij}\)</span> actúa como la probabilidad de que el sistema pase al estado <span class="math inline">\(j\)</span> cuando sale del estado <span class="math inline">\(i\)</span>.</li>
<li>En segundo lugar, <span class="math inline">\(p_{ii} = 0\)</span>, dado que, por definición, el tiempo de permanencia en el estado <span class="math inline">\(i\)</span> es el tiempo que el sistema pasa en el estado <span class="math inline">\(i\)</span> hasta que sale de él; por lo tanto, no es posible una transición de <span class="math inline">\(i\)</span> a <span class="math inline">\(i\)</span>.</li>
<li>En tercer lugar, en caso de que el estado <span class="math inline">\(i\)</span> sea absorbente, es decir que el sistema permanezca en ese estado para siempre una vez que llegue a él, fijamos <span class="math inline">\(r_i = 0\)</span>.</li>
</ul>
<p>Con estas premisas podremos obtener la <strong>matriz de probabilidades de salto</strong>, <span class="math inline">\(P\)</span>, que denotaremos como:</p>
<p><span class="math display">\[P = 
\begin{pmatrix}
p_{11} &amp; p_{12} &amp; ... &amp; p_{1N}\\
p_{21} &amp; p_{22} &amp; ... &amp; p_{2N}\\
... &amp; ... &amp; ... &amp; ...\\
p_{N1} &amp; p_{N2} &amp; ... &amp; p_{NN}
\end{pmatrix}\]</span></p>
<div class="theorem">
<p><span id="thm:thecmtc001" class="theorem"><strong>Teorema 4.1  </strong></span>El proceso estocástico <span class="math inline">\(\{X_t; t \geq 0\}\)</span> con parámetros <span class="math inline">\(r_i\)</span>, <span class="math inline">\(1 \leq i \leq N\)</span>, y probabilidades <span class="math inline">\(p_{ij}\)</span>, <span class="math inline">\(1 \leq i,j \leq N\)</span> descrito anteriormente es una CMTC.</p>
</div>
<p>A continuación presentamos un par de ejemplos.</p>
<div class="example">
<p><span id="exm:excmtc001" class="example"><strong>Ejemplo 4.1  </strong></span><strong>Sistema de vida útil de un satélite</strong>. Supongamos que la vida útil <span class="math inline">\(T\)</span> de un satélite de gran altitud es una variable aleatoria exponencial de tasa <span class="math inline">\(\mu\)</span> en meses, <span class="math inline">\(Exp(\mu)\)</span>, de forma que una vez que falla sigue fallando para siempre, ya que no es posible repararlo. Consideramos el proceso <span class="math inline">\(X_t = 1\)</span> si el satélite está operativo en el momento <span class="math inline">\(t\)</span>, y 0 en caso contrario. En esta situación <span class="math inline">\(r_0 = 0\)</span> (porque si se estropea, se queda estropeado) y <span class="math inline">\(r_1 = \mu\)</span> (que es el tiempo esperado de vida), pero desconocemos los valores de <span class="math inline">\(P\)</span>, aunque podremos obtener la matriz de transición calculando las probabilidades <span class="math inline">\(p_{00}(t)\)</span> y <span class="math inline">\(p_{11}(t)\)</span> que vienen dadas por:</p>
<p><span class="math display">\[p_{00}(t) = P(\text{satélite no está operativo en t} \mid \text{satélite no está operativo en 0}) = 1\]</span></p>
<p><span class="math display">\[\begin{eqnarray*}
p_{01}(t) &amp;=&amp; P(X_t=1|X_0=0) = 0 \\
p_{10}(t) &amp;=&amp; P(X_t=0|X_0=1) = Pr(T \leq t) = 1- e^{-\mu t}\\
p_{11}(t) &amp;=&amp; P(X_t=1|X_0=1) = Pr(T &gt;t) = e^{-\mu t}
\end{eqnarray*}\]</span></p>
<p>La matriz de transición viene dada pues por:</p>
<p><span class="math display">\[P(t) = 
\begin{pmatrix}
1 &amp; 0\\
1- e^{-\mu t} &amp; e^{-\mu t} 
\end{pmatrix}\]</span></p>
</div>
<div class="example">
<p><span id="exm:excmtc002" class="example"><strong>Ejemplo 4.2  </strong></span><strong>Sistema del viajante</strong>. Un vendedor vive en la ciudad A y es responsable de las ciudades A, B y C. El tiempo que pasa en cada ciudad es aleatorio. Tras un estudio, se ha determinado que la cantidad de tiempo consecutivo que pasa en una ciudad cualquiera sigue una variable aleatoria con distribución exponencial, cuya media de tiempo de estancia depende de la ciudad. En su ciudad natal pasa un tiempo medio de dos semanas, en la ciudad B pasa un tiempo medio de una semana, y en la ciudad C pasa un tiempo medio de una y media. Cuando sale de la ciudad A, lanza una moneda para determinar a qué ciudad va a continuación; cuando sale de la ciudad B o C, lanza dos monedas de manera que hay un 75% de posibilidades de volver a A y un 25% de posibilidades de ir a la otra ciudad. Sea <span class="math inline">\(X_t\)</span> una variable aleatoria que denota la ciudad en la que se encuentra el vendedor en el momento <span class="math inline">\(t\)</span>, de forma que toma el valor 0 si está en A, el valor 1 si está en B, y 2 si está en C.</p>
</div>
<p>El proceso <span class="math inline">\(\{X_t; t \geq 0\}\)</span> con espacio de estados <span class="math inline">\(\{0, 1, 2\}\)</span> es una CMTC con:</p>
<ul>
<li>tasas de permanecia (en semanas): <span class="math inline">\(r_0 = 1/2=0.5, r_1 = 1, r_2 = 1/1.5 =0.67\)</span> , y</li>
<li>matriz de saltos</li>
</ul>
<p><span class="math display">\[P = 
\begin{pmatrix}
0 &amp; 0.5 &amp; 0.5\\
0.75 &amp; 0 &amp; 0.25\\
0.75 &amp; 0.25 &amp; 0
\end{pmatrix}\]</span></p>
</div>
<div id="CMTCB" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Descripción del proceso<a class="anchor" aria-label="anchor" href="#CMTCB"><i class="fas fa-link"></i></a>
</h2>
<p>En virtud del teorema <a href="CMTC.html#thm:thecmtc001">4.1</a> todas las CMTC con espacios de estado finitos que tienen tiempos de permanencia no nulos en cada estado pueden ser descritos a través de las tasas de permanencia y la matriz de saltos. En este punto detallamos este análisis e introducimos todos los conceptos necesarios para el análisis del proceso.</p>
<p>La <strong>tasa de transición</strong> de <span class="math inline">\(i\)</span> a <span class="math inline">\(j\)</span> se define como el producto de la tasa de permanencia en el estado <span class="math inline">\(i\)</span>, <span class="math inline">\(r_i\)</span>, por la probabilidad de salto al estado <span class="math inline">\(j\)</span>, <span class="math inline">\(p_{ij}\)</span></p>
<p><span class="math display">\[\begin{equation}
r_{ij} = r_i p_{ij}
\end{equation}\]</span></p>
<p>De forma análoga a las CMTD, una CMTC también puede representarse gráficamente mediante un grafo dirigido cuyos nodos (o vértices) indican cada uno de los estados del proceso, y surge un arco dirigido del nodo <span class="math inline">\(i\)</span> al nodo <span class="math inline">\(j\)</span> si <span class="math inline">\(p_{ij} &gt; 0\)</span>; además junto a cada arco se escribe la tasa de transición <span class="math inline">\(r_{ij} = r_i p_{ij}\)</span>. Nunca habrá arcos que empiecen y acaben en el mismo nodo porque <span class="math inline">\(p_{ii}=0\)</span>. Esta representación gráfica se denomina <strong>diagrama de tasas de la CMTC</strong>.</p>
<p>Podemos entender la dinámica de una CMTC visualizando una partícula que se mueve de nodo en nodo en el diagrama de tasas de la siguiente manera: permanece en el nodo <span class="math inline">\(i\)</span> durante cierto periodo de tiempo de duración variable <span class="math inline">\(Exp(r_i)\)</span> y luego elige uno de los arcos de salida del nodo <span class="math inline">\(i\)</span> con probabilidades proporcionales a las tasas de los arcos, trasladándose al nodo que conecta dicho arco con el nodo origen <span class="math inline">\(i\)</span>. Este movimiento continúa para siempre. El nodo ocupado por la partícula en el instante <span class="math inline">\(t\)</span> es el estado de la CMTC en el instante <span class="math inline">\(t\)</span>.</p>
<p>En esta situación resulta posible obtener los valores de <span class="math inline">\(r_i\)</span> y <span class="math inline">\(p_{ij}\)</span> a partir de las tasas <span class="math inline">\(r_{ij}\)</span> dado que:</p>
<p><span class="math display">\[\begin{eqnarray*}
\sum_{j=1}^{N} r_{ij} &amp;=&amp; \sum_{j=1}^{N} r_i p_{ij} = r_i \sum_{j=1}^{N} p_{ij} = r_i\\
p_{ij} &amp;=&amp; \frac{r_{ij}}{r_i} \quad \text{ si } r_i \neq 0.
\end{eqnarray*}\]</span></p>
<p>Para un mejor manejo de la información, resulta conveniente construir la <strong>matriz de tasas de permanencia</strong> (o tasas de ocupación) teniendo en cuenta que <span class="math inline">\(r_{ii} = 0\)</span> para cualquier valor de <span class="math inline">\(i\)</span>, y por tanto la diagonal de la matriz <span class="math inline">\(R\)</span> es siempre cero. Así tenemos que:</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; r_{12} &amp; ... &amp; r_{1N}\\
r_{21} &amp; 0 &amp; ... &amp; r_{2N}\\
... &amp; ... &amp; ... &amp; ...\\
r_{N1} &amp; r_{N2} &amp; ... &amp; 0
\end{pmatrix}\]</span></p>
<p>A partir de la matriz <span class="math inline">\(R\)</span> se puede obtener la denominada <strong>matriz generadora</strong> <span class="math inline">\(Q\)</span> de la CMTC, que se define como aquella que tiene por elementos <span class="math inline">\(q_{ij}\)</span>, con:</p>
<p><span class="math display">\[q_{ij} = \begin{cases}
-r_i, \quad \text{ si } i = j, \\
r_{ij}, \quad \text{ si } i \neq j.
\end{cases}\]</span></p>
<p>de forma que:</p>
<p><span class="math display">\[Q = 
\begin{pmatrix}
-r_1 &amp; r_{12} &amp; ... &amp; r_{1N}\\
r_{21} &amp; -r_2 &amp; ... &amp; r_{2N}\\
... &amp; ... &amp; ... &amp; ...\\
r_{N1} &amp; r_{N2} &amp; ... &amp; -r_N
\end{pmatrix}\]</span></p>
<div class="example">
<p><span id="exm:excmtc003" class="example"><strong>Ejemplo 4.3  </strong></span>Continuando con el sistema de vida útil del satélite del ejemplo <a href="CMTC.html#exm:excmtc001">4.1</a>, podemos establecer que <span class="math inline">\(r_0 = 0\)</span> y <span class="math inline">\(r_1 = \mu\)</span>, con <span class="math inline">\(p_{10} = 1\)</span> y <span class="math inline">\(p_{01}\)</span> no definida, de forma que:</p>
</div>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; 0 \\
\mu &amp; 0
\end{pmatrix} \quad \text{ y } \quad Q = 
\begin{pmatrix}
0 &amp; 0 \\
\mu &amp; -\mu
\end{pmatrix}\]</span></p>
<p>En esta situación el diagrama de tasas se construye con la librería <code>diagram</code>:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-002"></span>
<img src="04-CMTC_files/figure-html/05-002-1.png" alt="Diagrama de tasas para el tiempo de vida del Satélite" width="95%"><p class="caption">
Figura 4.1: Diagrama de tasas para el tiempo de vida del Satélite
</p>
</div>
<div class="example">
<p><span id="exm:excmtc004" class="example"><strong>Ejemplo 4.4  </strong></span>Continuando con el sistema del viajante descrito en el ejemplo <a href="CMTC.html#exm:excmtc002">4.2</a> ya que conocemos las tasas medias y las probabilidades de salto podemos obtener la matriz <span class="math inline">\(R\)</span> de forma inmediata:</p>
</div>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">estados</span><span class="op">)</span>

<span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, 
            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.25</span>, <span class="fl">0</span><span class="op">)</span>, 
            byrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, 
            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">R</span> <span class="op">&lt;-</span> <span class="va">P</span><span class="op">*</span><span class="va">r</span>
<span class="va">R</span></code></pre></div>
<pre><code>##       [,1]  [,2] [,3]
## [1,] 0.000 0.250 0.25
## [2,] 0.750 0.000 0.25
## [3,] 1.125 0.375 0.00</code></pre>
<p>de forma que el diagrama de tasas viene dado por (asignamos el valor de la ciudad a cada uno de los posibles estados del sistema)</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-004"></span>
<img src="04-CMTC_files/figure-html/05-004-1.png" alt="Diagrama de tasas para el proceso del vendedor" width="95%"><p class="caption">
Figura 4.2: Diagrama de tasas para el proceso del vendedor
</p>
</div>
<p>El diagrama representa el comportamiento de todo el proceso de viajes y estancias del vendedor.</p>
<div class="example">
<p><span id="exm:excmtc005" class="example"><strong>Ejemplo 4.5  </strong></span><strong>Sistema vida útil de una máquina</strong>. Consideramos un sistema compuesto por una máquina que funciona durante un cantidad de tiempo que viene determianda por una variable aleatoria <span class="math inline">\(Exp(\mu)\)</span> hasta que falla. Una vez se detecta la avería, la máquina se repara. El tiempo de reparación es una variable aleatoria <span class="math inline">\(Exp(\lambda)\)</span> y es independiente del pasado. La máquina está como nueva después de la reparación. Sea <span class="math inline">\(X(t)\)</span> el estado de la máquina en tiempo <span class="math inline">\(t\)</span>, de forma que toma el valor 1 si está en marcha y 0 si está parada (porque está siendo reparada).</p>
</div>
<p>En esta situación el tiempo de estancia en el estado 0 es el tiempo de reparación, de forma que <span class="math inline">\(r_0 = \lambda\)</span>, mientras que el tiempo en el estado 1 es el tiempo de funcionamiento con <span class="math inline">\(r_1 = \mu\)</span>. Además las probabiliddes de salto de interés son <span class="math inline">\(p_{01} = 1\)</span> y <span class="math inline">\(p_{10} = 1\)</span>, dado que la máquina siempre es reparada y vuelve a funcionar, y porque sabemos que la máquina debe estropearse en algún momento.</p>
<p>El proceso definido de esta forma <span class="math inline">\(\{X_t; t \geq 0\}\)</span> es una CMTC cuya matriz de tasas y matriz generadora del sistema vienen dadas por:</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; \lambda \\
\mu &amp; 0
\end{pmatrix} \quad \text{ y } \quad Q = 
\begin{pmatrix}
-\lambda &amp; \lambda \\
\mu &amp; -\mu
\end{pmatrix}\]</span></p>
<p>El diagrama del sistema viene dado por:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-005"></span>
<img src="04-CMTC_files/figure-html/05-005-1.png" alt="Diagrama de tasas para el sistema de una máquina" width="95%"><p class="caption">
Figura 4.3: Diagrama de tasas para el sistema de una máquina
</p>
</div>
</div>
<div id="CMTCC" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Análisis preliminar del proceso<a class="anchor" aria-label="anchor" href="#CMTCC"><i class="fas fa-link"></i></a>
</h2>
<p>Aunque más adelante estudiaremos los aspectos teóricos para el análisis completo de una CMTC, en este punto utilizamos la simulación del sistema para analizar su comportamiento. Nos centramos en las herramientas de simulación estudiadas hasta este punto para más adelante presentar con detalle la librería <code>simmer</code> que nos permite simular procesos y sistemas complejos.</p>
<p>Utilizamos los ejemplos <a href="CMTC.html#exm:excmtc002">4.2</a> y <a href="CMTC.html#exm:excmtc005">4.5</a> para mostrar cómo analizar un sistema, dado que el descrito en el ejemplo <a href="CMTC.html#exm:excmtc001">4.1</a> se puede analizar sin más que describir la tasa del tiempo de vida del satélite.</p>
<div id="sistema-de-vida-útil-de-una-máquina" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> Sistema de vida útil de una máquina<a class="anchor" aria-label="anchor" href="#sistema-de-vida-%C3%BAtil-de-una-m%C3%A1quina"><i class="fas fa-link"></i></a>
</h3>
<p>Comenzamos con el ejemplo <a href="CMTC.html#exm:excmtc005">4.5</a>, para el que vamos a construir un algoritmo con el que simular el sistema hasta cierto instante de tiempo.</p>
<div class="silverbox">
<p>Algoritmo para el sistema de vida útil de una máquina:</p>
<ol style="list-style-type: decimal">
<li>Fijar tasas de funcionamiento <span class="math inline">\(\mu\)</span> y reparación <span class="math inline">\(\lambda\)</span>, así como el tiempo en que el sistema estará funcionando (<span class="math inline">\(tfin\)</span>).</li>
<li>Fijar el tiempo de funcionamiento <span class="math inline">\(tfun = 0\)</span>, tiempo de reparación <span class="math inline">\(trep = 0\)</span>, y tiempo de funcionamiento del sistema <span class="math inline">\(tsis = tfun + trep\)</span>.</li>
<li>Fijar el número de vistas al estado de funcionamiento <span class="math inline">\(nfun = 0\)</span> y al estado de reparación <span class="math inline">\(nrep =0\)</span>.</li>
</ol>
<p>Repetir los pasos siguientes hasta abandonar el sistema:</p>
<ol start="3" style="list-style-type: decimal">
<li>Generar <span class="math inline">\(tfun \sim Exp(\mu)\)</span> actualizando <span class="math inline">\(tsis\)</span> y <span class="math inline">\(nfun\)</span>.</li>
<li>Si <span class="math inline">\(tsis &gt; tfin\)</span>, abandonar el sistema.</li>
<li>Generar <span class="math inline">\(trep \sim Exp(\lambda)\)</span> actualizando <span class="math inline">\(tsis\)</span> y <span class="math inline">\(nrep\)</span>.</li>
<li>Si <span class="math inline">\(tsis &gt; tfin\)</span>, abandonar el sistema.</li>
</ol>
<p>Los valores <span class="math inline">\(tfun\)</span>, <span class="math inline">\(trep\)</span>, así como las veces que se visitan los estados de funcionamiento y reparación nos permiten describir el funcionamiento del sistema para un tiempo prefijado.</p>
</div>
<p>Para facilitar el análisis establecemos que todos los tiempos del sistema están en días y que deseamos estudiar el sistema durante un año. Creamos una función que nos permite modificar los valores de la tasa del tiempo de funcionamiento (recíproco de la media de tiempo en funcionamiento ), la tasa de reparación (recíproco de la media del tiempo de reparación) y el tiempo total de funcionamiento del sistema. Almacenamos los resultados de cada paso por el sistema para poder realizar los análisis correspondientes.</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TSIM_one_machine</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tasafun</span>, <span class="va">tasarep</span>, <span class="va">tfin</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co"># =========================</span>
  <span class="co"># tasafun: tasa de funcionamiento</span>
  <span class="co"># tasarep: tasa de reparación</span>
  <span class="co"># tfin: tiempo de funcionamiento del sistema</span>
  
  <span class="co"># inicialización de parámetros del sistema </span>
  <span class="va">tfun</span> <span class="op">=</span> <span class="va">trep</span> <span class="op">=</span> <span class="va">nfun</span> <span class="op">=</span> <span class="va">nrep</span> <span class="op">=</span> <span class="va">tsis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
  <span class="co"># estado inicial del sistema</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">trep</span> <span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">nfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">nrep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>
  <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  
  <span class="co"># Fijamos semilla</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
  <span class="co"># Bucle de simulación</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">tfin</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">i</span><span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="co"># Máquina en funcionamiento</span>
    <span class="va">nfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">nfun</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasafun</span><span class="op">)</span> 
    <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span> <span class="co">#Actualizamos estos dos parámetros ya que no hemos entrado en reparación</span>
    <span class="va">nrep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">nrep</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">tfin</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># adaptamos valores para quedarnos en los 365 días</span>
      <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfin</span> <span class="op">-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
      <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tfun</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
      <span class="kw">break</span>
      <span class="op">}</span>
    <span class="co"># Máquina en reparación</span>
    <span class="va">nrep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">nrep</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasarep</span><span class="op">)</span>
    <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">tfin</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># adaptamos valores para quedarnos en los 365 días</span>
      <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfin</span> <span class="op">-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> 
      <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">trep</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
      <span class="kw">break</span>
      <span class="op">}</span>
  <span class="op">}</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">tfun</span>, <span class="va">nfun</span>, <span class="va">trep</span>, <span class="va">nrep</span>, <span class="va">tsis</span><span class="op">)</span>
  <span class="co"># Devolvemos resultados del sistema quitando la fila de inicialización</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Supongamos que a través de los registros históricos de funcionamiento y reparación de la máquina se sabe que el tiempo medio de funcionamiento es de 60 días (<span class="math inline">\(\mu = 1/60\)</span>) y el tiempo medio de reparación es de cuatro días (<span class="math inline">\(\lambda = 1/4\)</span>). Además se está interesado en estudiar el funcionamiento del sistema para el próximo año (365 días). Queremos pues, estimar:</p>
<ul>
<li>Proporción del tiempo que la máquina está funcionando y en reparación.</li>
<li>Número de ocasiones en que la máquina debe ser reparada.</li>
<li>Si el beneficio neto es de 100 euros por cada día que la máquina está funcionando y una pérdida de 1500 euros por cada día que está en reparación ¿cuál es el beneficio esperado para el próximo año?</li>
</ul>
<p>Obtenemos la simulación del sistema:</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">60</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>
<span class="va">simulacion</span> <span class="op">&lt;-</span> <span class="fu">TSIM_one_machine</span><span class="op">(</span><span class="va">mu</span>, <span class="va">lambda</span>, <span class="fl">365</span><span class="op">)</span>
<span class="va">simulacion</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##     tfun  nfun  trep  nrep  tsis
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  50.6      1 2.31      1  52.9
## 2  79.7      2 0.126     2 133. 
## 3   3.37     3 1.27      3 137. 
## 4  18.9      4 0.581     4 157. 
## 5 164.       5 0.117     5 321. 
## 6  44.5      6 0         5 365</code></pre>
<p>Podemos ver que el número de ciclos en que la máquina esta en fucionamiento es 6 mientras que el número de veces que ha necesitado reparación son 5.</p>
<p>Calculamos ahora los tiempos totales de funcionamiento y reparación:</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tiempos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">simulacion</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span>
<span class="va">tiempos</span></code></pre></div>
<pre><code>##       tfun       trep 
## 360.603564   4.396436</code></pre>
<p>Por tanto, la proporción de tiempo que la máquina está en funcionamiento es 0.99, y el beneficio estimado para el próximo año viene dado por:</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">beneficio</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">tiempos</span><span class="op">[</span><span class="st">"tfun"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1500</span> <span class="op">*</span> <span class="va">tiempos</span><span class="op">[</span><span class="st">"trep"</span><span class="op">]</span>
<span class="va">beneficio</span></code></pre></div>
<pre><code>##    tfun 
## 29465.7</code></pre>
</div>
<div id="sistema-del-viajante" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Sistema del viajante<a class="anchor" aria-label="anchor" href="#sistema-del-viajante"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación analizamos el sistema del viajante correspondiente al ejemplo <a href="CMTC.html#exm:excmtc002">4.2</a>. En primer lugar establecemos el algoritmo de simulación del sistema. Para facilitar todas las posibilidades del algoritmo asumimos que el vendedor comienza el recorrido en la ciudad en la que reside.</p>
<div class="silverbox">
<p>Algoritmo para el análisis del sistema del viajante:</p>
<ol style="list-style-type: decimal">
<li>Fijar tasas de permanencia en cada ciudad <span class="math inline">\(\mu_A\)</span>, <span class="math inline">\(\mu_B\)</span>, y <span class="math inline">\(\mu_C\)</span>, así como las probabilidades de salto dadas en la matriz <span class="math inline">\(P\)</span>, y una varibale que indica la ciudad en la que nos encontramos (<span class="math inline">\(ciudad\)</span>).</li>
<li>Fijar el tiempo de funcionamiento del sistema <span class="math inline">\(tsis = 0\)</span>, tiempo de permanencia en cada ciudad <span class="math inline">\(tiempo = 0\)</span>, y el tiempo de estudio <span class="math inline">\(tfin\)</span>.</li>
<li>Generar <span class="math inline">\(tiempo \sim Exp(\mu_a)\)</span> y actualizar <span class="math inline">\(tsis\)</span>, de forma que si <span class="math inline">\(tsis &gt; tfin\)</span> abandonamos el sistema.</li>
<li>Generamos un salto de la ciudad <span class="math inline">\(A\)</span> de acuerdo a las probabilidades de <span class="math inline">\(P\)</span> correspondientes a la ciudad <span class="math inline">\(A\)</span>.</li>
</ol>
<p>Repetir los pasos siguientes hasta que el tiempo en el sistema supere el tiempo fijado:</p>
<ol start="5" style="list-style-type: decimal">
<li>Actualizamos <span class="math inline">\(ciudad\)</span>, generamos <span class="math inline">\(tiempo \sim Exp(\mu_{ciudad})\)</span> y actualizamos <span class="math inline">\(tsis\)</span>, de forma que si <span class="math inline">\(tsis &gt; tfin\)</span> abandonamos el sistema.</li>
<li>Generamos un salto de la ciudad del paso anterior de acuerdo a las probabilidades de <span class="math inline">\(P\)</span> correspondientes a dicha ciudad.</li>
</ol>
<p>Los valores <span class="math inline">\(tiempo\)</span>, y <span class="math inline">\(ciudad\)</span> nos permiten describir el funcionamiento del sistema para un tiempo prefijado.</p>
</div>
<p>A continuación construimos la función para simular el sistema hasta cierto instante de tiempo.</p>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TSIM_viajante</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tasaA</span>, <span class="va">tasaB</span>, <span class="va">tasaC</span>, <span class="va">tfin</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co"># =========================</span>
  <span class="co"># tasaA: tasa de permanencia en A</span>
  <span class="co"># tasaB: tasa de permanencia en B</span>
  <span class="co"># tasaC: tasa de permanencia en C</span>
  <span class="co"># tfin: tiempo de funcionamiento del sistema</span>
  
  <span class="co"># inicialización de parámetros del sistema </span>
  <span class="va">tiempo</span> <span class="op">=</span> <span class="va">tsis</span> <span class="op">=</span> <span class="va">ciudad</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
  <span class="co"># Probabilidades de salto. Fijamos la primera ya que la otra es complementaria</span>
  <span class="va">pA</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># de A a B. De A a C es  1-pA</span>
  <span class="va">pB</span> <span class="op">&lt;-</span> <span class="fl">0.75</span> <span class="co"># de B a A. De B a C es  1-pB</span>
  <span class="va">pC</span> <span class="op">&lt;-</span> <span class="fl">0.75</span> <span class="co"># de C a A. De C a B es  1-pC</span>
  
  <span class="co"># estado inicial del sistema</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"A"</span>
  <span class="co"># Fijamos semilla</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
  <span class="co"># Primer tiempo de estancia</span>
  <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasaA</span><span class="op">)</span>
  <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="co"># Saltamos de la ciudad A</span>
  <span class="va">uniforme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">uniforme</span> <span class="op">&lt;=</span> <span class="va">pA</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"B"</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"C"</span><span class="op">)</span>
      
  <span class="co"># Bucle de simulación</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="va">tfin</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">i</span><span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">uniforme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span>
      <span class="op">{</span>
        <span class="co"># Calculamos tiempo de permanencia</span>
        <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasaA</span><span class="op">)</span>
        <span class="co"># Actualizamos y valoramos si hemos alcanzado el tiempo límite</span>
        <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
        <span class="kw">if</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">tfin</span><span class="op">)</span><span class="op">{</span>
            <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfin</span> <span class="op">-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> 
            <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
            <span class="kw">break</span>
          <span class="op">}</span>
        <span class="co"># Si no hemos alcanzado el límite realizamos un nuevo salto</span>
        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">uniforme</span> <span class="op">&lt;=</span> <span class="va">pA</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"B"</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"C"</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span>
      <span class="op">{</span>
        <span class="co"># Calculamos tiempo de permanencia</span>
        <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasaB</span><span class="op">)</span>
        <span class="co"># Actualizamos y valoramos si hemos alcanzado el tiempo límite</span>
        <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
        <span class="kw">if</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">tfin</span><span class="op">)</span><span class="op">{</span>
            <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfin</span> <span class="op">-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> 
            <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
            <span class="kw">break</span>
          <span class="op">}</span>
        <span class="co"># Si no hemos alcanzado el límite realizamos un nuevo salto</span>
        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">uniforme</span> <span class="op">&lt;=</span> <span class="va">pB</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"A"</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"C"</span><span class="op">)</span>
      <span class="op">}</span>  
    <span class="kw">if</span><span class="op">(</span><span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span>
      <span class="op">{</span>
        <span class="co"># Calculamos tiempo de permanencia</span>
        <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasaC</span><span class="op">)</span>
        <span class="co"># Actualizamos y valoramos si hemos alcanzado el tiempo límite</span>
        <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
        <span class="kw">if</span><span class="op">(</span><span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">tfin</span><span class="op">)</span><span class="op">{</span>
            <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tfin</span> <span class="op">-</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> 
            <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">tsis</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
            <span class="kw">break</span>
          <span class="op">}</span>
        <span class="co"># Si no hemos alcanzado el límite realizamos un nuevo salto</span>
        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">uniforme</span> <span class="op">&lt;=</span> <span class="va">pC</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"A"</span>, <span class="va">ciudad</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"C"</span><span class="op">)</span>
      <span class="op">}</span>
  <span class="op">}</span>
  <span class="co"># Devolvemos resultados del sistema </span>
  <span class="va">ciudad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ciudad</span><span class="op">)</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">tiempo</span>, <span class="va">ciudad</span>, <span class="va">tsis</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Supongamos que estamos interesados en aproximar el comportamiento del vendedor durante el próximo año (52 semanas) para poder contestar a las preguntas siguientes:</p>
<ul>
<li>Proporción de tiempo que el vendedor pasa en cada ciudad.</li>
<li>Número de ocasiones en que visita cada ciudad.</li>
</ul>
<p>Simulamos pues el sistema y contestamos a las preguntas planteadas:</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tasaA</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">tasaB</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">1</span>
<span class="va">tasaC</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span>
<span class="va">tfin</span> <span class="op">&lt;-</span> <span class="fl">52</span>
<span class="va">simulacion</span> <span class="op">&lt;-</span> <span class="fu">TSIM_viajante</span><span class="op">(</span><span class="va">tasaA</span>, <span class="va">tasaB</span>, <span class="va">tasaC</span>, <span class="va">tfin</span><span class="op">)</span>  
<span class="co"># Análsis del sistema</span>
<span class="va">simulacion</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ciudad</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>visita <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, estancia <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tiempo</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proporcion <span class="op">=</span> <span class="va">estancia</span><span class="op">/</span><span class="fl">52</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   ciudad visita estancia proporcion
##   &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1 A          16     30.3      0.583
## 2 B           8     10.7      0.206
## 3 C          11     11.0      0.211</code></pre>
</div>
<div id="análisis-con-simmer" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Análisis con simmer<a class="anchor" aria-label="anchor" href="#an%C3%A1lisis-con-simmer"><i class="fas fa-link"></i></a>
</h3>
<p>Si bien dedicamos en este curso un capítulo entero para contar el funcionamiento de la librería <code>simmer</code>, puesto que estos ejemplos son relativamente sencillos, podemos introducir sin demasiada complicación el algoritmo de simulación con <code>simmer</code>.</p>
<p>La libreria <code>simmer</code> permite simular de sistemas tanto continuos como discretos bajos dos premisas fundamentales:</p>
<ul>
<li>Proceso de llegadas (“arrivals”) al sistema.</li>
<li>Proceso de servicio (“server”): en el que a cada una de las llegadas se les asigna una serie de actividades a realizar (integradas en ‘trayectorias’) y unos recursos o servidores que resuelven con ellas las actividades.</li>
</ul>
<p>Para el sistema descrito en ejemplo <a href="CMTC.html#exm:excmtc005">4.5</a> el proceso de llegadas viene identificado por las averías que se producen en determinados instantes de tiempo. El proceso de servicio se corresponde con las reparaciones de las máquinas, a las que se dedica cierto tiempo. En este caso el recurso es el reparador encargado de resolver la avería y poner en marcha la máquina de nuevo.</p>
<p>El primer paso del algoritmo de simulación es cargar las librerías y definir la semilla de simulación:</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer.plot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-simmer.org">simmer.bricks</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></code></pre></div>
<p>Definimos ahora el entorno de simulación del sistema:</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tasas de permanencia del sistema</span>
<span class="co">##################################</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>  <span class="co"># tasa reparación</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">60</span>     <span class="co"># tasa funcionamiento</span>

<span class="co"># Sistema</span>
<span class="co">#################################################</span>
<span class="va">sistema.1m</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># tarea dentro de sistema: reparación de las averías</span>
  <span class="va">reparar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="co"># la máquina estropeada se asigna a un reparador</span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"reparador"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>              
    <span class="co"># el tiempo de reparación es aleatorio</span>
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   
    <span class="co"># la máquina ya ha sido reparada</span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"reparador"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>               

  <span class="co"># Configuración del sistema </span>
  <span class="co">#################################################</span>
  <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="co"># Se definen los recursos: un único reparador y cola infinita</span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"reparador"</span>, capacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           
    <span class="co"># Simulador de los tiempos entre averías, dirigidas a la trayectoria "reparar"</span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"averia"</span>, <span class="va">reparar</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="co"># Tiempo funcionamiento del sistema</span>
    <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until <span class="op">=</span> <span class="va">t</span><span class="op">)</span>     
<span class="op">}</span>

<span class="co">### Simulación del sistema durante 365 días</span>
<span class="va">operar</span> <span class="op">&lt;-</span> <span class="fu">sistema.1m</span><span class="op">(</span><span class="fl">365</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span></code></pre></div>
<p>Analizamos ahora los resultados que proporciona el sistema simulado. Podemos acceder a las información de dos formas diferentes mediante las funciones <code><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals()</a></code> para describir las llegadas (averías) y <code><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources()</a></code> para describir la ocupación de los servidores recursos (técnicos reparadores).</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reparacion</span> <span class="op">=</span> <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">operar</span><span class="op">)</span>
<span class="va">reparacion</span></code></pre></div>
<pre><code>##      name start_time end_time activity_time finished replication
## 1 averia0   150.1055 150.1318    0.02632783     TRUE           1
## 2 averia1   164.9110 166.4598    1.54873033     TRUE           1
## 3 averia2   269.4758 272.7721    3.29632606     TRUE           1
## 4 averia3   274.8728 278.2250    3.35216128     TRUE           1
## 5 averia4   287.0299 294.5502    7.52030671     TRUE           1
## 6 averia5   332.6557 339.2903    6.63464954     TRUE           1</code></pre>
<p>El objeto resultante tiene las columnas siguientes:</p>
<ul>
<li>
<code>name</code>: nombre de las llegadas (averías), numeradas correlativamente</li>
<li>
<code>star_time</code>: instante en el que llega al sistema (se produce la avería)</li>
<li>
<code>end_time</code>: instante en el que sale del sistema (se ha reparado)</li>
<li>
<code>activity_time</code>: tiempo dedicado a la tarea (tiempo de reparación)</li>
<li>
<code>finished</code>: si la tarea ha finalizado dentro del periodo de tiempo de simulación establecido.</li>
<li>
<code>replication</code>: número de replicas del sistema (1 porque sólo hemos lanzado una cadena).</li>
</ul>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recursos</span> <span class="op">=</span> <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">operar</span><span class="op">)</span>
<span class="va">recursos</span></code></pre></div>
<pre><code>##     resource     time server queue capacity queue_size system limit replication
## 1  reparador 150.1055      1     0        1        Inf      1   Inf           1
## 2  reparador 150.1318      0     0        1        Inf      0   Inf           1
## 3  reparador 164.9110      1     0        1        Inf      1   Inf           1
## 4  reparador 166.4598      0     0        1        Inf      0   Inf           1
## 5  reparador 269.4758      1     0        1        Inf      1   Inf           1
## 6  reparador 272.7721      0     0        1        Inf      0   Inf           1
## 7  reparador 274.8728      1     0        1        Inf      1   Inf           1
## 8  reparador 278.2250      0     0        1        Inf      0   Inf           1
## 9  reparador 287.0299      1     0        1        Inf      1   Inf           1
## 10 reparador 294.5502      0     0        1        Inf      0   Inf           1
## 11 reparador 332.6557      1     0        1        Inf      1   Inf           1
## 12 reparador 339.2903      0     0        1        Inf      0   Inf           1</code></pre>
<p>Con la función <code><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources()</a></code> tenemos una descripción continua de los recursos del proceso con las columnas:</p>
<ul>
<li>
<code>resource</code>: recurso (numerado correlativamente si hubiera más de uno)</li>
<li>
<code>time</code>: instante de tiempo en que se ha registrado alguna actividad (avería, reparación, puesta en marcha)</li>
<li>
<code>server</code>: número de servidores (recursos) ocupados (como sólo hay un técnico, es igual a 1)</li>
<li>
<code>queue</code>: llegadas en la cola (averías que están esperando ser reparadas porque el técnico está ocupado)</li>
<li>
<code>capacity</code>: capacidad del sistema o número de reparadores en el sistema</li>
<li>
<code>queue_size</code>: tamaño de la cola de espera (averías en espera para ser reparadas)</li>
<li>
<code>system</code>: llegadas en el sistema (número de averías en ese instante, en reparación o en cola)</li>
<li>
<code>limit</code>: capacidad + tamaño de la cola</li>
<li>
<code>replication</code>: número de replica del sistema (1 porque sólo se ha lanzado una cadena).</li>
</ul>
<p>A partir de los resultados podemos responder a las mismas preguntas que ya planteamos antes:</p>
<ul>
<li>Proporción del tiempo que la máquina está funcionando y en reparación.</li>
<li>Número de ocasiones en que la máquina debe ser reparada.</li>
<li>Si el beneficio neto es de 100 euros por cada día que la máquina está funcionando y una pérdida de 1500 euros por cada día que está en reparación ¿cuál es el beneficio esperado para el próximo año?</li>
</ul>
<p>Para responder al primer pregunta basta con sumar los tiempos de actividad y calcualr su proporción sobre los 365 días de simulación:</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tiempo_reparacion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">reparacion</span><span class="op">$</span><span class="va">activity_time</span><span class="op">)</span>
<span class="va">propor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">tiempo_reparacion</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">propor</span></code></pre></div>
<pre><code>## [1] 93.87</code></pre>
<p>La proporción de tiempo en que la máquina está funcionando es del 93.87% y el tiempo que está en reparación es del 6.13%.</p>
<p>El número de ocasiones en que la máquina está en reparación corresponde al número de veces que accedemos a la tarea de reparación, que en este caso es de 6.</p>
<p>Para calcular el beneficio obtenido a lo largo del año utilizamos el tiempo de reparación obtenido:</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fl">365</span><span class="op">-</span><span class="va">tiempo_reparacion</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span> <span class="op">-</span> <span class="va">tiempo_reparacion</span><span class="op">*</span><span class="fl">1500</span></code></pre></div>
<pre><code>## [1] 694.3972</code></pre>
<p>Como se puede ver, los resultados no son muy similares a los obtenidos con el algoritmo que programamos nosotros. Para conseguir estimaciones estables deberíamos realizar diferentes replicaciones del sistema (lanzar varias cadenas) y promediar los beneficios obtenidos mediante un estimador Monte-Carlo. Podemos replicar fácilmente el sistema añadiendo dos líneas de código. Cada cadena replicada tendrá un distintivo diferente en el argumento ‘replicate’ cuando monitorizamos los resultados.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lanzamos 'nreplicas' de la cadena, que se almacenan en una lista</span>
<span class="va">nreplicas</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nreplicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
  <span class="va">operar</span> <span class="op">&lt;-</span> <span class="fu">sistema.1m</span><span class="op">(</span><span class="fl">365</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Ahora almacenamos todas las simulaciones a modo de matriz, en concreto ‘tibble,’ para poder realizar los cálculos oportunos agrupando por réplicas y con ellos poder calcular las estimaciones Monte-Carlo del tiempo total de reparación y del número de reparaciones.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># guardamos todas las llegadas en formato 'tibble'</span>
<span class="va">simulaciones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>

<span class="co"># agrupamos por 'replication' para calcular los descriptivos de interés en cada réplica</span>
<span class="va">salida</span> <span class="op">&lt;-</span> <span class="va">simulaciones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Calculamos los descriptivos por cada réplica</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>nreparaciones <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, 
            tiempoparada <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">activity_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Calculamos las estimaciones Monte-Carlo con los descriptivos de las réplicas</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mmedia_nrepara <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">nreparaciones</span><span class="op">)</span>,
            min_nrepara <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">nreparaciones</span><span class="op">)</span>,
            max_nrepara <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">nreparaciones</span><span class="op">)</span>,
            media_taveria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tiempoparada</span><span class="op">)</span>,
            q25_taveria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tiempoparada</span>, <span class="fl">0.25</span><span class="op">)</span>,
            q50_taveria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tiempoparada</span>, <span class="fl">0.50</span><span class="op">)</span>,
            q75_taveria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tiempoparada</span>, <span class="fl">0.75</span><span class="op">)</span>,
            sd_taveria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">tiempoparada</span><span class="op">)</span> 
            <span class="op">)</span>
<span class="va">salida</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   mmedia_nrepara min_nrepara max_nrepara media_taveria q25_taveria q50_taveria q75_taveria
##            &lt;dbl&gt;       &lt;int&gt;       &lt;int&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1           6.12           1          15          23.8        13.4        21.3        31.9
## # … with 1 more variable: sd_taveria &lt;dbl&gt;</code></pre>
<p>En ‘mmedia_nrepara’ tenemos la estimación del número de reparaciones en un año, en ‘min_nrepara’ y ‘max_nrepara’ el mínimo y el máximo respectivamente; en ‘media_taveria’ tenemos una estimación del tiempo medio acumulado en reparaciones en un año, con sus cuartiles (q25, q50 y q75) y desviación típica (sd).</p>
<p>Así podemos calcular los beneficios esperados en función del número de días que la máquina funciona y los que está estropeada:</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># número de días en funcionamiento vs número de días en reparación</span>
<span class="op">(</span><span class="fl">365</span><span class="op">-</span><span class="va">salida</span><span class="op">$</span><span class="va">media_taveria</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span> <span class="op">-</span> <span class="va">salida</span><span class="op">$</span><span class="va">media_taveria</span><span class="op">*</span><span class="fl">1500</span></code></pre></div>
<pre><code>## [1] -1561.395</code></pre>
<p>Podemos considerar también otros dos escenarios posibles: uno pesimista, con un mayor tiempo acumulado de reparación (cuantil 75), y uno optimisma, con un menor tiempo (con el cuantil 25), y calcular con ellos los beneficios:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fl">365</span><span class="op">-</span><span class="va">salida</span><span class="op">$</span><span class="va">q75_taveria</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span> <span class="op">-</span> <span class="va">salida</span><span class="op">$</span><span class="va">q75_taveria</span><span class="op">*</span><span class="fl">1500</span></code></pre></div>
<pre><code>##       75% 
## -14480.82</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fl">365</span><span class="op">-</span><span class="va">salida</span><span class="op">$</span><span class="va">q25_taveria</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span> <span class="op">-</span> <span class="va">salida</span><span class="op">$</span><span class="va">q25_taveria</span><span class="op">*</span><span class="fl">1500</span></code></pre></div>
<pre><code>##      25% 
## 15047.35</code></pre>
<p>¿Qué conclusiones podemos extraer de este análisis?</p>
<p>Para finalizar este apartado presentamos un nuevo ejemplo donde el espacio de estados está compuesto por una pareja de valores y no por un único valor como en los ejemplos que hemos presentado hasta ahora.</p>
</div>
<div id="mantenimiento-de-aronaves" class="section level3" number="4.3.4">
<h3>
<span class="header-section-number">4.3.4</span> Mantenimiento de aronaves<a class="anchor" aria-label="anchor" href="#mantenimiento-de-aronaves"><i class="fas fa-link"></i></a>
</h3>
<p>Una empresa de mantenimiento de aeronaves está interesada en el proceso de avería-reparación de cierto tipo de aviones. El tipo de avión de interés es un avión comercial a reacción con cuatro motores, dos en cada ala. Cuando un motor se enciende, el tiempo que se puede mantener en funcionamiento hasta que falla es una variable aleatoria exponencial con parámetro <span class="math inline">\(\lambda\)</span>. Si el fallo se produce en vuelo, no puede haber reparación, pero el avión necesita al menos un motor en cada ala para funcionar correctamente y poder volar con seguridad. En concreto, la empresa está interesada en poder predecir la probabilidad de un vuelo sin problemas.</p>
<p>Si denotamos por <span class="math inline">\(X_L(t)\)</span> y <span class="math inline">\(X_R(t)\)</span> el número de motores funcionando en el instante <span class="math inline">\(t\)</span> en el ala izquierda y el ala derecha respectivamente, podemos considerar el estado del sistema en el instante <span class="math inline">\(t\)</span> como <span class="math inline">\(X(t) = (X_L(t), X_R(t))\)</span>. Si asumimos que los fallos en los motores son independientes entre sí, podemos ver que el proceo <span class="math inline">\(\{X(t), t \geq 0\}\)</span> es una CMTC con espacio de estados:</p>
<p><span class="math display">\[S = \{ (0, 0), (0, 1), (0, 2), (1, 0), (1, 1), (1, 2), (2, 0), (2, 1), (2,2) \}\]</span></p>
<p>En esta situación, el avión sigue funcionando en el subconjunto de estados <span class="math inline">\(S = \{ (1, 1), (1, 2), (2, 1), (2,2) \}\)</span>.</p>
<p>Vamos a asumir (aunque no es real) que el sistema sigue funcionando, incluso cuando hay posibilidad de un accidente, hasta que llegamos al estado <span class="math inline">\((0, 0)\)</span>. Dado que no hay reparación posible, la matriz de tasas entre estados del sistema viene dada por</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 2\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \lambda &amp; 0 &amp; \lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \lambda &amp; 0 &amp; 2\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 2\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 2\lambda &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 2\lambda &amp; 0 &amp; 2\lambda &amp; 0
\end{pmatrix} \]</span></p>
<p>y el diagrama que representa el sistema resulta:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-022"></span>
<img src="04-CMTC_files/figure-html/05-022-1.png" alt="Diagrama de tasas para el sistema motores de aviones" width="95%"><p class="caption">
Figura 4.4: Diagrama de tasas para el sistema motores de aviones
</p>
</div>
<p>Para facilitar el algoritmo de simulación en esta situación, vamos a asignar un código a cada uno de los posibles estados del sistema:</p>
<p><span class="math display">\[S = \{ 1 = (0, 0), 2 = (0, 1), 3 = (0, 2), 4 = (1, 0), 5 = (1, 1), 6 = (1, 2), 7 = (2, 0), 8 = (2, 1), 9 = (2,2) \}\]</span></p>
<p>y asumimos que la media del tiempo hasta que un motor falla cuando está encendido es de 20 horas, es decir, <span class="math inline">\(\lambda = 1/20\)</span>. A continuación hemos construido una función para simular el sistema descrito:</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TSIM_aviones</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tasa</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co"># =========================</span>
  <span class="co"># tasa: tasa de fallo de un motor</span>
  
  <span class="co"># Valores fijos del sistema</span>
  <span class="co"># codigos de motores funcionando obviando el estado inicial</span>
  <span class="va">codigo</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>
  <span class="co"># motores con fallo de acuerdo al código</span>
  <span class="va">motoresOFF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>
  
  <span class="co"># inicialización de parámetros del sistema </span>
  <span class="va">tiempo</span> <span class="op">=</span>  <span class="va">estado</span> <span class="op">=</span> <span class="va">fallos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">i</span><span class="op">&lt;-</span><span class="fl">1</span>
  <span class="co"># Primer fallo</span>
  <span class="co"># Posibles estados de salto</span>
  <span class="va">saltos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">codigo</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>, <span class="va">codigo</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span>
  <span class="co"># tiempos asociados a cada fallo</span>
  <span class="va">simula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">*</span><span class="va">tasa</span><span class="op">)</span>
  <span class="co"># Seleccionamos el salto</span>
  <span class="va">posicion</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">simula</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">posicion</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
    <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
    <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>
    <span class="co"># nuevo salto</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">saltos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">codigo</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">codigo</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
    <span class="va">simula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">*</span><span class="va">tasa</span><span class="op">)</span><span class="op">)</span>
    <span class="va">posicion</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">simula</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">posicion</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">{</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>
      <span class="co"># dos últimos saltos</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">*</span><span class="va">tasa</span><span class="op">)</span>; <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span>
    <span class="kw">else</span>
    <span class="op">{</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>  
      <span class="co"># dos últimos saltos</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>; <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw">else</span>
  <span class="op">{</span>
    <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
    <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
    <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>
    <span class="co"># nuevo salto</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">saltos</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">codigo</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>, <span class="va">codigo</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
    <span class="va">simula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">*</span><span class="va">tasa</span><span class="op">)</span><span class="op">)</span>
    <span class="va">posicion</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">simula</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">posicion</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="op">{</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>
      <span class="co"># dos últimos saltos</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">*</span><span class="va">tasa</span><span class="op">)</span>; <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span>
    <span class="kw">else</span>
    <span class="op">{</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simula</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span> 
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">saltos</span><span class="op">[</span><span class="va">posicion</span><span class="op">]</span><span class="op">]</span>  
      <span class="co"># dos últimos saltos</span>
      <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
      <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>; <span class="va">tiempo</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">tasa</span><span class="op">)</span>
      <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">fallos</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">motoresOFF</span><span class="op">[</span><span class="va">estado</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span>    
  <span class="op">}</span>

  <span class="co"># Devolvemos resultados del sistema </span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">estado</span>, <span class="va">tiempo</span>, <span class="va">fallos</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Veamos una simulación del sistema:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="va">tasa</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>
<span class="va">sistema</span> <span class="op">&lt;-</span> <span class="fu">TSIM_aviones</span><span class="op">(</span><span class="va">tasa</span><span class="op">)</span>
<span class="va">sistema</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   estado tiempo fallos
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1      8   6.36      1
## 2      7   2.35      2
## 3      2  18.2       3
## 4      1   5.67      4</code></pre>
<p>El resultado obtenido es el estado en cada paso del algoritmo hasta llegar a la parada total, los tiempos para alcanzar cada estado, y el número de motores con fallo.</p>
<p>Podemos operar los tiempos para saber cuándo tendremos más de dos motores con fallo (últimas dos filas de la simulación).</p>
<p>Si el vuelo que acabamos de empezar es de <span class="math inline">\(x\)</span> horas ¿cómo podemos estimar la probabilidad de no poder terminar el vuelo de forma segura? Para responder esta pregunta podremos calcular la proporción de tiempo que corresponde con un fallo leve (1 o 2 motores con fallo) con respecto a las <span class="math inline">\(x\)</span> horas de duración del vuelo.</p>
<p>Calculamos a continuación el tiempo de fallo del sistema y evaluamos la probabilidad para diferentes tiempos de duración de vuelo.</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tiempo de fallo</span>
<span class="va">Tfallo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">sistema</span><span class="op">$</span><span class="va">tiempo</span><span class="op">[</span><span class="va">sistema</span><span class="op">$</span><span class="va">fallos</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co"># Duración del vuelo</span>
<span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Probabilidad viaje seguro</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Tfallo</span> <span class="op">&gt;=</span> <span class="va">td</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">Tfallo</span><span class="op">/</span><span class="va">td</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Obtenemos el valor mínimo de tiempo para asegurar un viaje seguro</span>
<span class="va">limite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">td</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">prob</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">limite</span></code></pre></div>
<pre><code>## [1] 8.8</code></pre>
<p>Cualquier viaje inferior a 8.8 horas será un viaje seguro, mientras que si el tiempo es superior, la probabilidad de no tener un viaje seguro aumenta.</p>
<p>Para estudiar la estabilidad de dichas probabilidades realizamos 1000 simulaciones del sistema y estimamos las probabilidades mediante estimadores Monte-Carlo de los tiempos de fallo.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">Tfallo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Repetición del sistema y calculo de tiempo </span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">sistema</span> <span class="op">&lt;-</span> <span class="fu">TSIM_aviones</span><span class="op">(</span><span class="va">tasa</span><span class="op">)</span>
  <span class="va">Tfallo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">sistema</span><span class="op">$</span><span class="va">tiempo</span><span class="op">[</span><span class="va">sistema</span><span class="op">$</span><span class="va">fallos</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Estimador Monte-Carlo</span>
<span class="va">estimMC</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Tfallo</span><span class="op">)</span>
<span class="co"># Duración del vuelo</span>
<span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Probabilidad viaje seguro</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">estimMC</span> <span class="op">&gt;=</span> <span class="va">td</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">estimMC</span><span class="op">/</span><span class="va">td</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Obtenemos el valor mínimo de tiempo para asegurar un viaje seguro</span>
<span class="va">limite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">td</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">prob</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">limite</span></code></pre></div>
<pre><code>## [1] 11.9</code></pre>
<p>Cualquier viaje inferior a 11.9 horas será un viaje seguro, mientras que si el tiempo es superior, la probabilidad de no tener un viaje seguro aumenta. Podemos representar el gráfico de probabilidad de un viaje seguro:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-027"></span>
<img src="04-CMTC_files/figure-html/05-027-1.png" alt="Probabilidad de un viaje seguro" width="95%"><p class="caption">
Figura 4.5: Probabilidad de un viaje seguro
</p>
</div>
</div>
</div>
<div id="CMTCD" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Procesos de nacimiento y muerte<a class="anchor" aria-label="anchor" href="#CMTCD"><i class="fas fa-link"></i></a>
</h2>
<p>Los procesos de nacimiento y muerte que estudiamos en este apartado juegan un papel muy importante dentro de las CMTC, ya que son de uso habitual en muchas aplicaciones prácticas que veremos de ahora en adelante.</p>
<div class="yellowbox">
<div class="definition">
<p><span id="def:cmtc002" class="definition"><strong>Definición 4.2  </strong></span>Una CMTC <span class="math inline">\(\{X_t; t \geq 0\}\)</span> con espacio de estados <span class="math inline">\(S = \{0, 1, 2,...,N\}\)</span> y matriz de tasas dada por:</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; \lambda_0 &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
\mu_1 &amp; 0 &amp; \lambda_1 &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
0 &amp; \mu_2 &amp; 0 &amp; \lambda_2 &amp; \ldots &amp; 0 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ldots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; \lambda_{N-1} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp;\mu_N &amp; 0
\end{pmatrix} \]</span></p>
<p>se denomina proceso finito de nacimiento y muerte donde los <span class="math inline">\(\lambda_i\)</span> se denominan <strong>parámetros de nacimiento</strong> (transición del estado <span class="math inline">\(i\)</span> al <span class="math inline">\(i+1\)</span>) y los <span class="math inline">\(\mu_i\)</span> se denominan <strong>parámetros de muerte</strong> (transición del estado <span class="math inline">\(i\)</span> al <span class="math inline">\(i-1)\)</span>, donde por conveniencia se asume que <span class="math inline">\(\lambda_K = 0\)</span> y <span class="math inline">\(\mu_0 = 0\)</span> indicando que no hay nacimientos en el estado <span class="math inline">\(K\)</span> y que no hay muertes en el estado <span class="math inline">\(0\)</span>.</p>
</div>
</div>
<p>En esta situación el proceso permanece una cantidad de tiempo <span class="math inline">\(exp(\lambda_i + \mu_i)\)</span> en el estado <span class="math inline">\(i\)</span> y después salta al estado <span class="math inline">\(i+1\)</span> con probabilidad <span class="math inline">\(\lambda_i/(\lambda_i + \mu_i)\)</span>, o al estado <span class="math inline">\(i-1\)</span> con probabilidad <span class="math inline">\(\mu_i/(\lambda_i + \mu_i)\)</span>. Además, la matriz generadora del proceso viene dada por:</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
- \lambda_0&amp; \lambda_0 &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
\mu_1 &amp; -(\mu_1 + \lambda_1) &amp; \lambda_1 &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
0 &amp; \mu_2 &amp; -(\mu_2 + \lambda_2) &amp; \lambda_2 &amp; \ldots &amp; 0 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ldots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp; -(\mu_{k-1} + \lambda_{k-1}) &amp; \lambda_{k-1} \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp; \mu_k &amp; -\mu_k
\end{pmatrix} \]</span></p>
<p>A continuación presentamos diferentes ejemplos de aplicación de los procesos de nacimiento y muerte.</p>
<div id="colas-de-espera-de-capacidad-finita-con-un-servidor" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> Colas de espera de capacidad finita con un servidor<a class="anchor" aria-label="anchor" href="#colas-de-espera-de-capacidad-finita-con-un-servidor"><i class="fas fa-link"></i></a>
</h3>
<p>Aunque en la unidad siguiente estudiaremos con mucho más detalle los diferentes sistemas de colas de espera, vamos a presentar aquí el modelo más sencillo de colas, para comprobar que se puede modelar como un proceso de nacimiento y muerte.</p>
<p>Imaginemos que tenemos un cajero bancario al que los clientes acuden de acuerdo a Proceso de Poisson de parámetro <span class="math inline">\(\lambda\)</span>, es decir que las llegadas son aleatorias y se distribuyen según una <span class="math inline">\(Exp(\lambda)\)</span>. Si hay <span class="math inline">\(K-1\)</span> clientes haciendo cola para ser atendidos, un cliente nuevo tomará la opción de buscar otro cajero, es decir, el sistema tiene capacidad <span class="math inline">\(K\)</span> (1 cliente atendido y <span class="math inline">\(K-1\)</span> en la cola de espera). Además, el tiempo de servicio del cajero tiene una distribución <span class="math inline">\(Exp(\mu)\)</span>.</p>
<p>En esta situación la variable <span class="math inline">\(X(t)\)</span> que indica el número de sujetos en el sistema en el instante <span class="math inline">\(t\)</span> es una CMTC denominada cola <span class="math inline">\(M/M/1/K\)</span>, donde <span class="math inline">\(M\)</span> hace referencia a los tiempos de llegada y servicio exponenciales, el <span class="math inline">\(1\)</span> hace referencia a la capacidad del servicio (sólo un cliente puede ser atendido en un instante dado), <span class="math inline">\(K\)</span> es el tamaño del sistema (o aforo total), y <span class="math inline">\(S = \{0, 1, 2,...K \}\)</span> el espacio de estados. Este tipo de sistemas son procesos de nacimiento y muerte con:</p>
<p><span class="math display">\[\begin{eqnarray*}
\lambda_i &amp;=&amp; \lambda, \quad 0 \leq i \leq K-1, \\
\mu_i &amp;=&amp; \mu, \quad 0 \leq i \leq K,
\end{eqnarray*}\]</span></p>
<p>donde el “nacimiento” y la “muerte” hacen referencia a la llegada al cajero y la salida del cajero respectivamente.</p>
<p>Veamos la descripción del sistema:</p>
<ul>
<li><p>En el estado <span class="math inline">\(X_t=0\)</span> el sistema está vacío y el único evento que puede ocurrir es una llegada, que se produce después de un tiempo <span class="math inline">\(Exp(\lambda)\)</span>, provocando una transición al estado <span class="math inline">\(X_t=1\)</span>. En este caso <span class="math inline">\(r_{01} = \lambda\)</span>.</p></li>
<li><p>En el estado <span class="math inline">\(X_t=i\)</span> (<span class="math inline">\(1 \leq i \leq K-1\)</span>), tenemos dos posibilidades en el sistema: una llegada o una salida. En el primer caso tenemos <span class="math inline">\(r_{i, i+1} = \lambda\)</span>, mientras que en el segundo tenemos <span class="math inline">\(r_{i, i-1} = \mu\)</span>.</p></li>
<li><p>En el estado <span class="math inline">\(X_t=K\)</span> sólo se puede producir una salida de forma que <span class="math inline">\(r_{K, K-1} = \mu\)</span>.</p></li>
</ul>
<p>Por tanto, la matriz de tasas correspondiente a este proceso viene dada por:</p>
<p><span class="math display">\[R = 
\begin{pmatrix}
0 &amp; \lambda &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
\mu &amp; 0 &amp; \lambda &amp; 0 &amp; \ldots &amp; 0 &amp; 0 \\
0 &amp; \mu &amp; 0 &amp; \lambda &amp; \ldots &amp; 0 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ldots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; \lambda \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; \ldots &amp;\mu &amp; 0
\end{pmatrix} \]</span></p>
<p>El diagrama de tasas para una cola <span class="math inline">\(M/M/1/4\)</span>, es decir con una capacidad de 4 usuarios en el sistema (1 atendido y tres en espera) es:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-028"></span>
<img src="04-CMTC_files/figure-html/05-028-1.png" alt="Diagrama de tasas para cola M/M/1/4." width="95%"><p class="caption">
Figura 4.6: Diagrama de tasas para cola M/M/1/4.
</p>
</div>
<p>Este sistema puede implementarse fácilmente en <code>simmer</code> si entendemos como “resource” al servicio del cajero y como “generator” la llegada al cajero. Escribimos el algoritmo de forma general para cualquier valor de <span class="math inline">\(K\)</span>.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sistema</span>
<span class="co">#################################################</span>
<span class="va">cola.MM1K</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">servidores</span>, <span class="va">usuarios</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># lambda: tasa de llegadas</span>
  <span class="co"># mu: tasa de servicio</span>
  <span class="co"># servidores: número de servidores</span>
  <span class="co"># usuarios: capacidad total del sistema</span>
  <span class="va">cola</span> <span class="op">&lt;-</span> <span class="va">usuarios</span> <span class="op">-</span> <span class="va">servidores</span>
  
  <span class="va">servicio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="co"># empieza a ser atendido</span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   
    <span class="co"># durante un tiempo exp(mu)</span>
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="co"># termina el servicio de atención</span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>               

  <span class="co"># Configuración del sistema </span>
  <span class="co">#################################################</span>
  <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="co"># se crean los recursos (servidores) y se dimensiona la cola</span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, capacity <span class="op">=</span> <span class="va">servidores</span>, queue_size <span class="op">=</span> <span class="va">cola</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    
    <span class="co"># se generan las llegadas de clientes según Exp(lambda)</span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>, <span class="va">servicio</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until <span class="op">=</span> <span class="va">t</span><span class="op">)</span>     
<span class="op">}</span></code></pre></div>
<p>Imaginemos que por la mañanas (de 8 a 15) las llegadas de clientes se producen con una tasa de 15 clientes/hora, mientras que el tiempo medio que el cliente permanece en el cajero es de 6 minutos. Expresada en minutos tendríamos una tasa de llegadas <span class="math inline">\(\lambda = 15/60\)</span>, y una tasa de servicio <span class="math inline">\(\mu = 1/6\)</span>. Se ha observado además que cuando la cola de espera es de tres clientes nadie más espera para hacer cola (<span class="math inline">\(K = 4\)</span>). Analizamos el sistema de forma básica para una mañana cualquiera, es decir para un periodo de 7 horas (420 minutos).</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="co">### Simulación del sistema</span>
<span class="va">t</span><span class="op">=</span><span class="fl">420</span>; 
<span class="va">lambda</span><span class="op">=</span><span class="fl">15</span><span class="op">/</span><span class="fl">60</span>; <span class="va">mu</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">6</span>
<span class="va">servidores</span><span class="op">=</span><span class="fl">1</span>; <span class="va">usuarios</span><span class="op">=</span><span class="fl">4</span>
<span class="va">cajero</span> <span class="op">&lt;-</span> <span class="fu">cola.MM1K</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">servidores</span>, <span class="va">usuarios</span><span class="op">)</span>
<span class="co">### Salidas del sistema</span>
<span class="va">cajero.df.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">cajero</span><span class="op">)</span>  <span class="co"># recursos (servidores)</span>
<span class="va">cajero.df.arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">cajero</span><span class="op">)</span>   <span class="co"># llegadas (clientes)</span></code></pre></div>
<p>Veamos con un poco de detalle las salidas que proporciona el sistema. Comenzamos con el proceso de llegadas al sistema viendo las primeras 10 llegadas al sistema:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cajero.df.arr</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##         name start_time  end_time activity_time finished replication
## 1   llegada0   8.756865  9.461164      0.704299     TRUE           1
## 2   llegada1  11.299066 22.198513     10.899446     TRUE           1
## 3   llegada2  22.728061 46.307530     23.579469     TRUE           1
## 4   llegada7  53.191599 53.191599      0.000000    FALSE           1
## 5   llegada3  23.861384 53.496376      7.188846     TRUE           1
## 6   llegada9  57.528321 57.528321      0.000000    FALSE           1
## 7   llegada4  40.759227 59.558394      6.062018     TRUE           1
## 8  llegada11  68.130173 68.130173      0.000000    FALSE           1
## 9  llegada12  74.418248 74.418248      0.000000    FALSE           1
## 10  llegada5  45.814971 75.428935     15.870541     TRUE           1</code></pre>
<p>En la columna <code>name</code> tenemos el identificador de la llegada al sistema (cajero), en las columnas <code>start_time</code> y <code>end_time</code> tenemos el instante de tiempo en el que llega y sale del cajero. La columna <code>activity_time</code> muestra el tiempo de servicio en el cajero (durante el que es atendido el cliente); un valor 0 identifica a un cliente que no ha sido atendido porque sobrepasó la capacidad del sistema (no esperó al ver la cola y se marchó). Estos coinciden con los valores <code>FALSE</code> de la columna <code>finished</code>, que identifica a los clientes que no han podido ser atendidos. Con estas salidas resulta muy fácil calcular el tiempo de servicio del sistema así como el porcentaje de clientes rechazados, y el tiempo esperando en la cola.</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># llegadas al sistema: número de clientes que han pasado por el cajero</span>
<span class="va">nsis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cajero.df.arr</span><span class="op">)</span>;<span class="va">nsis</span></code></pre></div>
<pre><code>## [1] 108</code></pre>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tiempo total de servicio</span>
<span class="va">tserver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">cajero.df.arr</span><span class="op">$</span><span class="va">activity_time</span><span class="op">)</span>;<span class="va">tserver</span></code></pre></div>
<pre><code>## [1] 407.9837</code></pre>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># proporción de tiempo que el sistema está ocupado (atendiendo o en espera)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">tserver</span><span class="op">/</span><span class="va">t</span>,<span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 97.14</code></pre>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># porcentaje de clientes que se marcharon sin ser atendidos</span>
<span class="va">rechazados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">cajero.df.arr</span><span class="op">$</span><span class="va">finished</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">rechazados</span><span class="op">/</span><span class="va">nsis</span>,<span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 48.15</code></pre>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Tiempos de espera en cola para ser atendido</span>
<span class="va">tespera</span> <span class="op">&lt;-</span> <span class="va">cajero.df.arr</span><span class="op">$</span><span class="va">end_time</span> <span class="op">-</span> <span class="va">cajero.df.arr</span><span class="op">$</span><span class="va">start_time</span> <span class="op">-</span> <span class="va">cajero.df.arr</span><span class="op">$</span><span class="va">activity_time</span>
<span class="co"># tiempo medio de espera en cola y desv.típica</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tespera</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">tespera</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 8.280251</code></pre>
<pre><code>## [1] 10.53434</code></pre>
<p>Podemos estudiar el comportamiento del sistema, y en particular de la cola, también en términos de los servidores.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cajero.df.res</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##      resource      time server queue capacity queue_size system limit replication
## 1  atendiendo  8.756865      1     0        1          3      1     4           1
## 2  atendiendo  9.461164      0     0        1          3      0     4           1
## 3  atendiendo 11.299066      1     0        1          3      1     4           1
## 4  atendiendo 22.198513      0     0        1          3      0     4           1
## 5  atendiendo 22.728061      1     0        1          3      1     4           1
## 6  atendiendo 23.861384      1     1        1          3      2     4           1
## 7  atendiendo 40.759227      1     2        1          3      3     4           1
## 8  atendiendo 45.814971      1     3        1          3      4     4           1
## 9  atendiendo 46.307530      1     2        1          3      3     4           1
## 10 atendiendo 48.326016      1     3        1          3      4     4           1</code></pre>
<p>En este caso las columnas nos informan sobre el instante de tiempo (<code>time</code>) en el que se produce alguna actividad en el sistema, la columna <code>server</code> indica el número de servidores ocupados atendiendo a algún cliente, <code>queue</code> el número de clientes en la cola de espera, <code>capacity</code> la capacidad de servicio del sistema, <code>queue_size</code> el tamaño máximo de la cola, <code>system</code> el número de clientes en el sistema, <code>limit</code> la capacidad total de sistema, y finalmente <code>replication</code> da un indicador de la replicación de las simulaciones.</p>
<p>Con estas salidas podemos describir fácilmente el comportamiento de la cola del sistema ya que podemos estudiar el número de clientes en cola a lo largo del tiempo.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Evolución del tamaño de la cola</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cajero.df.res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">queue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">420</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tiempo (en minutos)"</span>, y <span class="op">=</span> <span class="st">"Tamaño de la cola"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-CMTC_files/figure-html/05-034-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Porcentaje de clientes en cola</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cajero.df.res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">queue</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..prop..</span> , group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Clientes en la cola"</span>, y <span class="op">=</span> <span class="st">"Porcentaje"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-CMTC_files/figure-html/05-034-2.png" width="95%" style="display: block; margin: auto;"></div>
<p>Simulamos ahora el sistema en 500 ocasiones para inferir con mayor precisión el comportamiento del sistema.</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Réplicas del sistema</span>
<span class="va">nreplicas</span><span class="op">=</span><span class="fl">500</span>
<span class="va">t</span><span class="op">=</span><span class="fl">420</span>; 
<span class="va">lambda</span><span class="op">=</span><span class="fl">15</span><span class="op">/</span><span class="fl">60</span>; <span class="va">mu</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">6</span>
<span class="va">servidores</span><span class="op">=</span><span class="fl">1</span>; <span class="va">usuarios</span><span class="op">=</span><span class="fl">4</span>

<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">nreplicas</span>,<span class="fu">cola.MM1K</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">servidores</span>, <span class="va">usuarios</span><span class="op">)</span><span class="op">)</span>
<span class="co"># almacenamos análisis de llegadas del sistema</span>
<span class="va">simarrivals</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>

<span class="va">salida</span><span class="op">&lt;-</span><span class="va">simarrivals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Resumen de las simualciones</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>clientes <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, 
            tiemposervicio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">activity_time</span><span class="op">)</span>,
            proptiemposervicio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">tiemposervicio</span><span class="op">/</span><span class="fl">420</span>, <span class="fl">2</span><span class="op">)</span>,
            rechazados <span class="op">=</span> <span class="va">clientes</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">finished</span><span class="op">)</span>,
            proprechazados <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rechazados</span><span class="op">/</span><span class="va">clientes</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>media_clientes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">clientes</span><span class="op">)</span>,
            media_tserver <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tiemposervicio</span><span class="op">)</span>,
            media_ptserver <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">proptiemposervicio</span><span class="op">)</span>,
            media_rechazados <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rechazados</span><span class="op">)</span>,
            media_prechazados <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">proprechazados</span><span class="op">)</span>
            <span class="op">)</span>
<span class="va">salida</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   media_clientes media_tserver media_ptserver media_rechazados media_prechazados
##            &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
## 1           102.          377.           89.8             37.9              36.7</code></pre>
<blockquote>
<p>Para comentar: ¿Qué conclusiones extraemos del análisis realizado? ¿Cómo valorarías la ocupación del sistema? ¿Qué ocurriría si añadimos un nuevo cajero y ampliamos la capacidad del sistema a 8 clientes?</p>
</blockquote>
</div>
<div id="excmtc007" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Mantenimiento de máquinas<a class="anchor" aria-label="anchor" href="#excmtc007"><i class="fas fa-link"></i></a>
</h3>
<p>El problema del mantenimiento de máquinas es muy habitual dentro de las CMTC. Supongamos que disponemos de <span class="math inline">\(N\)</span> máquinas que funcionan durante 24 horas seguidas y <span class="math inline">\(M\)</span> personas que pueden repararlas (<span class="math inline">\(M \leq N\)</span>). Las máquinas son idénticas, y los tiempos de vida de las máquinas (reparaciones o mantenimiento) son variables aleatorias independientes <span class="math inline">\(Exp(\mu)\)</span>. Cuando las máquinas fallan, son reparadas por orden de fallo (la primera que falla es la primera en ser reparada) por los <span class="math inline">\(M\)</span> reparadores. Cada máquina averiada necesita una y sólo una persona para repararla, y los tiempos de reparación se distribuyen como una <span class="math inline">\(Exp(\lambda)\)</span>; una vez reparada, la máquina continúa comportándose como una máquina nueva. Si <span class="math inline">\(X(t)\)</span> el número de máquinas que funcionan en el momento <span class="math inline">\(t\)</span>, el proceso <span class="math inline">\(\{X(t), t \geq 0\}\)</span> es un proceso de nacimiento (avería) y muerte (reparación) con parámetros:</p>
<p><span class="math display">\[\lambda_i = \lambda \cdot min(N-i, M), \quad 0 \leq i \leq N,\]</span></p>
<p><span class="math display">\[\mu_i = \mu \cdot i, \quad 0 \leq i \leq N.\]</span>
::: example</p>
<p>Imaginemos un problema sencillo de mantenimiento de máquinas, que se puede generalizar fácilmente, en el que tenemos 4 máquinas y 2 reparadores, de forma que el espacio de estados (número de máquinas en funcionamiento) viene dado por <span class="math inline">\(S = \{0, 1, 2, 3, 4\}\)</span>. En este ejemplo vamos a ver cómo los parámetros de nacimiento y muerte corresponden con los que acabamos de definir.</p>
<p>:::</p>
<p>Descripción del sistema:</p>
<ul>
<li><p>En el estado <span class="math inline">\(X(t)=0\)</span>, todas las máquinas están estropeadas, dos se encuentran en reparación (puesto que hay dos reparadores) y dos esperando a ser reparadas, Los tiempos de reparación son iid <span class="math inline">\(Exp(\lambda)\)</span> y un vez se complete cualquiera de las dos repaciones el sistema cambiará al estado 1. De esta forma, <span class="math inline">\(r_{01} = \lambda_0 = \lambda + \lambda = 2\lambda\)</span>.</p></li>
<li><p>En el estado <span class="math inline">\(X(t)=1\)</span>, una máquina está en funcionamiento, hay dos en reparación y otra está en espera. Cuando una de las dos máquinas es reparada pasamos al estado 2. De esta forma, <span class="math inline">\(r_{12} = \lambda_1 = 2\lambda\)</span>. Además, en este estado la máquina que está funcionando puede fallar después de mantenerse en funcionamiento un tiempo <span class="math inline">\(Exp(\mu)\)</span> volviendo al estado 0, de forma que, <span class="math inline">\(r_{10} = \mu_1 = \mu\)</span>.</p></li>
<li><p>En el estado <span class="math inline">\(X(t)=2\)</span>, con razonamientos similares, tendremos que <span class="math inline">\(r_{23} = \lambda_2 = 2\lambda\)</span> y <span class="math inline">\(r_{21} = \mu_2 = 2\mu\)</span>.</p></li>
<li><p>Para el resto de estados tendremos que <span class="math inline">\(r_{34} = \lambda_3 = \lambda\)</span>, <span class="math inline">\(r_{32} = mu_3 = 3\mu\)</span>, y <span class="math inline">\(r_{43} = \mu_4 = 4\mu\)</span>.</p></li>
</ul>
<p>En esta situación el diagrama del proceso viene dado por:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:05-036"></span>
<img src="04-CMTC_files/figure-html/05-036-1.png" alt="Diagrama de tasas para el mantenimiento de máquinas" width="95%"><p class="caption">
Figura 4.7: Diagrama de tasas para el mantenimiento de máquinas
</p>
</div>
<p>Este sistema se puede modelizar fácilmente en <code>simmer</code> sin más que fijar las tasas correspondientes, el número de máquinas disponibles, y el número de operarios. Supongamos que los tiempos de vida de las máquinas son variables aleatorias exponenciales con media de 3 días, mientras que los tiempos de reparación son variables exponenciales con media de 2 horas. Expresando todo en horas, tendríamos una tasa de reparación de <span class="math inline">\(\mu = 1/2\)</span>, y una tasa de llegadas <span class="math inline">\(\lambda = 1/72\)</span>.</p>
<p>De nuevo planteamos una función que nos permita cambiar fácilmente los parámetros del sistema si fuera necesario. La empresa está interesada en:</p>
<ul>
<li>¿Cuántas máquinas estarán en funcionamiento después de 3 días?</li>
<li>¿Durante qué porcentaje del tiempo las cuatro máquinas están funcionando?</li>
</ul>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sistema</span>
<span class="co">#################################################</span>
<span class="va">mantenimiento</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">capacidad</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># lambda: tasa de reparación</span>
  <span class="co"># mu: tasa de vida de la máquina</span>
  <span class="co"># capacidad: reparadores</span>
  <span class="co"># K: máquinas</span>
  
  <span class="co"># Distribuciones de tiempos</span>
  <span class="va">vida</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span>
  <span class="va">reparacion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span>
  
  <span class="co"># Trayectoria </span>
  <span class="va">maquina</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"funcionando"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">vida</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"funcionando"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"reparando"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">reparacion</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"reparando"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    
    <span class="fu"><a href="https://r-simmer.org/reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>

  <span class="co"># Configuración del sistema </span>
  <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"funcionando"</span>, capacity <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"reparando"</span>, capacity <span class="op">=</span> <span class="va">capacidad</span>, queue_size <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"sistema"</span>, <span class="va">maquina</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until <span class="op">=</span> <span class="va">t</span><span class="op">)</span>     
<span class="op">}</span></code></pre></div>
<p>Simulamos el sistema y analizamos un poco la salida. Dado que en este sistema no hay llegadas solo podemos estudiar los recursos.</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">=</span><span class="fl">72</span> <span class="co"># 3 días</span>
<span class="va">lambda</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">72</span>; <span class="va">mu</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">capacidad</span><span class="op">=</span><span class="fl">2</span> <span class="co"># nº reparadores</span>
<span class="co">### Simulación del sistema</span>
<span class="va">maquinas</span> <span class="op">&lt;-</span> <span class="fu">mantenimiento</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>,<span class="va">mu</span>, <span class="va">capacidad</span><span class="op">)</span>
<span class="co">### Salidas del sistema</span>
<span class="va">maquinas.df.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">maquinas</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">maquinas.df.res</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##       resource     time server queue capacity queue_size system limit replication
## 1  funcionando  0.00000      1     0      Inf        Inf      1   Inf           1
## 2  funcionando  0.00000      2     0      Inf        Inf      2   Inf           1
## 3  funcionando  0.00000      3     0      Inf        Inf      3   Inf           1
## 4  funcionando  0.00000      4     0      Inf        Inf      4   Inf           1
## 5  funcionando 39.64840      3     0      Inf        Inf      3   Inf           1
## 6    reparando 39.64840      1     0        2        Inf      1   Inf           1
## 7    reparando 40.91384      0     0        2        Inf      0   Inf           1
## 8  funcionando 40.91384      4     0      Inf        Inf      4   Inf           1
## 9  funcionando 63.84362      3     0      Inf        Inf      3   Inf           1
## 10   reparando 63.84362      1     0        2        Inf      1   Inf           1</code></pre>
<p>Respondemos en primer lugar al número de máquinas en funcionamiento a los tres días</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># última iteración del sistema</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">maquinas.df.res</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>##       resource     time server queue capacity queue_size system limit replication
## 12 funcionando 65.62617      4     0      Inf        Inf      4   Inf           1</code></pre>
<p>A las 72 horas el número de máquinas funcionando se corresponde con el valor de <code>server</code>. Para conocer el tiempo que las cuatro máquinas han estado funcionando debemos manipular los resultados obtenidos en el proceso de simulación.</p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Seleccionamos todos los recursos cuando las máquinas están funcionando</span>
<span class="va">maquinas.df.sel</span> <span class="op">&lt;-</span> <span class="va">maquinas.df.res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">resource</span> <span class="op">==</span> <span class="st">"funcionando"</span><span class="op">)</span>
<span class="co">### Calculamos los tiempos de funcionamiento</span>
<span class="va">deltas_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
<span class="co">### Seleccionamos cuando las 4 máquinas están activas</span>
<span class="va">both_working_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">system</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">t_both_working_4</span> <span class="op">&lt;-</span> <span class="va">deltas_4</span><span class="op">[</span><span class="va">both_working_4</span><span class="op">]</span>
<span class="co">### Caculamos la proporción de tiempo</span>
<span class="va">res</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">t_both_working_4</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></code></pre></div>
<p>La proporción de tiempo en que las cuatro máquinas están funcionando simultáneamente es 95.36. Estudiamos la estabilidad del sistema realizando 500 simulaciones del sistema y estimando las cantidades de interés para la empresa.</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Réplicas del sistema</span>
<span class="va">replicas</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">replicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
  <span class="va">maquinas</span> <span class="op">&lt;-</span> <span class="fu">mantenimiento</span><span class="op">(</span><span class="fl">72</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">72</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># almacenamos análisis de llegadas del sistema</span>
<span class="va">simresources</span><span class="op">&lt;-</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="co">## funciones para calcular cantidades de interés</span>
<span class="va">maquinasON</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">propTimeON</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">datos</span> <span class="op">&lt;-</span> <span class="va">simresources</span><span class="op">[</span><span class="va">simresources</span><span class="op">$</span><span class="va">replication</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span>
  <span class="co"># máquinas en funcionamiento</span>
  <span class="va">maquinasON</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">datos</span>, <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">server</span>
  <span class="co"># Proporción de tiempo</span>
  <span class="va">maquinas.df.sel</span> <span class="op">&lt;-</span> <span class="va">datos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">resource</span> <span class="op">==</span> <span class="st">"funcionando"</span><span class="op">)</span>
  <span class="co">### Calculamos los tiempos de funcionamiento</span>
  <span class="va">deltas_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
  <span class="co">### Seleccionamos cuando las 4 máquinas están activas</span>
  <span class="va">both_working_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">system</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>
  <span class="va">t_both_working_4</span> <span class="op">&lt;-</span> <span class="va">deltas_4</span><span class="op">[</span><span class="va">both_working_4</span><span class="op">]</span>
  <span class="co">### Caculamos la proporción de tiempo</span>
  <span class="va">propTimeON</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">t_both_working_4</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">maquinas.df.sel</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Tenemos entonces que el número de máquinas en funcionamiento es 1.97 y el tiempo de funcionamiento de las cuatro máquinas estimado es 3.58 para un periodo de 72 horas cuando al inicio todas las máquinas están paradas.</p>
</div>
<div id="central-telefónica" class="section level3" number="4.4.3">
<h3>
<span class="header-section-number">4.4.3</span> Central telefónica<a class="anchor" aria-label="anchor" href="#central-telef%C3%B3nica"><i class="fas fa-link"></i></a>
</h3>
<p>Una centralita telefónica puede atender <span class="math inline">\(K\)</span> llamadas a la vez en un momento dado. Las llamadas llegan según un proceso de Poisson con tasa <span class="math inline">\(\lambda\)</span>. Si la centralita ya está atendiendo <span class="math inline">\(K\)</span> llamadas cuando llega una nueva llamada, ésta se pierde. Si una llamada es aceptada, dura un tiempo <span class="math inline">\(Exp(\mu)\)</span> y luego termina. Todas las llamadas son independientes entre sí. Sea <span class="math inline">\(X(t)\)</span> el número de llamadas que la centralita gestiona en el momento <span class="math inline">\(t\)</span>.</p>
<p>El proceso <span class="math inline">\(\{X(t); t \geq 0\}\)</span> es una CMTC con espacio de estados <span class="math inline">\(S = \{0, 1, 2,...,K\}\)</span> de forma que:</p>
<ul>
<li><p>En el estado <span class="math inline">\(i\)</span>, con <span class="math inline">\(0 \leq i \leq K-1\)</span> la llegada de una llamada desencadena una transición al estado <span class="math inline">\(i+1\)</span> con tasa <span class="math inline">\(\lambda\)</span> (<span class="math inline">\(r_{i i+1} = \lambda\)</span>), mientras que en el estado <span class="math inline">\(K\)</span> no se pueden recibir llamadas.</p></li>
<li><p>En el estado <span class="math inline">\(i\)</span>, con <span class="math inline">\(1 \leq i \leq K\)</span> cualquiera de las llamadas <span class="math inline">\(i\)</span> puede completarse y desancedar una transición al estado <span class="math inline">\(i-1\)</span>. La tasa de transición es <span class="math inline">\(r_{i i-1} = i\mu\)</span>. En el estado 0 no hay salidas.</p></li>
</ul>
<p>El sistema <span class="math inline">\(\{X(t); t \geq 0\}\)</span> es un proceso de nacimiento y muerte con:</p>
<p><span class="math display">\[\lambda_i = \lambda, \quad 0 \leq i \leq K-1\]</span> <span class="math display">\[\mu_i = i\mu, \quad 0 \leq i \leq K\]</span> que como veremos más adelante se denomina cola <span class="math inline">\(M/M/K/K\)</span>, es decir, llegadas y servicios exponenciales con <span class="math inline">\(K\)</span> servidores y de capacidad <span class="math inline">\(K\)</span>.</p>
<p>La función de simmer para estudiar este sistema viene dada por:</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sistema</span>
<span class="co">#################################################</span>
<span class="va">cola.MMKK</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">lambda</span>, <span class="va">mu</span>, <span class="va">servidores</span>, <span class="va">usuarios</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># lambda: tasa de llegadas</span>
  <span class="co"># mu: tasa de servicio</span>
  <span class="co"># servidores: número de servidores</span>
  <span class="co"># usuarios: capacidad total del sistema</span>
  <span class="va">cola</span> <span class="op">&lt;-</span> <span class="va">usuarios</span> <span class="op">-</span> <span class="va">servidores</span>
  
  <span class="va">servicio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>              
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, amount <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>               

  <span class="co"># Configuración del sistema </span>
  <span class="co">#################################################</span>
  <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"atendiendo"</span>, capacity <span class="op">=</span> <span class="va">servidores</span>, queue_size <span class="op">=</span> <span class="va">cola</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           
    <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>, <span class="va">servicio</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until <span class="op">=</span> <span class="va">t</span><span class="op">)</span>     
<span class="op">}</span></code></pre></div>
</div>
<div id="call-center" class="section level3" number="4.4.4">
<h3>
<span class="header-section-number">4.4.4</span> Call Center<a class="anchor" aria-label="anchor" href="#call-center"><i class="fas fa-link"></i></a>
</h3>
<p>El sistema de reservas telefónicas de una aerolínea es un “call center” formado por <span class="math inline">\(s\)</span> empleados de reservas llamados agentes. Una llamada entrante para una reserva es atendida por un agente si hay uno disponible; de lo contrario, la persona que llama es puesta en espera. El sistema puede poner en espera a un máximo de <span class="math inline">\(H\)</span> personas. Cuando un agente está disponible, las llamadas en espera se atienden por orden de llegada. Cuando todos los agentes están ocupados y hay <span class="math inline">\(H\)</span> llamadas en espera, cualquier llamada adicional recibe una señal de ocupado y se pierden permanentemente. Sea <span class="math inline">\(X(t)\)</span> la varaible aleatoria que registra el número de llamadas en el sistema, las atendidas por los agentes más las que están en espera, en el momento <span class="math inline">\(t\)</span> . Si las llamadas recibidas se comportan como un <span class="math inline">\(PP(\lambda)\)</span> y los tiempos de procesamiento de las llamadas son variables aleatorias iid <span class="math inline">\(Exp(\mu)\)</span>, el sistema <span class="math inline">\(\{X(t); t \geq 0\}\)</span> es una CMTC, con espacio de estados <span class="math inline">\(S = \{0, 1, 2,...,K\}\)</span> donde <span class="math inline">\(K = s + H\)</span>.</p>
<p>Se puede demostrar fácilmente que este sistema es un proceso de nacimiento y muerte con tasas:</p>
<p><span class="math display">\[\lambda_i = \lambda, \quad 0 \leq i \leq K-1\]</span> <span class="math display">\[\mu_i = min(i, s)\mu, \quad 0 \leq i \leq K\]</span> que en la terminologia habitual se denomina cola <span class="math inline">\(M/M/s/K\)</span>. Para simular este proceso podemos utilizar la función del ejemplo anterior.</p>
</div>
</div>
<div id="CMTCE" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Otros tipos de sistemas<a class="anchor" aria-label="anchor" href="#CMTCE"><i class="fas fa-link"></i></a>
</h2>
<p>Presentamos en este punto otros sistemas que no se corresponden con procesos de nacimiento y muerte, pero que son muy habituales en el mundo real.</p>
<div id="gestión-de-inventarios" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Gestión de inventarios<a class="anchor" aria-label="anchor" href="#gesti%C3%B3n-de-inventarios"><i class="fas fa-link"></i></a>
</h3>
<p>Una tienda minorista gestiona el inventario de un tipo de producto, que denominamos <span class="math inline">\(P\)</span>, de la forma siguiente. Cuando el número de elementos de <span class="math inline">\(P\)</span> disminuye a un número fijo <span class="math inline">\(l\)</span>, se hace un pedido al fabricante de <span class="math inline">\(m\)</span> repuestos de <span class="math inline">\(P\)</span>. El pedido tarda un tiempo aleatorio en ser entregado al minorista. Si el inventario es como máximo <span class="math inline">\(l\)</span> cuando se entrega un pedido (incluido el pedido recién entregado), se realiza inmediatamente otro pedido de <span class="math inline">\(m\)</span> artículos. Supongamos que que los plazos de entrega son variables aleatorias iid <span class="math inline">\(Exp(\lambda)\)</span> y que la demanda se produce según un <span class="math inline">\(PP(\mu)\)</span>. Las demandas que no pueden ser satisfechas inmediatamente se pierden.</p>
<p>Sea <span class="math inline">\(X(t)\)</span> el número de elementos de <span class="math inline">\(P\)</span> en stock en el momento <span class="math inline">\(t\)</span>. Obsérvese que el número máximo de elemntos de <span class="math inline">\(P\)</span> en stock es <span class="math inline">\(K = l + m\)</span>, lo que ocurre si el pedido se entrega antes de que se produzca la siguiente demanda. El espacio de estados es, pues, <span class="math inline">\(S = \{0, 1, 2,...,K\}\)</span>. En el estado <span class="math inline">\(0\)</span>, las demandas se pierden, y el stock salta a <span class="math inline">\(m\)</span> cuando se entrega el pedido pendiente actual (lo que ocurre a la tasa <span class="math inline">\(\lambda\)</span>). Por tanto, tenemos <span class="math inline">\(r_{0m} = \lambda\)</span>. En el estado <span class="math inline">\(i\)</span> <span class="math inline">\((1 \leq i \leq l)\)</span> hay un pedido pendiente. El estado cambia a <span class="math inline">\(i-1\)</span> si se produce una demanda (lo que ocurre a la tasa <span class="math inline">\(\mu\)</span>) y a <span class="math inline">\(i + m\)</span> si se entrega el pedido. Por lo tanto, tenemos <span class="math inline">\(r_{i i+m} = \lambda\)</span> y <span class="math inline">\(r_{i i-1} = \mu\)</span>. Finalmente, si <span class="math inline">\(X(t) = i\)</span> (<span class="math inline">\(l + 1 \leq i \ K\)</span>), no hay pedidos pendientes, y la única transición es de <span class="math inline">\(i\)</span> a <span class="math inline">\(i- 1\)</span>, y eso ocurre cuando se produce una demanda. Por lo tanto, <span class="math inline">\(r_{i i-1} = \mu\)</span>. El proceso <span class="math inline">\(X(t), t \geq 0\)</span> definidido de esta forma es una CMTC.</p>
<p>Consulta sobre modelo simmer para inventarios (<a href="https://stackoverflow.com/questions/51680140/immediate-inventory-restock-in-r-simmer" class="uri">https://stackoverflow.com/questions/51680140/immediate-inventory-restock-in-r-simmer</a>)</p>
</div>
<div id="proceso-de-fabricación" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Proceso de fabricación<a class="anchor" aria-label="anchor" href="#proceso-de-fabricaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Un proceso de de fabricación sencilla consiste en una sola máquina que puede estar encendida o apagada. Si la máquina está encendida, produce artículos según un proceso de Poisson con tasa <span class="math inline">\(\lambda\)</span>. La demanda de artículos llega según un <span class="math inline">\(PP(\mu)\)</span> La máquina se controla de la siguiente manera. Si el número de artículos en stock alcanza un número máximo <span class="math inline">\(K\)</span> (la capacidad de almacenamiento), la máquina se apaga. La máquina se enciende cuando el número de artículos en stock disminuye hasta un nivel preestablecido <span class="math inline">\(l &lt; K\)</span>. Si la variable aleatoria <span class="math inline">\(X(t)\)</span> nos indica el número de artículos en stock en el momento <span class="math inline">\(t\)</span>, el proceso <span class="math inline">\(X(t), t \geq 0\)</span> no es una CMTC ya que no sabemos si la máquina está encendida o apagada si <span class="math inline">\(l &lt; X(t) &lt; K\)</span>. Si se considera <span class="math inline">\(Y(t)\)</span> como el estado en el que se encuentra la máquina en el momento <span class="math inline">\(t\)</span>, de forma que un <span class="math inline">\(1\)</span> indica encendido y un <span class="math inline">\(0\)</span> que está apagada, entonces el proceso <span class="math inline">\(\{X(t), Y(t), t\geq 0\}\)</span> es una CMTC con espacio de estados:</p>
<p><span class="math display">\[S = \{(i, 1), 0 \leq i &lt; K\} \cup \{(i, 0), l &lt; i \leq K\}\]</span></p>
<p>Hay que tener en cuenta que la máquina siempre está encendida si el número de elementos es <span class="math inline">\(l\)</span> o menos. Por lo tanto, no necesitamos los estados <span class="math inline">\(\{(i, 0), 0 \leq i \leq l\}\)</span>. El análisis habitual de los eventos desencadenantes arroja las siguientes tasas de transición:</p>
<p><span class="math display">\[r_{(i, 1)(i+1, 1)} = \lambda, \quad 0 \leq i &lt; K-1,\]</span></p>
<p><span class="math display">\[r_{(K-1, 1)(K, 0)} = \lambda, \]</span> <span class="math display">\[r_{(i, 1)(i-1, 1)} = \mu, \quad 1\leq i\leq K-1,\]</span></p>
<p><span class="math display">\[r_{(i, 0)(i-1, 0)} = \mu, \quad l+1 &lt; i\leq K,\]</span></p>
<p><span class="math display">\[r_{(l+1, 0)(l, 1)} = \mu.\]</span></p>
</div>
</div>
<div id="CMTCF" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Probabilidades de transición<a class="anchor" aria-label="anchor" href="#CMTCF"><i class="fas fa-link"></i></a>
</h2>
<p>El aspecto funcdamental para estudiar el comportamiento de cualquier CMTC es la obtención y análisis de las probabilidades de transición entre los estados del procso a partir de la matriz de tasas obtenida en puntos anteriores. Aunque haremos un desarrollo teórico de este rporblema, veremos que es necesario un algoritmo de computación para obtener dichas probabilidades.</p>
<p>Sea <span class="math inline">\(X(t), t \geq 0\)</span> una CMTC con espacio de estados <span class="math inline">\(S = \{1,2,...,N\}\)</span> y con matriz de tasas <span class="math inline">\(R = [r_{ij}]\)</span>. Si asumimos que la distribución de probabilidad en el estado incial, <span class="math inline">\(X(0)\)</span> es conocida, entonces tenemos que:</p>
<p><span class="math display">\[P(X(t) = j) = \sum_{i=1}^N P(X(t) = j | X_0 = i)P(X_0 = i), \quad 1 \leq j \leq N.\]</span> Es necesario obtener <span class="math inline">\(P(X(t) = j | X_0 = i) = p_{ij}(t)\)</span> para obtener la función de distribución de probabilidad de <span class="math inline">\(X(t)\)</span>. Antes de ver como obtener dichas probabildiades introducimos la notación necesaria.</p>
<p>ya hemos visto antes que una CMTC permance un tiempo <span class="math inline">\(Exp(r_i)\)</span> en el estado <span class="math inline">\(i\)</span> con <span class="math inline">\(r_i = \sum_{j=1}^N r_{ij}\)</span> y, si <span class="math inline">\(r_i &gt; 0\)</span> entonces pasamos al estado <span class="math inline">\(j\)</span> con probabilidad <span class="math inline">\(p_{ij} = r_{ij}/r_i\)</span>. Asumiendo que existe un número finito <span class="math inline">\(r\)</span> que satisface:</p>
<p><span class="math display">\[r \geq max(r_i), \quad 1\leq i \leq N\]</span> podemos definir la matriz <span class="math inline">\(\hat{P} = [\hat{p}_{ij}]\)</span> como:</p>
<span class="math display">\[\begin{equation}
\hat{p}_{ij} = 
\begin{cases} 
1-\frac{r_i/r} &amp; \text{ si } i=j\\
r_{ij}/r &amp; \text{ si } i \neq j
\end{cases}
\end{equation}\]</span>
<p>que es una matriz estocástica.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-38" class="theorem"><strong>Teorema 4.2  </strong></span>La matriz de tarnsición de probabilidades, <span class="math inline">\(P\)</span>, de una CMTC viene dada por:</p>
<p><span class="math display">\[P(t) = \sum_{k=0}^{\infty} e^{-rt}\frac{(rt)^k}{k!} \hat{P}^k\]</span></p>
</div>
<p>Esta forma de obtener <span class="math inline">\(P\)</span> se denomina <strong>método de uniformización</strong>, y proporciona un método numérico para obtener las probabilidades de transición deseadas, sin más que usar los <span class="math inline">\(m\)</span> primeros términos de la serie infinita definida. Para asegurar la convergencia de dichas probabilidades se usan como reglas habituales:</p>
<p><span class="math display">\[m \approx max\{rt + r\sqrt{rt}, 20\},\]</span></p>
<p>y</p>
<p><span class="math display">\[r = max(r_i), \quad 1\leq i \leq N,\]</span> aunque en algunos casos resulta más conveniente utilizar <span class="math inline">\(r = sum_{i=1}^N r_i\)</span>. De hecho, veremos que ambos resultados son muy similares y podremos usar la suma en todos los casos.</p>
<div class="silverbox">
<p>Algoritmo para obtener <span class="math inline">\(P\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Fijar <span class="math inline">\(R\)</span>, <span class="math inline">\(t\)</span>, y <span class="math inline">\(0 &lt; \epsilon &lt; 1\)</span>. Por defecto fijamos <span class="math inline">\(\epsilon = 0.00001\)</span>.</li>
<li>Obtener r.</li>
<li>Calcular <span class="math inline">\(\hat{P}\)</span>.</li>
<li>Calcular <span class="math inline">\(A = \hat{P}\)</span>; <span class="math inline">\(c = e^{rt}\)</span>; <span class="math inline">\(B = e^{rt}I\)</span>; <span class="math inline">\(sum = c\)</span>; <span class="math inline">\(k=1.\)</span>
</li>
<li>Mientras que <span class="math inline">\(sum &lt; 1-\epsilon\)</span>, calcular:</li>
</ol>
<p><span class="math display">\[c = c*(rt)/k; \quad B = B + cA; \quad A = A \hat{P}\]</span> <span class="math display">\[sum = sum + c; \quad k = k + 1\]</span> Al finalizar la matriz <span class="math inline">\(B\)</span> es una aproximación de <span class="math inline">\(P(t)\)</span> con error inferior a <span class="math inline">\(\epsilon\)</span>.</p>
</div>
<p>En realidad en nuestro algoritmo añadiremos un parámetro extra para indicar como se debe calcular el valor de <span class="math inline">\(r\)</span>, bien como el máximo los elementos por filas de <span class="math inline">\(R\)</span> o como la suma de todos ellos.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matriz.prob.trans</span><span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Rmat</span>, <span class="va">ts</span>, <span class="va">cal</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Algortimo de uniformización para obtener P(t)</span>
  <span class="co">################################################</span>
  
  <span class="co"># Parámetros de la función</span>
  <span class="co"># Rmat: matriz de tasas</span>
  <span class="co"># ts: instante de tiempo</span>
  <span class="co"># epsilon: error en la aproximación</span>
  <span class="co"># cal: forms de obtener r con dos valores 1 = máximo, 2 = suma</span>
  <span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-05</span>
  <span class="co"># Paso 2. Calculo de r</span>
  <span class="va">ris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Rmat</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">cal</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">rlimit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">ris</span><span class="op">)</span>, <span class="va">rlimit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Paso 3. Calculo de hat(P)</span>
  <span class="va">hatP</span> <span class="op">&lt;-</span> <span class="va">Rmat</span><span class="op">/</span><span class="va">rlimit</span>
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">hatP</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">ris</span><span class="op">/</span><span class="va">rlimit</span>
  <span class="co"># Paso 4. Calculo de matrices y vectores accesorios</span>
  <span class="va">rts</span> <span class="op">&lt;-</span> <span class="va">rlimit</span><span class="op">*</span><span class="va">ts</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">hatP</span>
  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">rts</span><span class="op">)</span>
  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">c</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span><span class="op">)</span>
  <span class="va">suma</span> <span class="op">&lt;-</span> <span class="va">c</span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="co"># Bucle simulación</span>
  <span class="va">cota</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span> <span class="va">epsilon</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">suma</span> <span class="op">&lt;</span> <span class="va">cota</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">c</span><span class="op">*</span><span class="va">rts</span><span class="op">/</span><span class="va">k</span>
    <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">B</span> <span class="op">+</span> <span class="va">c</span><span class="op">*</span><span class="va">A</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">hatP</span>
    <span class="va">suma</span> <span class="op">&lt;-</span> <span class="va">suma</span> <span class="op">+</span> <span class="va">c</span>
    <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">B</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Veamos un ejemplo donde la matriz de tasas viene dada por:</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>Si estamos interesados en las probabilidades de transición entre estados cuando han transcurrido 2 unidades de tiempo podemos calcular (ambas versiones):</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pmat1</span><span class="op">&lt;-</span><span class="fu">matriz.prob.trans</span><span class="op">(</span><span class="va">R</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>; <span class="va">Pmat1</span></code></pre></div>
<pre><code>##        [,1]   [,2] [,3]   [,4]
## [1,] 0.2001 0.2001  0.4 0.1998
## [2,] 0.2002 0.2001  0.4 0.1997
## [3,] 0.1999 0.2000  0.4 0.2001
## [4,] 0.1998 0.1999  0.4 0.2003</code></pre>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pmat2</span><span class="op">&lt;-</span><span class="fu">matriz.prob.trans</span><span class="op">(</span><span class="va">R</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>; <span class="va">Pmat2</span></code></pre></div>
<pre><code>##        [,1]   [,2] [,3]   [,4]
## [1,] 0.2001 0.2001  0.4 0.1998
## [2,] 0.2002 0.2001  0.4 0.1997
## [3,] 0.1999 0.2000  0.4 0.2001
## [4,] 0.1998 0.1999  0.4 0.2003</code></pre>
<p>Ambas matrices proporciona un resultado prácticamente idéntico. Estas matrices nos permiten obtener las probabildiades de pasar del estado 1 a cualquiera de los otros estados en dos unidades de tiempo, sin más que tomar los elementos de la fila 1 de la matriz obtenida.</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pmat1</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>; <span class="va">Pmat2</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></code></pre></div>
<pre><code>## [1] 0.2001 0.2001 0.4000 0.1998</code></pre>
<pre><code>## [1] 0.2001 0.2001 0.4000 0.1998</code></pre>
<p>¿Cómo interpretamos esas probabilidades?</p>
<p>Veamos ahora la aplicación de este algoritmo a alguno de los ejemplos con los que hemos ido trabajando en esta unidad.</p>
<div class="example">
<p><span id="exm:unlabeled-div-39" class="example"><strong>Ejemplo 4.6  </strong></span>Para los datos correspondientes al cajero bancario estamos interesados en conocer la probabilidad de que después de 50 minutos de funcionamiento el sistema este completamente ocupado (1 usuario atendido y tres en cola), cuando partímos de <span class="math inline">\(0\)</span> clientes en el sistema (<span class="math inline">\(p_{04}(4)\)</span>). La matriz de tasas viene dada por:</p>
</div>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">estados</span><span class="op">)</span>

<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">15</span><span class="op">/</span><span class="fl">60</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span> 

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span></code></pre></div>
<p>Obtenemos la distribución de probabilidad asociada al estado 4 para <span class="math inline">\(t = 50\)</span>:</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de probabilidades de transición</span>
<span class="va">Pmat</span><span class="op">&lt;-</span><span class="fu">matriz.prob.trans</span><span class="op">(</span><span class="va">R</span>, <span class="fl">50</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">Pmat</span></code></pre></div>
<pre><code>##        [,1]   [,2]   [,3]   [,4]   [,5]
## [1,] 0.0812 0.1190 0.1730 0.2528 0.3741
## [2,] 0.0793 0.1172 0.1722 0.2539 0.3775
## [3,] 0.0769 0.1148 0.1711 0.2553 0.3819
## [4,] 0.0749 0.1128 0.1702 0.2565 0.3856
## [5,] 0.0739 0.1118 0.1698 0.2571 0.3874</code></pre>
<p>La probabilidad de interés es 0.3741 (<span class="math inline">\(p_{15}(50)\)</span>) lo que demuestra que es factible que el sistema llegue al estado 4 partiendo del estado 0 después de 4 horas.</p>
<p>Aunque el cálculo teórico es muy preciso hay situaciones donde los sistemas reales con los que estamos trabajndo hacen bastante costoso obtener la matriz <span class="math inline">\(R\)</span>, y resulta más sencillo tratar de aproximar las probabilidades de transición mediante simulación. Para ello basta con replicar el sistema de simulación un número los suficientemente grande ya aproximar mediante Monte-Carlo. En este caso deberíamos obtner el estado dle sistema después de 50 minutos y aproximar la probabilidad como el número de veces que se alcanza el estado de interés dividido por las réplicas realizadas. la precisión de esta aproximación depende en gran medida del número de réplicas.</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">replicas</span> <span class="op">&lt;-</span> <span class="fl">2500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">replicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">repcajero</span> <span class="op">&lt;-</span> <span class="fu">cola.MM1K</span><span class="op">(</span><span class="fl">50</span>, <span class="fl">15</span><span class="op">/</span><span class="fl">60</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co"># almacenamos análisis de recursos del sistema</span>
<span class="va">simresource</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Almacenamos el estado final de la cola en el último instante del sistema</span>
<span class="va">salida</span> <span class="op">&lt;-</span> <span class="va">simresource</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>estado <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">system</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Estimamos la probabilidad</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">salida</span><span class="op">$</span><span class="va">estado</span><span class="op">)</span><span class="op">/</span><span class="va">replicas</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     0     1     2     3     4 
## 0.089 0.122 0.162 0.251 0.376</code></pre>
<p>Podemos ver que la aproximación obtenida es similar (hasta el segundo decimal) a la obtneida a partir de la matriz <span class="math inline">\(R\)</span> del proceso. Simulando podemos aproximar las cantidades de interés siempre que el sistema empieza desde el punto de interés.</p>
<p><em>Para practicar la obtención de la matriz de probabilidades de transición puedes resolver los ejercicios B-1 a B-4 de la colección al final de la unidad.</em></p>
</div>
<div id="CMTCG" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Análisis de tiempos de ocupación<a class="anchor" aria-label="anchor" href="#CMTCG"><i class="fas fa-link"></i></a>
</h2>
<p>En esta sección, nos concentramos en el análisis de los tiempos de ocupación de un estado determinado en un intervalo de tiempo finito <span class="math inline">\([0, T]\)</span>, es decir, la duración esperada de tiempo que el sistema pasa en ese estado. Como ocurre con las probabildiades de trasnsición presentamos un algortimo para obtener las cantidades de interés a partir de la matriz de tasas, y veremos como la simulación del proceso nos puede ayudar a dar respuesta a las mismas cuestiones.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-40" class="theorem"><strong>Teorema 4.3  </strong></span>Si <span class="math inline">\(P(t)\)</span> es la matriz de transiciones de probabilidad del proceso <span class="math inline">\(\{X(t), t \geq 0\}\)</span> con espacio de estados <span class="math inline">\(S = \{1, 2,...,N\}\)</span>, se define la cantidad <span class="math inline">\(m_{ij}(T)\)</span> como el tiempo de ocupación del estado <span class="math inline">\(j\)</span> hasta el tiempo <span class="math inline">\(T\)</span> partiendo del estado <span class="math inline">\(i\)</span> como:</p>
<p><span class="math display">\[m_{ij}(T) = \int_0^T p_{ij}(t)dt, \quad 1 \leq i, j \leq N.\]</span></p>
</div>
<p>Cuando tenemos formas explicitas para cada uno de los elemntos de <span class="math inline">\(P(t)\)</span> (este es el caso para la mayoría de los sistemas de colas de espera) este probelma se puede resolver teóricamente, pero en la mayoria de ocasiones es necesario un algoritmo de computación para aproximar estas cantidades. A continuación se presenta el algoritmo necesario, pero antes veamos la aproximación mediante series de la matriz <span class="math inline">\(M(T) = [m_{ij}(t)]\)</span>.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-41" class="theorem"><strong>Teorema 4.4  </strong></span>Si <span class="math inline">\(Y\)</span> es una variable aletoria Poisson de parámetro <span class="math inline">\(r*t\)</span> entonces:</p>
<p><span class="math display">\[M(T) = \frac{1}{r} \sum_{k = 0}^{\infty} P(Y &gt; k) \hat{P}^k, \quad T \geq 0.\]</span></p>
</div>
<div class="silverbox">
<p>Algoritmo para obtener <span class="math inline">\(M(T)\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Fijar <span class="math inline">\(R\)</span>, <span class="math inline">\(T\)</span>, y <span class="math inline">\(0 &lt; \epsilon &lt; 1\)</span>. Por defecto fijamos <span class="math inline">\(\epsilon = 0.00001\)</span>.</li>
<li>Obtener r.</li>
<li>Calcular <span class="math inline">\(\hat{P}\)</span>.</li>
<li>Calcular <span class="math inline">\(A = \hat{P}\)</span>; <span class="math inline">\(k = 0\)</span>
</li>
<li>Calcular <span class="math inline">\(yek = exp(-r*t)\)</span>, <span class="math inline">\(ygk = 1 - yek\)</span>, <span class="math inline">\(suma = ygk\)</span>
</li>
<li>Calcular <span class="math inline">\(B = ygk * I\)</span>
</li>
<li>Mientras que <span class="math inline">\(suma/r &lt; T-\epsilon\)</span>, calcular:</li>
</ol>
<p><span class="math display">\[k = k + 1; \quad yek = yek*(rT)/k; \quad ygk = ygk - yek\]</span> <span class="math display">\[B = B + ygk*A; \quad A = A\hat{P}; \quad suma = suma + ygk\]</span> Al finalizar la matriz <span class="math inline">\(B/r\)</span> es una aproximación de <span class="math inline">\(M(T)\)</span> con error inferior a <span class="math inline">\(\epsilon\)</span>.</p>
</div>
<p>En realidad en nuestro algoritmo añadiremos un parámetro extra para indicar como se debe calcular el valor de <span class="math inline">\(r\)</span>, bien como el máximo los elementos por filas de <span class="math inline">\(R\)</span> o como la suma de todos ellos.</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tiempos.ocupacion</span><span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Rmat</span>, <span class="va">Ts</span>, <span class="va">cal</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Algortimo de uniformización para obtener M(T)</span>
  <span class="co">################################################</span>
  
  <span class="co"># Parámetros de la función</span>
  <span class="co"># Rmat: matriz de tasas</span>
  <span class="co"># ts: instante de tiempo</span>
  <span class="co"># epsilon: error en la aproximación</span>
  <span class="co"># cal: forms de obtener r con dos valores 1 = máximo, 2 = suma</span>
  <span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-05</span>
  <span class="co"># Paso 2. Calculo de r</span>
  <span class="va">ris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Rmat</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">cal</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">rlimit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">ris</span><span class="op">)</span>, <span class="va">rlimit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Paso 3. Calculo de hat(P)</span>
  <span class="va">hatP</span> <span class="op">&lt;-</span> <span class="va">Rmat</span><span class="op">/</span><span class="va">rlimit</span>
  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">hatP</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">ris</span><span class="op">/</span><span class="va">rlimit</span>
  <span class="co"># Paso 4. </span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">hatP</span>
  <span class="co"># Paso 5.</span>
  <span class="va">yek</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">rlimit</span><span class="op">*</span><span class="va">Ts</span><span class="op">)</span>
  <span class="va">ygk</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">yek</span>
  <span class="va">suma</span> <span class="op">&lt;-</span> <span class="va">ygk</span>
  <span class="co"># Paso 6.</span>
  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">ygk</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Bucle simulación</span>
  <span class="va">cota</span> <span class="op">&lt;-</span> <span class="va">Ts</span><span class="op">-</span> <span class="va">epsilon</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">suma</span><span class="op">/</span><span class="va">rlimit</span> <span class="op">&lt;</span> <span class="va">cota</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="va">yek</span> <span class="op">&lt;-</span> <span class="va">yek</span><span class="op">*</span><span class="op">(</span><span class="va">rlimit</span><span class="op">*</span><span class="va">Ts</span><span class="op">)</span><span class="op">/</span><span class="va">k</span>
    <span class="va">ygk</span> <span class="op">&lt;-</span> <span class="va">ygk</span> <span class="op">-</span> <span class="va">yek</span>
    <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">B</span> <span class="op">+</span> <span class="va">ygk</span><span class="op">*</span><span class="va">A</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">hatP</span>
    <span class="va">suma</span> <span class="op">&lt;-</span> <span class="va">suma</span> <span class="op">+</span> <span class="va">ygk</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">B</span><span class="op">/</span><span class="va">rlimit</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="example">
<p><span id="exm:unlabeled-div-42" class="example"><strong>Ejemplo 4.7  </strong></span>Retomamdo el sistema sobre el tiempo de vida de una máquina descrito en el ejemplo <a href="CMTC.html#exm:excmtc005">4.5</a>, supongamos que el tiempo esperado hasta que falla una máquina son 10 días, mientras que el tiempo esperado de reparación es de 1 día. Si la máquina funciona el primer día de enero ¿cuál es el tiempo total esperado de funcionamiento de la máquina al finalizar el mes de enero? Dado que el proceso sólo tiene espacio de estados <span class="math inline">\(S = \{0, 1\}\)</span>, la cantidad de interés es <span class="math inline">\(m_{11}(31)\)</span>. Con <span class="math inline">\(\lambda = 1\)</span> y <span class="math inline">\(\mu = 0.1\)</span>, la matriz de tasas del proceso viene dada por:</p>
</div>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> </code></pre></div>
<p>Obtenemos ahora la matriz <span class="math inline">\(M(31)\)</span> correspondiente a la cantidad de interés, teniendo en cuenta que partimos de que la máquina está en marcha (primera fila de <span class="math inline">\(M\)</span>) al inicio:</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tiempos.ocupacion</span><span class="op">(</span><span class="va">R</span>, <span class="fl">31</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>##        [,1]    [,2]
## [1,] 3.6446 27.3554
## [2,] 2.7355 28.2645</code></pre>
<p>Por tanto, el tiempo esperado de funcionamiento es de 28.26 días, mientras que el tiempo de reparación es de <span class="math inline">\(2.74\)</span> días. Utilizando el simulador del proceso podemos ver que el resultado obtenido es similar.</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Réplicas del proceso</span>
<span class="va">replicas</span> <span class="op">&lt;-</span> <span class="fl">2500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">replicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">maquina</span> <span class="op">&lt;-</span> <span class="fu">sistema.1m</span><span class="op">(</span><span class="fl">31</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co"># almacenamos análisis de llegadas del sistema</span>
<span class="va">simarrivals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Almacenamos el estado final de la cola en el último instante del sistema</span>
<span class="va">simarrivals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tOFF <span class="op">=</span> <span class="va">end_time</span> <span class="op">-</span> <span class="va">start_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>totalOFF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tOFF</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mOFF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">totalOFF</span><span class="op">)</span>, mON <span class="op">=</span> <span class="fl">31</span> <span class="op">-</span> <span class="va">mOFF</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##    mOFF   mON
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  3.33  27.7</code></pre>
<p><em>Para practicar este apartado puedes resolver los ejercicios B-5 a B-8 de la colección al final de la unidad.</em></p>
</div>
<div id="CMTCH" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Comportamiento límite del proceso<a class="anchor" aria-label="anchor" href="#CMTCH"><i class="fas fa-link"></i></a>
</h2>
<p>En el análisis del comportamiento límite de una CMTD analizamos la distribución de probabilidad límite, la distribución estacionaria, y la distribución de los tiempos de ocupación. En el caso de las CMTC estudiaremos cantidades similares. En primer lugar analizaremos las probabilidades límite:</p>
<p><span class="math display">\[\lim_{t \rightarrow \infty} P(X(t) = j, \quad 1 \leq j \leq N\]</span></p>
<p>Si existen dichos límites el conjunto <span class="math inline">\(p = [p_1, p_2,...,p_N]\)</span> se conoce como distribución límite de la CMTC.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-43" class="theorem"><strong>Teorema 4.5  </strong></span>Una CMTC <span class="math inline">\(\{X(t), t \geq 0\}\)</span> irreducible con matriz de tasas <span class="math inline">\(R\)</span> tiene una única distribución límite <span class="math inline">\(p = [p_1, p_2,...,p_N]\)</span>, que se puede obtener como solución de las ecuaciones de balance:</p>
<p><span class="math display">\[p_j r_j = \sum_{i=1}^N p_ir_{ij}, \quad 1 \leq j \leq N\]</span> <span class="math display">\[\sum_{i=1}^N p_i = 1\]</span></p>
</div>
<p>En este sentido podemos interpretar <span class="math inline">\(p_jr_j\)</span> como la tasa de la CMTC cuanod deja el estado <span class="math inline">\(j\)</span>, mientras que <span class="math inline">\(p_jr_{ij}\)</span> es la tasa de entrada de la CMTC a estado <span class="math inline">\(j\)</span> desde el estado <span class="math inline">\(i\)</span>.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-44" class="theorem"><strong>Teorema 4.6  </strong></span>Dado una CMTC <span class="math inline">\(\{X(t), t \geq 0\}\)</span> irreducible con distribución límite <span class="math inline">\(p\)</span>, entonces la distribución estacionaria de la CMTC viene dada por <span class="math inline">\(p\)</span>, es decir:</p>
<p><span class="math display">\[P(X(0) = j) = p_j \text{ para } 1 \leq j leq N\]</span> <span class="math inline">\(P(X(t) = j) = p_j \text{ para } 1 \leq j leq N, t \geq 0\)</span>$</p>
</div>
<p>A partir de la distribución límite resulta posible obtener la distribución de ocupación de la CMTC.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-45" class="theorem"><strong>Teorema 4.7  </strong></span>Sea <span class="math inline">\(m_{ij}(T)\)</span> el tiempo total esperado que la cadena permanece en el estado hata el tiempo <span class="math inline">\(T\)</span> para una CMTC irreducible que comienza en el estado <span class="math inline">\(i\)</span>. Entonces:</p>
<p><span class="math display">\[\lim_{T \rightarrow \infty} \frac{m_{ij}(T)}{T} = p_j\]</span></p>
</div>
<p>A continuación se presenta la solución de la distribución límite para los procesos de nacimiento y muerte. En el resto de sistemas se deberan plantear las ecuaciones de balance y resorverlas. En ambas situaciones presentamos las correspondientes funciones que nos permiten obtener las cantidades de interés.</p>
<div class="bluebox">
<p>Sea <span class="math inline">\(\{X(t), t \geq 0\}\)</span> un proceso de nacimiento y muerte con espacio de estados <span class="math inline">\(S = \{0, 1,...,K\}\)</span>, y tasas de nacimiento <span class="math inline">\(\{\lambda_i, 0 \leq i &lt; K\}\)</span> y tasas de muerte <span class="math inline">\(\{\mu_i, 1 \leq i \leq K\}\)</span>. Entonces la CMTC así definida es irreducible y tiene una única distribuión límite con:</p>
<p><span class="math display">\[p_i = \frac{\rho_i}{\sum_{j = 0}^K \rho_j}, \quad 0 \leq i \leq K,\]</span> donde <span class="math inline">\(\rho_0 = 1,\)</span> y</p>
<p><span class="math display">\[\rho_i = \frac{\prod_{j=0}^{i-1}\lambda_j}{\prod_{j=1}^{i}\mu_j}, \quad 1 \leq i \leq K,\]</span></p>
</div>
<p>Antes de comenzar con los ejemplos vamos a crear una función que permita obtener la distibución límite y la distribución de ocupación para los procesos de nacimiento y muerte.</p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Obtención de distribuciones límite </span>
<span class="va">distr.lim.nm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estados</span>, <span class="va">lambdas</span>, <span class="va">mus</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co"># ========================</span>
  <span class="co"># estados: número de estados del sistema</span>
  <span class="co"># lambdas: vector de tasas de nacimiento</span>
  <span class="co"># mus: vector de tasas de muerte</span>
  
  <span class="co"># definimos vector de rho</span>
  <span class="va">rhos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">estados</span><span class="op">)</span>
  <span class="co"># calculamos productos acumlados para lambda y mu</span>
  <span class="va">prl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span>
  <span class="va">prm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>
  <span class="co"># rellenamos rho con los productos acumulados</span>
  <span class="va">rhos</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">estados</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">prl</span><span class="op">/</span><span class="va">prm</span>
  <span class="co"># suma de rhos</span>
  <span class="va">sumarhos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rhos</span><span class="op">)</span>
  <span class="co"># vector de probabilidades</span>
  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="va">rhos</span><span class="op">/</span><span class="va">sumarhos</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="example">
<p><span id="exm:unlabeled-div-46" class="example"><strong>Ejemplo 4.8  </strong></span>Retomamdo el sistema descrito en el ejemplo <a href="CMTC.html#exm:excmtc005">4.5</a>, supongamos que el tiempo esperado hasta que falla una máquina son 10 días, mientras que el tiempo esperado de reparación es de 1 día. Si la máquina funciona el primer día de enero ¿cuál es la distribución límite del proceso?</p>
<p>Este sistema es un proceso de nacimiento y muerte donde podemos aplicar la función anterior para obtener la distribución límite con dos estados y tasas <span class="math inline">\(\lambda = 1\)</span>, <span class="math inline">\(\mu = 1/10\)</span> (expresadas en periodos de diez días).</p>
</div>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.nm</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>
<span class="va">probs</span></code></pre></div>
<pre><code>## [1] 0.09090909 0.90909091</code></pre>
<p>El comportamiento límite nos indica que la máquina está el 90.9% del tiempo en funcionamiento, mientras que sólo el 9.1% en reparación. Para un periodo de un año tendríamos que los díass esperados de reparación y funcionamiento son:</p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">365</span><span class="op">*</span><span class="va">probs</span></code></pre></div>
<pre><code>## [1]  33.18182 331.81818</code></pre>
<p>Veamos ahora como obtener la distribución límite para procesos más generales. Definimos una función que nos permite obtener la distribución límite de un CMTC a partir de cualquier matriz de tasas resolviendo las ecuaciones de balance.</p>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Función para la resolución numérica de las ecuaciones de balance</span>
<span class="va">distr.lim.general</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co">#=========================</span>
  <span class="co"># Rmat: matriz de tasas del sistema</span>
  
  <span class="co"># número de estados del sistema</span>
  <span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span>
  <span class="co"># Calculamos r_i y lo colocamos en formato matriz</span>
  <span class="va">sumarows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Rmat</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>, <span class="va">estados</span><span class="op">)</span>
  <span class="co"># Matriz de coeficientes del sistema de ecauciones de balance</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">-</span><span class="va">sumarows</span>
  <span class="co"># Completamos la matriz añadiendo la restricción de suma de p`s iagual a 1</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">estados</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Vector de términos independientes del sistema</span>
  <span class="va">CS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">estados</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="co"># Resolcuión del sistema</span>
  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/qr.html">qr.solve</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">CS</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="example">
<p><span id="exm:unlabeled-div-47" class="example"><strong>Ejemplo 4.9  </strong></span>Para el sistema de proceso de fabricación se está interesado en conocer cuando la máquina estará parada a largo plazo. Dado que el espacio de estados es <span class="math inline">\(S = \{1, 2,...,6\}.\)</span> la máquina está aprada cuando nos encontramos en los estados <span class="math inline">\(5 = (4, 0)\)</span> y <span class="math inline">\(6 = (3, 0)\)</span>. A partir de la información del sistema podemos obtener la distribución límite del proceso, pero en este caso como no se trata de un proceso de nacimiento y muerte debemos plantear las ecuaciones de balance, a partir de la matriz de tasas, y resolver el sistema numéricamente.</p>
</div>
<p>Resolvemos las ecuaciones de balance para el sistema del proceso de fabricación. Definimos la matriz de tasas y ejecutamos la función anterior para obtener las probabilidades límite del proceso:</p>
<div class="sourceCode" id="cb507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estados del sistema</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="co"># Matriz de tasas</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="co"># Resolución  de las ecuaciones de balance</span>
<span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.general</span><span class="op">(</span><span class="va">R</span><span class="op">)</span>
<span class="va">ps</span></code></pre></div>
<pre><code>## [1] 0.1584649 0.1901579 0.2281895 0.1244670 0.1493604 0.1493604</code></pre>
<p>La probabilidad de interés viene dada por 0.2987, de forma que la máquina permancerá apagada sobre el 30% del tiempo.</p>
<p><em>Para practicar este apartado puedes resolver los ejercicios B-9 a B-12 de la colección al final de la unidad.</em></p>
</div>
<div id="CMTCI" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Análisis de costes<a class="anchor" aria-label="anchor" href="#CMTCI"><i class="fas fa-link"></i></a>
</h2>
<p>En este punto vemos como podemos introducir costes en las CMTC y los procedimientos numéricos necesarios para su análisis. En todo el punto consideramos <span class="math inline">\(\{X(t), t \geq 0\}\)</span> una CMTC con espacio de estados <span class="math inline">\(S = \{1, 2,...,N\}\)</span> y matriz de tasas <span class="math inline">\(R\)</span>. Además, siempre que la CMTC está en el estado <span class="math inline">\(i\)</span> se incurre en una tasa de coste <span class="math inline">\(c(i), 1 \leq i \leq N\)</span>.</p>
<div id="coste-total-esperado-a-tiempo-t" class="section level3" number="4.9.1">
<h3>
<span class="header-section-number">4.9.1</span> Coste total esperado a tiempo <span class="math inline">\(T\)</span><a class="anchor" aria-label="anchor" href="#coste-total-esperado-a-tiempo-t"><i class="fas fa-link"></i></a>
</h3>
<p>En esta subsección, estudiamos el <strong>CTE</strong>, el <em>coste total esperado</em> hasta un tiempo finito <span class="math inline">\(T\)</span>, llamado horizonte. Nótese que la tasa de coste en el tiempo <span class="math inline">\(t\)</span> es <span class="math inline">\(c(X(t))\)</span>. Por lo tanto, el coste total hasta el tiempo <span class="math inline">\(T\)</span> viene dado por:</p>
<p><span class="math display">\[\int_0^T c(X(t))dt.\]</span></p>
<p>De esta forma el coste esprado total hasta el instante <span class="math inline">\(T\)</span>, empezando en el estado <span class="math inline">\(i\)</span>, viene dado por:</p>
<p><span class="math display">\[g(i, T) = E\left( \int_0^T c(X(t))dt \mid X(0) = i \right), \quad 1 \leq i \leq N.\]</span></p>
<div class="theorem">
<p><span id="thm:unlabeled-div-48" class="theorem"><strong>Teorema 4.8  </strong></span>Si <span class="math inline">\(M(T) = [m_{ij}(T)]\)</span> es la matriz de ocupación entonces:</p>
<p><span class="math display">\[g(T) = M(T)c,\]</span></p>
<p>donde <span class="math inline">\(c = [c(1), c(2),...,c(N-1), c(N)]'\)</span> y <span class="math inline">\(g(T) = [g(1, T), g(2,T),..., g(N-1, T), g(N, T)]'.\)</span></p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-49" class="example"><strong>Ejemplo 4.10  </strong></span>Para el sistema de mantenimiento de máquinas se conoce que que el beneficio por cada hora que la máquina está funcionanado es de 50 euros, mientras que el coste de que la máquina este apagada es de 15 euros por hora, al que hay que sumar 10 euros por cada hora de reparación. Estamos interesados en conocer el coste-beneficio de un periodo de 24 horas si al finalizar todas las máquinas están funcionando. Si <span class="math inline">\(X(t)\)</span> es el número de máquinas funcionando en el instante <span class="math inline">\(t\)</span>, el espacio de estados para 4 máquinas viene dado por <span class="math inline">\(S = \{0, 1, 2, 3, 4\}\)</span> y el vector de costes es:</p>
</div>
<p><span class="math display">\[
\begin{matrix}
c(0) = &amp; 0*50 - 4*15 - 2*10 = - 80,\\
c(1) = &amp; 1*50 - 3*15 - 2*10 = - 15,\\
c(2) = &amp; 2*50 - 2*15 - 2*10 = 50,\\
c(3) = &amp; 3*50 - 1*15 - 1*10 = 125,\\
c(4) = &amp; 4*50 - 0*15 - 0*10 = 200.
\end{matrix}
\]</span> El vector de costes para el periodo de 24 horas viene dado por:</p>
<p><span class="math display">\[
g(24) = M(24)*c =
\begin{bmatrix}
3844.69 \\
4116.57 \\
4327.23 \\
4474.96 \\
4621.05
\end{bmatrix}
\]</span></p>
<p>de forma que la cantidad de interés, <span class="math inline">\(g(4, 24)\)</span> que corresponde con el elemento <span class="math inline">\((5,1)\)</span> de la matriz, establece un beneficio de 4621.05 euros. Veamos como obtener esta cantidad utilizando el código correspondiente.</p>
<div class="sourceCode" id="cb509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de tasas</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">72</span> 

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">*</span><span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span><span class="op">*</span><span class="va">mu</span>
<span class="co"># Matriz de ocupación</span>
<span class="va">mmat</span> <span class="op">&lt;-</span> <span class="fu">tiempos.ocupacion</span><span class="op">(</span><span class="va">R</span>, <span class="fl">24</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co"># Vector de costes</span>
<span class="va">costes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">50</span>, <span class="fl">125</span>, <span class="fl">200</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># Matriz de beneficios</span>
<span class="va">beneficios</span> <span class="op">&lt;-</span> <span class="va">mmat</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">costes</span>
<span class="va">beneficios</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 3844.694
## [2,] 4116.585
## [3,] 4327.238
## [4,] 4474.971
## [5,] 4621.058</code></pre>
<p>El beneficio es 4621.058 euros.</p>
</div>
<div id="tasas-de-coste-a-largo-plazo" class="section level3" number="4.9.2">
<h3>
<span class="header-section-number">4.9.2</span> Tasas de coste a largo plazo<a class="anchor" aria-label="anchor" href="#tasas-de-coste-a-largo-plazo"><i class="fas fa-link"></i></a>
</h3>
<p>Para el sistema de <code>vida de una máquina</code>, supongamos que se da el coste <span class="math inline">\(C\)</span> del tiempo de inactividad. Queremos saber a cuánto debe ser la tasa de ingresos durante el tiempo de actividad para que sea económicamente rentable operar la máquina. Si nos guiamos por el coste total, la respuesta dependerá de del horizonte de planificación <span class="math inline">\(T\)</span> y también del estado inicial de la máquina. Una alternativa es calcular los ingresos netos a largo plazo por unidad de tiempo para esta máquina e insistir en que sea positivo para la rentabilidad. Esta respuesta no dependerá de <span class="math inline">\(T\)</span>, y, como veremos ni siquiera del estado inicial de la máquina. Por lo tanto, el cálculo de estos índices de costes o ingresos a largo plazo es muy útil. En esta subsección mostraremos cómo calcular estas cantidades.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-50" class="theorem"><strong>Teorema 4.9  </strong></span>Sea <span class="math inline">\(\{X(t), t \ geq 0\}\)</span> una CMTC irreducible con estados <span class="math inline">\(\{1, 2,...,N\}\)</span>, distribución límite <span class="math inline">\(p = [p_1, p_2,...,p_N]\)</span> y vector de costes <span class="math inline">\(c = [c_1, c_2,..., c_N]\)</span>, entonces la tasa de coste a largo plazo viene dada por:</p>
<p><span class="math display">\[g(i) = \sum_{j = 1}^N p_jc(j), \quad 1 \leq i \leq N\]</span></p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-51" class="example"><strong>Ejemplo 4.11  </strong></span>Si consideramos el sistema de <code>vida de una máquina</code> supongamos que el coste por unidad de tiempo de que la máquina este apagado es <span class="math inline">\(C\)</span>. ¿Cuál es el la tasa mínima de ingresos <span class="math inline">\(I\)</span> necesaria durante el tiempo de actividad para alcanzar el punto de equilibrio a largo plazo?</p>
</div>
<p>Utilizando las tasas definidas anteriormente (<span class="math inline">\(\lambda = 1, \mu = 0.1\)</span>), la distribución límite del sistema <span class="math inline">\(p = [0.0909, 0.9091]\)</span>, y el vector de costes <span class="math inline">\(c =[-C, I]\)</span> para el espacio de estados <span class="math inline">\(S = \{0, 1\}\)</span>, la tasa de coste a largo plazo por unidad de tiempo viene dada por la expresión:</p>
<p><span class="math display">\[ g = 0.9091*I - 0.0909*C\]</span> de forma que para mantener el sistema en equilibrio, <span class="math inline">\(g \geq 0\)</span>, se debe cumplir que:</p>
<p><span class="math display">\[I \geq \frac{0.0909}{0.9091}*C = 0.099989*C \approx 0.1*C\]</span></p>
<p>Así, los ingresos por unidad de tiempo superiores a 0.1 veces por el coste de que la máquina este parada por unidad de tiempo resulta rentable. Si la empresa ha establecido un ingreso por hora de 50 euros, cuando sabe que el coste por hora es de 10 euros cuando está apagada, se desea saber si se cumple la condición de equilibrio para los costes.</p>
<div class="example">
<p><span id="exm:unlabeled-div-52" class="example"><strong>Ejemplo 4.12  </strong></span>Consideramos el sistema de la <code>central telefónica</code> donde la capacidad máxima de la centralita es de seis llamadas. Las llamadas llegan según un <span class="math inline">\(PP\)</span> con una tasa de 4/minuto, y la duración media de cada llamada exponencial de media 2 minutos. En primer lugar deseamos conocer le beneficio por unidad de tiempo si la facturación por minuto de cada llamada es de 10 céntimos. En segundo lugar deseamos estimar la pérdida que sufrimos por todas las llamadas que no pueden ser atendidas. Consideramos como <span class="math inline">\(X(t)\)</span> al número de llamadas que están siendo atendidas en el instante <span class="math inline">\(t\)</span>.</p>
</div>
<p>En primer lugar calculamos la distribución límite del proceso. Dado que se trata de un proceso de nacimeinto y muerte utilizamos la función correspondiente.</p>
<div class="sourceCode" id="cb511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de tasas</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">7</span>
<span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span> 
<span class="va">mus</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>
<span class="co"># Probabilidades del sistema</span>
<span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.nm</span><span class="op">(</span><span class="va">nestados</span>, <span class="va">lambdas</span>, <span class="va">mus</span><span class="op">)</span></code></pre></div>
<p>Establecemos los beneficios <span class="math inline">\(c(i) = 10i\)</span> y calculamos el global por unidad de tiempo</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># vector de beneficios</span>
<span class="va">beneficio</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">*</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> 
<span class="co"># beneficio por unidad de tiempo</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">beneficio</span><span class="op">*</span><span class="va">probs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 48.81985</code></pre>
<p>El beneficio por unidad de tiempo es de 48.82 céntimos. Si no rechazaramos ninguna llamada tendríasmo que el beneficio por minuto sería de 80 céntimos, que se corresponde con la tasa de 4 llamadas por minuto, el beneficio de 10 céntimos por minuto, y que a duración de las llamadas es de 2 minutos. Esto supone que la pérdida por minuto debido a las lamadas rechazadas se puede estimar como <span class="math inline">\(80 - 48.82 = 31.18\)</span> céntimos por minuto.</p>
</div>
</div>
<div id="CMTCJ" class="section level2" number="4.10">
<h2>
<span class="header-section-number">4.10</span> Tiempos de primer paso<a class="anchor" aria-label="anchor" href="#CMTCJ"><i class="fas fa-link"></i></a>
</h2>
<p>Como ocurría con las CMTD podemos hablar de los tiempos de primer paso en las CMTC. Si <span class="math inline">\(\{X(t), t \geq 0\}\)</span> es una CMTC con espacio de estados <span class="math inline">\(\{1, 2,...,N\}\)</span> y matriz de tasas <span class="math inline">\(R\)</span>, entonces se define como el <strong>tiempo de primer paso al estado</strong> <span class="math inline">\(N\)</span> como:</p>
<p><span class="math display">\[T = min\{t \geq 0: X(t) = N\}.\]</span></p>
<p>Más concretamente estudíamos el valor esperado de <span class="math inline">\(T\)</span>, <span class="math inline">\(E(T)\)</span>. Para ello definimos los tiempos esperados a partir de cada uno de los estados del sistema como:</p>
<p><span class="math display">\[m_i = E(T \mid X(0) = i), \quad 1 \leq i \leq N-1\]</span> y <span class="math inline">\(m_N = 0.\)</span></p>
<div class="theorem">
<p><span id="thm:unlabeled-div-53" class="theorem"><strong>Teorema 4.10  </strong></span>Los valores <span class="math inline">\(\{m_i, 1 \leq i \leq N-1\}\)</span> satisfacen</p>
<p><span class="math display">\[r_im_i = 1 + \sum_{j=1}^{N-1} r_{ij}m_j, \quad 1\leq i \leq N-1.\]</span></p>
</div>
<p>Si deseamos calcular los tiempos de primer paso a un subconjunto de estados, <span class="math inline">\(A\)</span> se puede adaptar el teorema anterior ya que sólo debemos resolver el sistema:</p>
<p><span class="math display">\[r_im_i(A) = 1 + \sum_{j \notin A} r_{ij}m_j(A), \quad 1\leq i \leq N-1.\]</span></p>
<p>A continuación presentamos un algoritmo para calcular los valores de <span class="math inline">\(m_i\)</span> a partir de la matriz de tasas del sistema, donde debemos indicar el estado o estados desde los que partimos al inicio.</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Función para la resolución numérica de las ecuaciones de balance</span>
<span class="va">tiempos.primer.paso</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">Rmat</span>, <span class="va">A</span>, <span class="va">estados</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># Parámetros de la función</span>
  <span class="co">#=========================</span>
  <span class="co"># Rmat: matriz de tasas del sistema</span>
  <span class="co"># A: vector de estados que debemos alcanzar</span>
  <span class="co"># estados: conjunto de estados total (como carácter)</span>
  
  <span class="co"># Estados como texto</span>
  
  <span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">estados</span><span class="op">)</span>
  <span class="co"># Tasas r</span>
  <span class="va">rts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">Rmat</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Rmat</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Seleccionamos el subconjunto de la matriz quitando fila y columna</span>
  <span class="va">Rmod</span> <span class="op">&lt;-</span> <span class="va">Rmat</span><span class="op">[</span><span class="op">-</span><span class="va">A</span>, <span class="op">-</span><span class="va">A</span><span class="op">]</span>
  <span class="va">rates</span> <span class="op">&lt;-</span> <span class="va">rts</span><span class="op">[</span><span class="op">-</span><span class="va">A</span>, <span class="op">-</span><span class="va">A</span><span class="op">]</span>
  <span class="co"># Número de m´s a estimar</span>
  <span class="va">lms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Rmod</span><span class="op">)</span>
  <span class="co"># Matriz de coeficientes del sistema de ecuaciones de balance</span>
  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">rates</span> <span class="op">-</span> <span class="va">Rmod</span>
  <span class="co"># Vector de términos independientes del sistema</span>
  <span class="va">CS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lms</span><span class="op">)</span>
  <span class="co"># Resolución del sistema</span>
  <span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/qr.html">qr.solve</a></span><span class="op">(</span><span class="va">B</span>, <span class="va">CS</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"estado"</span>, <span class="va">estados</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">A</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span> <span class="op">&lt;-</span><span class="st">"tiempo"</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="example">
<p><span id="exm:unlabeled-div-54" class="example"><strong>Ejemplo 4.13  </strong></span>En las condiciones del sistema <span class="math inline">\(M/M/1/K\)</span> del <code>cajero bancario</code> descrito anteriormente, estamos interesados en conocer el tiempo quen debe trasncurrir hasta que la cola esta vacia si ahora mismo hay un cliente en el sistema y cero en la cola (<span class="math inline">\(X(0) = 0\)</span>). Recordemos que el esapcio de estados hace referencia al número de clientes en la cola y viene dado por <span class="math inline">\(\{0, 1, 2, 3, 4, 5\}.\)</span></p>
</div>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Definición matriz de tasas</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span>

<span class="co"># Tiempos de primer el estado 1 que deseamos alcanzar (corresponde con el primer elemento del espacio de estados)</span>
<span class="fu">tiempos.primer.paso</span><span class="op">(</span><span class="va">R</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>##             tiempo
## estado 1 0.1736626
## estado 2 0.3341564
## estado 3 0.4748971
## estado 4 0.5860082
## estado 5 0.6526749</code></pre>
<p>El tiempo esperado hasta que la cola este vacia de nuevo son 0.1736 horas o 10.42 minutos.</p>
<div class="example">
<p><span id="exm:unlabeled-div-55" class="example"><strong>Ejemplo 4.14  </strong></span>En las condiciones del sistema de <code>mantenimiento de areonaves</code> descrito anteriormente. Supongamos que en un experimento de prueba el avión despega con cuatro motores motores que funcionan correctamente y sigue volando hasta que se estrella. Estamos interesados en conocer el tiempo esperado del accidente.</p>
<p>Recordemos que el espacio de estados del sistema es <span class="math inline">\(\{1, 2,...,,9\}\)</span>, y sabemos que el avión se estrallará si en algún momento accedemos al subconjunto de estados <span class="math inline">\(\{1, 2, 3, 4, 7\}.\)</span> Calculamos los tiempos de primer paso cuando <span class="math inline">\(X(0) = \{5, 6, 8, 9\}\)</span>, aunque como el avión está en condiciones çoptimas para despegar nos debermeos fijar en el valor correspondiente al estado 9. Recordemos que el tiempo medio hasta que falla un motor es de 200 horas, de forma que <span class="math inline">\(\lambda = 1/200 = 0.005.\)</span></p>
</div>
<div class="sourceCode" id="cb517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Definición matriz de tasas</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">9</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">0.005</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">7</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>

<span class="co"># Conjunto que debemos alcanzar</span>
<span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>
<span class="co"># Tiempos de primer paso </span>
<span class="fu">tiempos.primer.paso</span><span class="op">(</span><span class="va">R</span>, <span class="va">A</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></code></pre></div>
<pre><code>##            tiempo
## estado 5 100.0000
## estado 6 133.3333
## estado 8 133.3333
## estado 9 183.3333</code></pre>
<p>De esta forma, partiendo de un avión en condiciones óptimas el tiempo ahsta que ocurra un incidente que le impida volar es de 183.33 horas, o lo que es lo mismo 183 horas y 20 minutos.</p>
</div>
<div id="CMTCK" class="section level2" number="4.11">
<h2>
<span class="header-section-number">4.11</span> Ejercicios<a class="anchor" aria-label="anchor" href="#CMTCK"><i class="fas fa-link"></i></a>
</h2>
<p>Los ejercicios que se presentan a continuación se estruturan en dos niveles de dificultad. El primer nivel son ejercicios más básicos (codificados con una B), y que son parte de los ejmplos rabajados en la unidad, mientras que el segundo bloque necesitan una mayor cantidad de trabajo (codificados con una A). Al final de los ejercicios se encuentra el código de <code>R</code> para resolver algunos de dichos ejercicios. Cuando consideres necesario puedes plantear una solución mediante simulación para contestar a las preguntas de interés.</p>
<p><strong>Ejercicio B-1.</strong> Para el proceso de <code>mantenimiento de máquinas</code> estamos interesados en calcular el valor esperado del número de máquinas en funcionamiento después de 9 horas de funcionamiento, suponiendo que el sistema empieza con todas las máquinas paradas.</p>
<p><strong>Ejercicio B-2.</strong> Para el proceso de <code>mantenimiento de aeronaves</code> supongamos que cada motor funciona en promedio unas 200h antes de detectarse cualquier problema. Si los cuatro motores están funcionando antes de comenzar un vuelo de seis horas ¿cuál es la probabilidad de que el vuelo llegue de forma segura? (Hint: Para seolver este ejercico ten en cuenta la codificación de estados establecida en la definición del sistema).</p>
<p><strong>Ejercicio B-3.</strong> Para el proceso de <code>centralita telefónica</code> supongamos que la capacidad total de la centralita es de 10 llamadas y que se reciben llamadas a una tasa de 1 por minuto, y que el tiempo medio de atención de cada llamada es de 10 minutos. Si ahora mismo la centralita está atendiendo a 3 llamadas:</p>
<ul>
<li>¿cuál es la probabilidad de que la centralita este como máximo al 50% de su capacidad dentro de media hora? ¿y dentro de una hora?.</li>
<li>Si la centralita está activa durante 6 horas más ¿cuantas llamadas estarán pendientes al finalizar el tiempo de trabajo?</li>
</ul>
<p><strong>Ejercicio B-4.</strong> Para el proceso de <code>sistema de inventarios</code> supongamos que la capacidad máxima de stock del producto <span class="math inline">\(KD\)</span> es 20, y que se solicitan nuevas piezas cuando el stock es inferior a 6. Además tenemos que la tasa de entrega de nuevos productos es de tres días, mientras que la demanda de dicho producto es de 3 piezas/dia. Si en estos momentos no hay stock de la pieza <span class="math inline">\(KD\)</span> la empresa esta interesada en conocer ¿cuál es el stock más probable dentro de 8 días? ¿cuál es la probabilidad de que tengamos que reabastecernos al finalizar de los ocho días?</p>
<p><strong>Ejercicio B-5.</strong> Para el proceso <span class="math inline">\(M/M/1/K\)</span> del <code>cajero bancario</code> supongamos que los clientes llegan con una tasa de 10 por hora y que tardan en promedio unos cuatro minutos en realizar las operaciones con el cajero. Supongamos que hay espacio para como máximo cinco clientes delante del cajero automático, mientras que un cliente está siendo atendido. Si el cajero está inactivo ¿cuál es el tiempo esperado de inactividad del cajero durante la siguiente hora?.</p>
<p><strong>Ejercicio B-6.</strong> Para el <code>proceso de fabricación</code> consideramos la situación siguiente. Supongamos que el sistema funciona las 24 horas del día, las demandas se producen a cinco por hora y el tiempo medio de fabricación de un artículo es de 10 minutos. La máquina se pone en marcha cuando el stock de artículos fabricados se reduce a dos, y permanece encendida hasta que las existencias aumentan a cuatro, momento en el que se apaga. Supongamos que el stock es de cuatro (y la máquina está apagada) al principio. Estamos interesados en la cantidad de tiempo esperada durante el cual la máquina está encendida durante las siguientes 24 horas.</p>
<p><strong>Ejercicio B-7.</strong> Para el proceso de <code>sistema de inventarios</code> supongamos que la capacidad máxima de stock del producto <span class="math inline">\(KD\)</span> es 20, y que se solicitan nuevas piezas cuando el stock es inferior a 6. Además tenemos que la tasa de entrega de nuevos productos es de tres días, mientras que la demanda de dicho producto es de 3 piezas/dia. Si en estos momentos no hay stock de la pieza <span class="math inline">\(KD\)</span> la empresa esta interesada en conocer ¿cuál es el tiempo esperado durante el cúal se debe reabastecer el almacén durante los próximos 8 días?</p>
<p><strong>Ejercicio B-8.</strong> Para el proceso de <code>centralita telefónica</code> supongamos que la capacidad total de la centralita es de 10 llamadas y que se reciben llamadas a una tasa de 1 por minuto, y que el tiempo medio de atención de cada llamada es de 10 minutos. Si ahora mismo la centralita está atendiendo a 3 llamadas ¿cuál es el tiempo esperado de que el sistema este por encima del 80% de ocupación? ¿y por debajo del 20%? ¿cuál es el tiempo esperado de que el sitema este a plena capacidad?</p>
<p><strong>Ejercicio B-9.</strong> Para el sistema de <code>mantenimiento de máquinas</code> consideramos cuatro máquinas disponibles y dos operarios para repararlas en caso de fallo con tiempos de vida de las máquinas exponenciales con media de 3 días, y tiempos medios de reparación de 2 horas. Estamos interesados en la probabilidad a largo plazo de que todas las máquinas estén en funcionamiento, y en la fracción de tiempo a largo plazo que los dos operarios están ocupados.</p>
<p><strong>Ejercicio B-10.</strong> Para el proceso <span class="math inline">\(M/M/1/K\)</span> del <code>cajero bancario</code> supongamos que los clientes llegan con una tasa de 10 por hora y que tardan en promedio unos cuatro minutos en realizar las operaciones con el cajero. Supongamos que hay espacio para como máximo cinco clientes delante del cajero automático, mientras que un cliente está siendo atendido. ¿Cómo interpretamos estas probabilidades? ¿Cuál es la probabilidad de que tengamos más de dos clientes en la cola? ¿y de que tengamos como máximo 2?</p>
<p><strong>Ejercicio B-11.</strong> Para el sistema de <code>mantenimiento de aeronaves</code> estamos interesados en conocer cual es la probabilidad límite de que el avión no pueda finalizar el vuelo.</p>
<p><strong>Ejercicio B-12.</strong> Para el sistema del <code>vendedor por ciudades</code> viajante estamos interesados en conocer a la largo plazo cual es la proporción de tiempo que permanecerá en cada ciudad. En este caso la matriz de tasas debe tener en cuenta las probabilidades de moverse de una ciudad a otra. Si el beneficio que obtiene el vendedor es de 80 euros/día en la ciudad A, 100 euros/día en la ciudad B, 125 euros/día en C, y que además se incurre en un gasto por desplazamiento de 25 céntimos por kilómetro caundo hay 50 kilómetros entre A y B, 65 kilómetros entre A y C, y 80 kilómetros entre B y C ¿cuál es el beneficio total esperado del sistema para un periodo de un mes? ¿Cuál es la tasa de coste a largo plazo? Si el viajante comienza su viaje en la ciudad A ¿cuál es el tiempo esperado hasta que el viajante vuelva a la ciudad A?</p>
<p><strong>Ejercicio B-12.</strong> Un taller mecánico consta de dos taladradoras y dos tornos. Los tiempos de vida de las taladradoras son variables aleatorias <span class="math inline">\(Exp(\mu_b)\)</span> y las de los tornos son variables aleatorias <span class="math inline">\(Exp(\mu_l)\)</span>. El taller mecánico tiene dos reparadores: Al y Bob. Al puede reparar tanto tornos como taladros, mientras que Bob sólo puede reparar tornos. Los tiempos de reparación de las taladradoras son <span class="math inline">\(Exp(\lambda_b\)</span> y para los tornos <span class="math inline">\(Exp(\lambda_l)\)</span>, independientemente de quién repare las máquinas. Las taladradoras tienen prioridad en las reparaciones. Las reparaciones pueden adelantarse. Haciendo las suposiciones de independencia apropiadas independencia, modelar este taller mecánico como un CMTC, considerando el proceso <span class="math inline">\(A(t) = (b, l)\)</span> que indica el número de taladros y tornos en funcionamiento en el instante <span class="math inline">\(t\)</span> y obtener la correspondiente matriz de tasas.</p>
<p><strong>Ejercicio A-1</strong> Un fondo de inversión se clasifica en cuatro estados según los beneficios que produce por unidad de tiempo: altos, medios, bajos, y pérdidas. Además, el movimiento entre estados puede ser visto como una CMTC con matriz de tasas:</p>
<p><span class="math display">\[
R = \begin{pmatrix}
0 &amp; 0.1 &amp; 0.1 &amp; 0\\
0 &amp; 0 &amp; 0.3 &amp; 0.1\\
0 &amp; 0 &amp; 0.5 &amp; 0.5\\
1.5 &amp; 0 &amp; 0  &amp; 0 
\end{pmatrix}
\]</span> Mientras que el sistema está en cada uno de los estados, el beneficio respectivo estimado es de 500, 250, 100, y -600 euros por unidad de tiempo.</p>
<ul>
<li>¿cuál es el coste total esperado para un periodo de 10 unidades de tiempo?</li>
<li>¿cuál será la tasa de coste a largo plazo?</li>
<li>Si ahora mismo estamos en pérdidas ¿cuánto tiempo tiene que pasar hasta que alcanzemos beneficios altos?</li>
</ul>
<p>La empresa considera que si el coste del estado de pérdidas se duplicará (pasar de 600 a 1200) mejorarían los datos de las cuestiones anteriores ¿qué lo podemos decir a la empresa?</p>
<p><strong>Ejercicio A-2.</strong> Sea <span class="math inline">\(\{X(t), t \geq 0\}\)</span> una CMTC con estados <span class="math inline">\(\{1, 2, 3, 4, 5\}\)</span> y matriz de tasas</p>
<p><span class="math display">\[
R = \begin{pmatrix}
0 &amp; 4 &amp; 4 &amp; 0 &amp; 0\\
5 &amp; 0 &amp; 5 &amp; 5 &amp; 0\\
5 &amp; 5 &amp; 0 &amp; 4 &amp; 4\\
0 &amp; 5 &amp; 5  &amp; 0 &amp; 4\\
0 &amp; 0&amp; 5&amp; 5&amp; 0
\end{pmatrix}
\]</span></p>
<ul>
<li>Calcular la matriz de tiempos de ocupación para <span class="math inline">\(t=0.2\)</span>.</li>
<li>Obtener la distribución límite del proceso.</li>
<li>Si el sistema incurre en costes de acuerdo a la ecuación <span class="math inline">\(c(i) = 2i+1, \quad 1\leq i\leq 5\)</span> ¿Cuál el coste total esperado en el intervalo de tiempo <span class="math inline">\([0, 10]\)</span>, si el sistema está ahora mismo en el estado 2. ¿Cuál sería la tasa de coste a largo plazo?</li>
<li>¿Cuál es el tiempo esperado para ir del estado 1 al estado 5?</li>
</ul>
<p><strong>Ejercicio A-3.</strong> Sea <span class="math inline">\(\{X(t), t \geq 0\}\)</span> una CMTC con estados <span class="math inline">\(\{1, 2, 3, 4, 5, 6\}\)</span> y matriz de tasas</p>
<p><span class="math display">\[
R = \begin{pmatrix}
0 &amp; 6 &amp; 6 &amp; 8 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 6 &amp; 8 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 6 &amp; 4 &amp; 0\\
0 &amp; 6 &amp; 8  &amp; 0 &amp; 0 &amp; 0\\
6 &amp; 0&amp; 0&amp; 0&amp; 6 &amp; 0
\end{pmatrix}
\]</span></p>
<ul>
<li>Calcular la matriz de tiempos de ocupación para <span class="math inline">\(t=0.1\)</span>.</li>
<li>Obtener la distribución límite del proceso.</li>
<li>Si el sistema incurre en costes de acuerdo a la ecuación <span class="math inline">\(c(i) = 2i^2+3, \quad 1\leq i\leq 6\)</span> ¿Cuál el coste total esperado en el intervalo de tiempo <span class="math inline">\([0, 15]\)</span>, si el sistema está ahora mismo en el estado 4. ¿Cuál sería la tasa de coste a largo plazo?</li>
<li>¿Cuál es el tiempo esperado para ir del estado 6 al estado 4?</li>
</ul>
<p><strong>Ejercicio A-4.</strong> Un peso de <span class="math inline">\(18\)</span> toneladas está sostenido por <span class="math inline">\(3\)</span> cables que se reparten la carga por igual. Cuando uno de los cables se rompe, los restantes, que no se han roto, se reparten la carga a partes iguales. Cuando se rompe el último cable, se produce un fallo. La tasa de fallos de un cable es <span class="math inline">\(0.2\)</span> por año y tonelada. Los tiempos de vida de los <span class="math inline">\(3\)</span> cables son independientes entre sí. Se considera <span class="math inline">\(X(t)\)</span> como el número de cables que siguen sin romperse en el momento <span class="math inline">\(t\)</span>.</p>
<ul>
<li>¿Cuál es la probabilidad de que el sistema dure más de dos años?</li>
<li>¿Cuál es el tiempo estimado hasta que el sistema falle si ahora los tres cables están bien?</li>
</ul>
<p><strong>Ejercicio A-5.</strong> Un ordenador tiene cinco unidades de procesamiento (CPUs). Los tiempos de vida de las CUPs son variables aleatorias iid exponenciales de media 2 años. Cuando una CPU falla, el ordenador intenta aislarla automáticamente y reconfigurar el sistema con las demás CPU. Sin embargo, este proceso tiene éxito con una probabilidad <span class="math inline">\(0.94\)</span>, denominada factor de cobertura. Si la reconfiguración tiene éxito el sistema continúa con una CPU menos. Si el proceso falla, todo el sistema se bloquea. Supongamos que el proceso de reconfiguración es instantáneo y que una vez que el sistema se bloquea, se detiene definitivamente. Se considera <span class="math inline">\(X(t)\)</span> igual a cero si el sistema ha dejado de funcionar en el instante <span class="math inline">\(t\)</span>, o en caso contrario es igual al número de CPUs en funcionamiento en el momento <span class="math inline">\(t\)</span>.</p>
<ul>
<li>¿Cuál es la probabilidad de que los cinco procesadores funcionen 5 años sin fallos? (asumimos que todos los procesadores están en funcionamiento en el instante 0)</li>
</ul>
<p>Imaginemos ahora que el sistema puede ser reparado cuando falla. El tiempo enecesario para la reparación es una variable aleatoria exponencial de media 5 días, y una vez se finaliza todas las CPUS funcionan de nuevo.</p>
<ul>
<li>¿Cuál es la probabilidad límite de que el sistema este en reparación?.</li>
<li>¿cuál es el tiempo esperado hasta que el sistema falla y debe ser reparado si en estos momentos funcionan todos los procesadores?.</li>
<li>Supongamos que cada hora de trabajo de cada procesasor proporciona 100 euros de beneficio, mientras que las reparaciones cuestan 200 euros/hora. ¿cuál es el beneficio esperado durante el primer año si los cinco procesadores están trabajndo ahora mismo?</li>
</ul>
<p><strong>Ejercicio A-6.</strong> Una estación de servicio tiene tres servidores (1, 2, y 3). Cuando llega un cliente, es asignado al servidor libre con el índice más bajo. Si los servidores están ocupados el cliente no se detiene y deja la estación de servicio. Los tiempos de servicio de cada servidor son variables aletorias <span class="math inline">\(Exp(\mu_i)\)</span> con:</p>
<ul>
<li>media de 8 minutos para el servidor 1,<br>
</li>
<li>la media del servidor 2 es dos veces más rápido que el servidor 3,</li>
<li>la media del servidor 1 es dos veces más rápido que el servidor 2.</li>
</ul>
<p>Los clientes llegan de acuerdo a un <span class="math inline">\(PP(\lambda)\)</span> con tasa de 20 clientes por hora.</p>
<ul>
<li>¿cuál es la probabilidad de que los tres servidores esten ocupados a los 20 minutos, asumiendo que el sistema está vacio en el instante 0?</li>
<li>¿cuál es el tiempo de ocupación de cada estado del sistema en 50 minutos, asumiendo que el sistema está vacio en el instante 0?</li>
<li>¿cuál es el tiempo esperado hasta que los tres servidores estén libres, asumiendo qeu el sistema tiene un cliente?</li>
<li>Si los costes de los tres servidores son 40, 20 y 10 euros por hora respectivamente ¿cuál el valor de <span class="math inline">\(c\)</span> más pequeño que hace que el sistema sea rentable a largo plazo?</li>
</ul>
<p><strong>Ejercicio A-7.</strong> Una estación de servicio monoservicio atiende a dos tipos de clientes. Los clientes de tipo <span class="math inline">\(i, i = 1, 2,\)</span> llegan según un <span class="math inline">\(PP(\lambda_i)\)</span> independientes. La estación tiene espacio para atender como máximo a <span class="math inline">\(K\)</span> clientes. Los tiempos de servicio son variables aleatorias iid <span class="math inline">\(Exp(\mu)\)</span> para ambos tipos de clientes. La política de admisión es la siguiente. Si, en el momento de una llegada, el número total de clientes en el sistema es <span class="math inline">\(M\)</span> o menos (aquí <span class="math inline">\(M &lt; K\)</span> es es un número entero fijo), se permite que el cliente que llega se incorpore a la cola; en caso contrario sólo si es del tipo 1. Esto crea un trato preferente para los clientes de tipo 1. Sea <span class="math inline">\(X(t)\)</span> el número de clientes (de ambos tipos) en el sistema en el tiempo <span class="math inline">\(t\)</span> . Si las tasas de llegadas son de 5 y e minutos, la tasa de servicio es de 4 minutos, <span class="math inline">\(K = 5\)</span>, y <span class="math inline">\(M = 3\)</span>.</p>
<ul>
<li>¿Cuál es la variable de interés del sistema?</li>
<li>¿Cuáles son los tiempos de ocupación en el periodo de 60 minutos desde el inicio del servico, si en el instante inicial no hay clientes?</li>
<li>¿Cuál es la probabilidad a largo plazo de que la estación esté vacía?</li>
<li>Si al abrir la gasolinera tenemos un cliente ¿cuánto tiempo debe pasar hasta que rechazemos el primer cliente?</li>
</ul>
<p><strong>Ejercicio A-8</strong> Una pequeña gasolinera tiene un surtidor y espacio para un total de tres coches (uno en el en el surtidor y dos en espera). El tiempo entre las llegadas de los coches a la estación es una variable aleatoria exponencial con una tasa media de llegada de 10 coches por hora. El tiempo que cada coche pasa delante del surtidor es una variable aleatoria exponencial con una media de cinco minutos (es decir, una tasa media de 12 por hora). Si hay tres coches en la estación y llega otro coche, el coche recién llegado sigue su camino y nunca entra en la estación. Considera <span class="math inline">\(X(t)\)</span> como el número de coches en la estación en el momento <span class="math inline">\(t\)</span>.</p>
<ul>
<li>¿Cuál es la probabilidad a largo plazo de que la estación esté vacía?</li>
<li>¿Cuál es el número esperado de coches en la estación a largo plazo?</li>
<li>¿Cuál es la proporción de tiempo que la estación estará completa en un periodo de 8 horas?</li>
<li>Si al abrir la gasolinera tenemos un cliente ¿cuánto tiempo debe pasar hasta que no tengamos ningún cliente en el sistema? ¿y más de uno?</li>
</ul>
<p><strong>Ejercicio A-9 (Cola</strong> <span class="math inline">\(M^x/M/1/K\)</span>). Una pequeña tienda de autoservicio 24 horas de carretera tiene espacio para 5 automóviles en el parking. Los vehículos llegan al azar, siendo los tiempos de llegada una variable aleatoria exponencial con una media de 10 vehículos por hora. El número de personas dentro de cada coche es una variable aleatoria, <span class="math inline">\(N\)</span>, donde <span class="math inline">\(P(N = 1) = 0.1\)</span>, <span class="math inline">\(P(N = 2) = 0.7\)</span> y <span class="math inline">\(P(N = 3) = 0.2\)</span>. La gente de los coches entra en la tienda y permanece en ella un tiempo exponencial. La duración media de la estancia en la tienda es de 10 minutos y cada persona actúa de forma independiente de todas las demás, saliendo de la tienda por separado y esperando en sus coches a los demás. Si llega un coche y la tienda está demasiado llena para que todas las personas del coche entren en ella, el coche saldrá y nadie de ese coche entrará en la tienda. Si <span class="math inline">\(X(t)\)</span> es el número de individuos en la tienda en el momento <span class="math inline">\(t\)</span>, obtén la matriz de tasas corespondiente a este proceso.</p>
<ul>
<li>¿Cuál es la probabilidad a largo plazo de que la tienda esté vacía?</li>
<li>¿Cuál es la proporción de tiempo que la estación estará completa en un periodo de 24 horas?</li>
</ul>
<p><strong>Ejercicio A-10.</strong> Un determinado equipo electrónico tiene dos componentes A y B. El tiempo hasta fallo del componente A está descrito por una función de distribución exponencial con un tiempo medio de 100 horas. El componente B tiene una vida media hasta el fallo de 200 horas y también está descrito por una distribución exponencial. Cuando uno de los componentes falla, el equipo se apaga y se realiza el mantenimiento. El tiempo de reparación del componente se distribuye exponencialmente con un tiempo medio de 5 horas si fue A el que falló y 4 horas si es B el que falla. Se considera el proceso <span class="math inline">\(X(t)\)</span> con espacio de estados <span class="math inline">\(\{1, 2, 3\}\)</span> donde el estado <span class="math inline">\(1\)</span> denota que el equipo está funcionando, <span class="math inline">\(2\)</span> denota que el componente A ha fallado, y <span class="math inline">\(3\)</span> denota que el componente B ha fallado.</p>
<ul>
<li>¿Cuál es la probabilidad a largo plazo de que el equipo funcione?</li>
<li>¿cuál es la proporción de tiempo esperado que el sistema estará funcionando durante las próximas 500 horas?</li>
<li>Un contratista externo realiza los trabajos de reparación de los componentes cuando se produce un fallo y cobra 100 euros por hora por el tiempo más los gastos de viaje, lo que supone 500 euros más por cada visita. La empresa ha determinado que puede contratar y formar a su propio propio reparador. Si cuentan con su propio empleado para las reparaciones, le costará 40 euros por hora, tanto cuando la máquina esté en funcionamiento como cuando esté parada. Ignorando el coste de la formación inicial y la posibilidad de que un empleado contratado para los trabajos de reparación pueda hacer otras cosas mientras la máquina está en funcionamiento, ¿merece la pena económicamente contratar y formar a su propia persona?</li>
</ul>
<p><strong>Ejercicio A-11.</strong> Una pieza de automóvil necesita tres operaciones de mecanizado realizadas en una determinada secuencia. Estas operaciones son realizadas por tres máquinas. La pieza se introduce en la primera máquina, donde la operación de mecanizado dura en media 1 minuto. Una vez finalizada la operación, la pieza pasa a la máquina 2, donde el mecanizado requiere un tiempo medio de 1.2 minutos. A continuación, pasa a la máquina 3, donde la operación dura en promedio 1 minuto. No hay espacio de almacenamiento entre las dos máquinas, por tanto si la máquina 2 esta trabajando, la pieza de la máquina 1 no puede ser retirada aunque la operación en la máquina 1 se haya completado. Decimos que la máquina 1 está bloqueada en este caso. Hay un amplio suministro de piezas sin procesar disponibles de modo que la máquina 1 siempre puede procesar una nueva pieza cuando una pieza terminada se desplaza a la máquina 2. Modele este sistema como un CMTC. (Hint: Tenga en cuenta que la máquina 1 puede estar trabajar o estar bloqueada, la máquina 2 puede estar trabajando, bloqueada o inactiva, y la máquina 3 puede estar trabajando o inactiva).</p>
<ul>
<li>Calcular la cantidad de tiempo esperada que la máquina 1 está bloqueada durante la primera hora, asumiendo que todas la máquinas están trabajando en el instante 0.</li>
<li>Calcule la fracción de tiempo a largo plazo en que la última máquina está trabajando en el sistema de producción.</li>
<li>Cada máquina cuesta 40 euros por hora mientras trabaja en un componente y produce un beneficio de 75 euros/hora a la pieza en la que trabaja. El valor añadido, o el coste de funcionamiento, es cero cuando la máquina está parada o bloqueada. Calcula la contribución neta de las tres máquinas por unidad de tiempo a largo plazo.</li>
</ul>
</div>
<div id="CMTCL" class="section level2" number="4.12">
<h2>
<span class="header-section-number">4.12</span> Soluciones<a class="anchor" aria-label="anchor" href="#CMTCL"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Ejercicio B-1.</strong></p>
<div class="sourceCode" id="cb519"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de tasas</span>
<span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">estados</span><span class="op">)</span>

<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">72</span> 

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">*</span><span class="va">mu</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span><span class="op">*</span><span class="va">mu</span></code></pre></div>
<p>Distribución de probabilidad asociada al evento de interés:</p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de probabilidades de transición</span>
<span class="va">Pmat</span><span class="op">&lt;-</span><span class="fu">matriz.prob.trans</span><span class="op">(</span><span class="va">R</span>, <span class="fl">9</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co"># Distribución de probabildiad buscada</span>
<span class="va">Pmat</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></code></pre></div>
<pre><code>## [1] 0.0002 0.0020 0.0136 0.1547 0.8295</code></pre>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># valor esperado</span>
<span class="va">esperanza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">estados</span><span class="op">*</span><span class="va">Pmat</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Solución con simmer:</p>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">replicas</span> <span class="op">&lt;-</span> <span class="fl">2500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">replicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">maquinas</span> <span class="op">&lt;-</span> <span class="fu">mantenimiento</span><span class="op">(</span><span class="fl">9</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">72</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co"># almacenamos análisis de recursos del sistema</span>
<span class="va">simresource</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Almacenamos el estado final de la cola en el último instante del sistema</span>
<span class="va">salida</span> <span class="op">&lt;-</span> <span class="va">simresource</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">resource</span> <span class="op">==</span> <span class="st">"funcionando"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#seleccionamos el recurso adecuado</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>estado <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">system</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Estimamos la distribución de probabilidad</span>
<span class="va">distrprob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">salida</span><span class="op">$</span><span class="va">estado</span><span class="op">)</span><span class="op">/</span><span class="va">replicas</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">esperanza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">distrprob</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">distrprob</span><span class="op">)</span>
<span class="va">esperanza</span></code></pre></div>
<pre><code>## [1] 0.101</code></pre>
<p><strong>Ejercicio B-2.</strong></p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de tasas</span>
<span class="va">estados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"(0, 0)"</span>, <span class="st">"(0, 1)"</span>, <span class="st">"(0, 2)"</span>, <span class="st">"(1, 0)"</span>, 
             <span class="st">"(1, 1)"</span>, <span class="st">"(1, 2)"</span>, <span class="st">"(2, 0)"</span>, <span class="st">"(2, 1)"</span>, <span class="st">"(2,2)"</span><span class="op">)</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">estados</span><span class="op">)</span>

<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">7</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span></code></pre></div>
<p>Probabilidades de transición para el evento de interés:</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de probabilidades de transición</span>
<span class="va">Pmat</span><span class="op">&lt;-</span><span class="fu">matriz.prob.trans</span><span class="op">(</span><span class="va">R</span>, <span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co"># Calculamos la probabilidad buscada</span>
<span class="va">probabilidad</span> <span class="op">&lt;-</span> <span class="va">Pmat</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">+</span> <span class="va">Pmat</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">+</span> <span class="va">Pmat</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">+</span> <span class="va">Pmat</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">9</span><span class="op">]</span>
<span class="va">probabilidad</span></code></pre></div>
<pre><code>## [1] 0.9982</code></pre>
<p>Por tanto, la probabilidad de un fallo que le impida al avión finalizar el viaje es 0.0018.</p>
<p><strong>Ejercicio B-5.</strong></p>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Matriz de tasas</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">15</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span></code></pre></div>
<p>Obtenemos ahora la matriz <span class="math inline">\(M(1)\)</span>:</p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tiempos.ocupacion</span><span class="op">(</span><span class="va">R</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>##        [,1]   [,2]   [,3]   [,4]   [,5]   [,6]
## [1,] 0.4451 0.2548 0.1442 0.0814 0.0465 0.0280
## [2,] 0.3821 0.2793 0.1604 0.0920 0.0535 0.0326
## [3,] 0.3246 0.2407 0.2010 0.1187 0.0710 0.0441
## [4,] 0.2746 0.2070 0.1780 0.1695 0.1046 0.0663
## [5,] 0.2356 0.1806 0.1598 0.1569 0.1624 0.1047
## [6,] 0.2124 0.1648 0.1489 0.1492 0.1571 0.1677</code></pre>
<p>Estamos interesados en la transición <span class="math inline">\(X(0) = 0\)</span> a <span class="math inline">\(X(1) = 0\)</span> que corresponde con el elemento <span class="math inline">\([1,1]\)</span> de la matriz obtenida. Utilizando <code>simmer</code>:</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Réplicas del proceso</span>
<span class="va">replicas</span> <span class="op">&lt;-</span> <span class="fl">2500</span>
<span class="va">envs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">replicas</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cajero</span> <span class="op">&lt;-</span> <span class="fu">cola.MM1K</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co"># almacenamos análisis de llegadas del sistema</span>
<span class="va">simarrivals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="va">simresources</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">envs</span><span class="op">)</span><span class="op">)</span>
<span class="co"># detectamos los instantes de tiempo donde el sistema esta libre y obtenemos los tiempos correspondientes</span>
<span class="va">res</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span>  <span class="fl">1</span><span class="op">:</span><span class="va">replicas</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">simresources</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">simresources</span><span class="op">$</span><span class="va">replication</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span>, <span class="op">]</span>
  <span class="va">deltas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
  <span class="va">free</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">system</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>
  <span class="va">t_free</span> <span class="op">&lt;-</span> <span class="va">deltas</span><span class="op">[</span><span class="va">free</span><span class="op">]</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">t_free</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>El tiempo que el sistema esta libre es de <code>mean(res)</code> horas. En este caso, la estimación obtenida si es más diferente del ressultado teórico. Podrímaos incluir un mayor número de réplicas para intentar conseguir algo más de precisión.</p>
<p><strong>Ejercicio B-6.</strong></p>
<p>Sea <span class="math inline">\(X(t)\)</span> el número de artículos en stock en el tiempo <span class="math inline">\(t\)</span>, e <span class="math inline">\(Y(t)\)</span> el estado de la máquina en el tiempo <span class="math inline">\(t\)</span>. El conjunto de estados de este proceso viene dado por:</p>
<p><span class="math display">\[S = \{1 = (0, 1), 2 = (1, 1), 3 = (2, 1), 4 = (3, 1), 5 = (4, 0), 6 = (3, 0)\}.\]</span> En la situación inicial nos encontramos en el estado <span class="math inline">\(5 = (4, 0) = (X(0), Y(0))\)</span> y estamos interesados en el tiempo en que la máquina estará después de 24 horas en los estados <span class="math inline">\(1, 2, 3\)</span> o <span class="math inline">\(4\)</span>, es decir:</p>
<p><span class="math display">\[m_{51}(24) + m_{52}(24) + m_{53}(24) + m_{54}(24)\]</span> En esta situación tenemos que la tasa de producción es <span class="math inline">\(\lambda = 60/10 = 6\)</span> y la de demanda es <span class="math inline">\(\mu = 5\)</span>, de forma que la matriz de tasas viene dada por:</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span>
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span></code></pre></div>
<p>Obtenemos ahora la matriz <span class="math inline">\(M(24)\)</span>:</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mmat</span><span class="op">&lt;-</span><span class="fu">tiempos.ocupacion</span><span class="op">(</span><span class="va">R</span>, <span class="fl">24</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">mmat</span></code></pre></div>
<pre><code>##        [,1]   [,2]   [,3]   [,4]   [,5]   [,6]
## [1,] 4.0004 4.6322 5.4284 2.9496 3.5097 3.4798
## [2,] 3.8602 4.6639 5.4664 2.9703 3.5345 3.5047
## [3,] 3.7697 4.5553 5.5361 3.0084 3.5802 3.5503
## [4,] 3.7207 4.4965 5.4656 3.0608 3.6431 3.6132
## [5,] 3.7063 4.4793 5.4448 2.9586 3.7204 3.6906
## [6,] 3.7380 4.5173 5.4905 2.9835 3.5503 3.7204</code></pre>
<p>La cantidad buscada viene dada por:</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">mmat</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 16.589</code></pre>
<p><strong>Ejercicio B-9.</strong></p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maquinas</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">estados</span> <span class="op">&lt;-</span> <span class="va">maquinas</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">operarios</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">72</span>
<span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">maquinas</span> <span class="op">-</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">maquinas</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">operarios</span><span class="op">)</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">mus</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">maquinas</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">mu</span>
<span class="co"># Debemos quitar el último elemento de lambda y el primero de mu para usar la función definida</span>
<span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.nm</span><span class="op">(</span><span class="va">estados</span>, <span class="va">lambdas</span>, <span class="va">mus</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in prl/prm: longitud de objeto mayor no es múltiplo de la longitud de uno menor</code></pre>
<div class="sourceCode" id="cb539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">probs</span></code></pre></div>
<pre><code>## [1] 1.540618e-05 1.109245e-03 3.993283e-02 9.583879e-01 5.546226e-04</code></pre>
<p>Así, a largo plazo, todas las máquinas funcionan el 89,6% del tiempo (<span class="math inline">\(p_4 = p[5]\)</span>). Ambos operarios están ocupados siempre que el sistema está en el estado <span class="math inline">\(0\)</span>, <span class="math inline">\(1\)</span> o <span class="math inline">\(2\)</span>. Por lo tanto, la fracción de tiempo a largo plazo en que ambos reparadores están ocupados viene dada por <span class="math inline">\(p_0 + p_1 + p_2\)</span>:</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">probs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.04105748</code></pre>
<p><strong>Ejercicio B-10.</strong></p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maxcola</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">estados</span> <span class="op">&lt;-</span> <span class="va">maxcola</span> <span class="op">+</span> <span class="fl">1</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">15</span>
<span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">lambda</span>, <span class="va">maxcola</span><span class="op">)</span>
<span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">maxcola</span><span class="op">)</span>
<span class="co"># Distribución límite</span>
<span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.nm</span><span class="op">(</span><span class="va">estados</span>, <span class="va">lambdas</span>, <span class="va">mus</span><span class="op">)</span>
<span class="va">probs</span></code></pre></div>
<pre><code>## [1] 0.36541353 0.24360902 0.16240602 0.10827068 0.07218045 0.04812030</code></pre>
<p><strong>Ejercicio B-11.</strong></p>
<p>Recordemos que el espacio de estados es <span class="math inline">\(\{1, 2,...,9\}\)</span> y nos intersa obtener la probabilidad del sujconjunto <span class="math inline">\(\{1, 2, 3, 4, 7\}\)</span>. Obtenemos en primer lugar la matriz de tasas:</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estados del sistema</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">9</span>
<span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>
<span class="co"># Matriz de tasas</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">7</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="va">R</span><span class="op">[</span><span class="fl">9</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">lambda</span>
<span class="co"># Resolución  de las ecuaciones de balance</span>
<span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.general</span><span class="op">(</span><span class="va">R</span><span class="op">)</span>
<span class="va">ps</span></code></pre></div>
<pre><code>## [1] 1 0 0 0 0 0 0 0 0</code></pre>
<p><strong>Ejercicio B-12.</strong></p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estados del sistema</span>
<span class="va">nestados</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="co"># Matriz de tasas</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">nestados</span>, ncol <span class="op">=</span> <span class="va">nestados</span>, data <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> 
<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>
<span class="va">R</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">R</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">6</span>
<span class="va">R</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="co"># Resolución  de las ecuaciones de balance</span>
<span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">distr.lim.general</span><span class="op">(</span><span class="va">R</span><span class="op">)</span>
<span class="co"># Expresando en porcentajes</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">ps</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 54.55 18.18 27.27</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="poissonprocess.html"><span class="header-section-number">3</span> Proceso de Poisson</a></div>
<div class="next"><a href="COLAS.html"><span class="header-section-number">5</span> Sistemas de colas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#CMTC"><span class="header-section-number">4</span> Cadenas de Markov de Tiempo Contínuo</a></li>
<li><a class="nav-link" href="#CMTCA"><span class="header-section-number">4.1</span> Evolución del proceso</a></li>
<li><a class="nav-link" href="#CMTCB"><span class="header-section-number">4.2</span> Descripción del proceso</a></li>
<li>
<a class="nav-link" href="#CMTCC"><span class="header-section-number">4.3</span> Análisis preliminar del proceso</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sistema-de-vida-%C3%BAtil-de-una-m%C3%A1quina"><span class="header-section-number">4.3.1</span> Sistema de vida útil de una máquina</a></li>
<li><a class="nav-link" href="#sistema-del-viajante"><span class="header-section-number">4.3.2</span> Sistema del viajante</a></li>
<li><a class="nav-link" href="#an%C3%A1lisis-con-simmer"><span class="header-section-number">4.3.3</span> Análisis con simmer</a></li>
<li><a class="nav-link" href="#mantenimiento-de-aronaves"><span class="header-section-number">4.3.4</span> Mantenimiento de aronaves</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#CMTCD"><span class="header-section-number">4.4</span> Procesos de nacimiento y muerte</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#colas-de-espera-de-capacidad-finita-con-un-servidor"><span class="header-section-number">4.4.1</span> Colas de espera de capacidad finita con un servidor</a></li>
<li><a class="nav-link" href="#excmtc007"><span class="header-section-number">4.4.2</span> Mantenimiento de máquinas</a></li>
<li><a class="nav-link" href="#central-telef%C3%B3nica"><span class="header-section-number">4.4.3</span> Central telefónica</a></li>
<li><a class="nav-link" href="#call-center"><span class="header-section-number">4.4.4</span> Call Center</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#CMTCE"><span class="header-section-number">4.5</span> Otros tipos de sistemas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#gesti%C3%B3n-de-inventarios"><span class="header-section-number">4.5.1</span> Gestión de inventarios</a></li>
<li><a class="nav-link" href="#proceso-de-fabricaci%C3%B3n"><span class="header-section-number">4.5.2</span> Proceso de fabricación</a></li>
</ul>
</li>
<li><a class="nav-link" href="#CMTCF"><span class="header-section-number">4.6</span> Probabilidades de transición</a></li>
<li><a class="nav-link" href="#CMTCG"><span class="header-section-number">4.7</span> Análisis de tiempos de ocupación</a></li>
<li><a class="nav-link" href="#CMTCH"><span class="header-section-number">4.8</span> Comportamiento límite del proceso</a></li>
<li>
<a class="nav-link" href="#CMTCI"><span class="header-section-number">4.9</span> Análisis de costes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#coste-total-esperado-a-tiempo-t"><span class="header-section-number">4.9.1</span> Coste total esperado a tiempo \(T\)</a></li>
<li><a class="nav-link" href="#tasas-de-coste-a-largo-plazo"><span class="header-section-number">4.9.2</span> Tasas de coste a largo plazo</a></li>
</ul>
</li>
<li><a class="nav-link" href="#CMTCJ"><span class="header-section-number">4.10</span> Tiempos de primer paso</a></li>
<li><a class="nav-link" href="#CMTCK"><span class="header-section-number">4.11</span> Ejercicios</a></li>
<li><a class="nav-link" href="#CMTCL"><span class="header-section-number">4.12</span> Soluciones</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Simulación de Procesos y Sistemas</strong>" was written by true, true. It was last built on 2022-03-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
