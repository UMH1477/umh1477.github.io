<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Unidad 7 Simulación DES con simmer | Simulación de Procesos y Sistemas</title>
<meta name="description" content="7.1 Simulación Algunos sistemas del mundo real contienen tal complejidad que es inviable representarlos íntegramente y de modo preciso a través de modelos analíticos; para estudiarlos sin embargo,...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Unidad 7 Simulación DES con simmer | Simulación de Procesos y Sistemas">
<meta property="og:type" content="book">
<meta property="og:description" content="7.1 Simulación Algunos sistemas del mundo real contienen tal complejidad que es inviable representarlos íntegramente y de modo preciso a través de modelos analíticos; para estudiarlos sin embargo,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unidad 7 Simulación DES con simmer | Simulación de Procesos y Sistemas">
<meta name="twitter:description" content="7.1 Simulación Algunos sistemas del mundo real contienen tal complejidad que es inviable representarlos íntegramente y de modo preciso a través de modelos analíticos; para estudiarlos sin embargo,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Simulación de Procesos y Sistemas</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Antes de comenzar</a></li>
<li><a class="" href="software.html">Software</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Conceptos básicos</a></li>
<li><a class="" href="cmtd.html"><span class="header-section-number">2</span> Cadenas de Markov de Tiempo Discreto</a></li>
<li><a class="" href="poissonprocess.html"><span class="header-section-number">3</span> Proceso de Poisson</a></li>
<li><a class="" href="CMTC.html"><span class="header-section-number">4</span> Cadenas de Markov de Tiempo Contínuo</a></li>
<li><a class="" href="COLAS.html"><span class="header-section-number">5</span> Sistemas de colas</a></li>
<li><a class="" href="SIMSIST.html"><span class="header-section-number">6</span> Aplicaciones prácticas</a></li>
<li><a class="active" href="simmerunidad.html"><span class="header-section-number">7</span> Simulación DES con simmer</a></li>
<li><a class="" href="bibliograf%C3%ADa.html">Bibliografía</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="simmerunidad" class="section level1" number="7">
<h1>
<span class="header-section-number">Unidad 7</span> Simulación DES con simmer<a class="anchor" aria-label="anchor" href="#simmerunidad"><i class="fas fa-link"></i></a>
</h1>
<div id="simulación-1" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Simulación<a class="anchor" aria-label="anchor" href="#simulaci%C3%B3n-1"><i class="fas fa-link"></i></a>
</h2>
<p>Algunos sistemas del mundo real contienen tal complejidad que es inviable representarlos íntegramente y de modo preciso a través de modelos analíticos; para estudiarlos sin embargo, podemos recurrir a la <strong>simulación</strong>.
<span class="citation"><a href="bibliograf%C3%ADa.html#ref-shannon" role="doc-biblioref">Robert E. Shannon</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-shannon" role="doc-biblioref"&gt;&lt;em&gt;Systems Simulation: The Art and Science&lt;/em&gt; (Prentice Hall, 1975)&lt;/a&gt;.&lt;/p&gt;'><sup>33</sup></a></span> define simulación como el proceso de diseñar un modelo de un sistema real y realizar experimentos con este modelo, con el propósito de comprender su comportamiento o de evaluar diversas estrategias para que el sistema opere (dentro de los límites impuestos por un criterio o conjunto de criterios).
Dependiendo de la naturaleza del sistema a representar, hay varios tipos de simulación.
Una taxonomía habitual común para clasificar los problemas de simulación lo hace considerando tres dimensiones:<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-lawkelton" role="doc-biblioref"&gt;Averill M. Law and W. David Kelton, &lt;em&gt;Simulation Modeling and Analysis, 3rd Edition&lt;/em&gt; (McGraw-Hill Education, 2000)&lt;/a&gt;.&lt;/p&gt;'><sup>34</sup></a></span></p>
<ol style="list-style-type: decimal">
<li>Variación aleatoria: <strong>determinística vs. estocástica</strong>, es decir, bien se utilizan fórmulas determinísticas o bien se incorpora variabilidad estocástica.</li>
<li>Variación en el tiempo: <strong>estática vs. dinámica</strong>, esto es, se simula un proceso estático que no varía a lo largo del tiempo, o uno dinámico que sí lo hace.</li>
<li>Variación en la medida: <strong>continua vs. discreta</strong>, es decir, el resultado o <em>output</em> medible del proceso varía de modo continuo o lo hace a saltos discretos.</li>
</ol>
</div>
<div id="simulación-des" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Simulación DES<a class="anchor" aria-label="anchor" href="#simulaci%C3%B3n-des"><i class="fas fa-link"></i></a>
</h2>
<p>La simulación de eventos discretos (Discrete Event Simulation -DES-) es una técnica específica para modelar sistemas <strong>estocásticos</strong> que evolucionan en el tiempo (son <strong>dinámicos</strong>) a saltos <strong>discretos</strong>, esto es, su estado cambia de forma discreta en instantes concretos a lo largo de instantes de tiempo que se secuencian según alguna ley de probabilidad.</p>
<p>Son ejemplos de procesos DES las colas de espera, los productos en una cadena de producción, e incluso los objetos digitales que se mueven en una red social.
Su naturaleza discreta permite describir su comportamiento en términos de <strong>eventos</strong>, esto es, de una ocurrencia instantánea que puede cambiar el estado del sistema, mientras que entre eventos consecutivos todas las variables de estado van a permanecer invariables.</p>
<p>Las aplicaciones DES son muy numerosas: sistema de fabricación, ingeniería de la construcción, gestión de proyectos, logística, sistemas de transporte, procesos de negocios, salud, redes de comunicaciones, ….<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-banks" role="doc-biblioref"&gt;Barry Nelson Jerry Banks John Carson and David Nicol, &lt;em&gt;Discrete-Event System Simulation, Fifth Edition&lt;/em&gt; (Pearson, 2009), &lt;/a&gt;&lt;a href="https://ggplot2.tidyverse.org" role="doc-biblioref"&gt;https://ggplot2.tidyverse.org&lt;/a&gt;.&lt;/p&gt;'><sup>35</sup></a></span>
La simulación de tales sistemas nos proporciona información sobre el riesgo, eficiencia y efectividad de los procesos, e incluso nos permite estudiar los efectos de introducir cambios en el sistema.
En servicios públicos nos permite estudiar cuellos de botella en colas, optimizar flujos de pacientes en los hospitales, testar la robustez de una cadena de producción o predecir el funcionamiento de un nuevo protocolo o configuración en una red de telecomunicaciones.</p>
<p>Existen tres aproximaciones básicas para proceder en la simulación DES:<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-banks" role="doc-biblioref"&gt;Jerry Banks and Nicol&lt;/a&gt;.&lt;/p&gt;'><sup>36</sup></a></span></p>
<ul>
<li>Orientada a la actividad (<em>activity-oriented</em>): el modelo consiste en secuencias de actividades que esperan a ser ejecutadas dependiendo de ciertas condiciones; el reloj de simulación avanza a incrementos fijos de tiempo. En cada paso se escanea toda la lista de actividades y se verifican sus condiciones de ejecución. Este modo de simular es demasiado sensible a la elección del incremento de tiempos, dada la aleatoriedad de los tiempos en que suceden los eventos.</li>
<li>Orientada a los eventos (<em>event-oriented</em>): mantiene una lista de eventos programados y ordenados por el tiempo en el que van a ocurrir. La simulación consiste en saltar de evento a evento, ejecutando secuencialmente las rutinas asociadas.</li>
<li>Orientada a los procesos (<em>process-oriented</em>): refina la simulación orientada a eventos añadiendo procesos que interactúan y cuya activación es desencadenada por eventos. En este caso, el modelizador define un conjunto de procesos que corresponden a entidades u objetos del sistema real y su ciclo de vida.</li>
</ul>
</div>
<div id="software-1" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Software<a class="anchor" aria-label="anchor" href="#software-1"><i class="fas fa-link"></i></a>
</h2>
<p>La librería <strong>simmer</strong><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-R-simmer" role="doc-biblioref"&gt;Ucar and Smeets, &lt;em&gt;Simmer&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>37</sup></a></span> es un paquete de R para simulación DES que permite una <strong>modelización orientada a procesos</strong> de alto nivel.
Además, explota el novedoso concepto de <em>trayectoria</em>: un camino común (o modo de comportamiento único) en el modelo de simulación para entidades (procesos) del mismo tipo (equivalentes).
Aprovecha además la definición de flujos de trabajo en cadena (<em>pipe</em>) del paquete <strong>magrittr</strong>.<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-R-magrittr" role="doc-biblioref"&gt;Bache and Wickham, &lt;em&gt;Magrittr&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>38</sup></a></span></p>
<p>La librería <strong>simmer</strong> se empezó a desarrollar en 2014 para resolver un problema de optimización de facilidades en servicios sanitarios, basada en la simulación de eventos discretos <em>DES</em>.
Está implementada en C++ y de ahí su eficiencia.</p>
<p>´simmer` no es la única librería de simulación de procesos en R, donde contamos también con las librerías:</p>
<ul>
<li>
<code>SpaDES</code>,<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-spades" role="doc-biblioref"&gt;Yong Luo Alex M Chubaty Eliot J B McIntire and Steve Cumming, &lt;em&gt;SpaDES: Develop and Run Spatially Explicit Discrete Event Simulation Models, Vs. 2.0.7&lt;/em&gt;, 2021, &lt;/a&gt;&lt;a href="https://cran.r-project.org/web/packages/SpaDES/index.html" role="doc-biblioref"&gt;https://cran.r-project.org/web/packages/SpaDES/index.html&lt;/a&gt;.&lt;/p&gt;'><sup>39</sup></a></span> que se centra en modelos discretos espaciales;</li>
<li>
<code>queuecomputer</code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-R-queuecomputer" role="doc-biblioref"&gt;Ebert, &lt;em&gt;Queuecomputer&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>40</sup></a></span> implementa un método eficiente para simular colas con llegadas y tiempos de servicio arbitrarios;</li>
<li>
<code>queueing</code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-R-queueing" role="doc-biblioref"&gt;Canadilla, &lt;em&gt;Queueing&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>41</sup></a></span> contiene múltiples funciones para analizar sistemas de colas.</li>
</ul>
<p>Más allá del lenguaje R, los competidores directos de <code>simmer</code> son <code>SimPy</code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-simpy" role="doc-biblioref"&gt;Team SimPy, &lt;span&gt;“SimPy: Discrete-Event Simulation for Python. Python Package”&lt;/span&gt; (Web, 2017), &lt;/a&gt;&lt;a href="https://simpy.readthedocs.io/en/stable" role="doc-biblioref"&gt;https://simpy.readthedocs.io/en/stable&lt;/a&gt;.&lt;/p&gt;'><sup>42</sup></a></span> y <code>SimJulia</code>,<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="bibliograf%C3%ADa.html#ref-simjulia" role="doc-biblioref"&gt;Ben Lauwens, &lt;span&gt;“SimJulia.jl: Combined Continuous-Time / Discrete-Event Process Oriented Simulation Framework Written in Julia. Julia Package”&lt;/span&gt; (Web, 2021), &lt;/a&gt;&lt;a href="https://github.com/BenLauwens/SimJulia.jl" role="doc-biblioref"&gt;https://github.com/BenLauwens/SimJulia.jl&lt;/a&gt;.&lt;/p&gt;'><sup>43</sup></a></span> construidos, respectivamente, bajo los lenguajes Python y Julia.</p>
<p>Instalamos y cargamos pues, las librerías vinculadas a <code>simmer</code> y otras generales básicas en R:</p>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://r-simmer.org">simmer.bricks</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-simmer.org">simmer.plot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="conceptos-clave" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Conceptos clave<a class="anchor" aria-label="anchor" href="#conceptos-clave"><i class="fas fa-link"></i></a>
</h2>
<p>Para entender la Simulación de Eventos Discretos (DES), es preciso controlar cierta terminología específica, que se muestra a continuación:</p>
<ul>
<li>
<p><strong>Recurso (<em>resource</em>)</strong>.
Se trata de una entidad pasiva que no se mueve pero proporciona un servicio o realiza una actividad dirigida a las llegadas que se producen en el sistema.
Todo recurso en <code>simmer</code> contiene dos elementos auto-gestionados:</p>
<ul>
<li>Servidor, que representa el recurso que da servicio o realiza la actividad, con una determinada capacidad y que puede ser accedido (<em>seized</em>) y abandonado (<em>released</em>).</li>
<li>Cola: una cola priorizada de cierto tamaño (puede ser infinita), que se llena cuando el servidor está a plena capacidad.</li>
</ul>
</li>
<li><p><strong>Gestor (<em>manager</em>)</strong>.
Es una entidad activa, esto es, se trata de un proceso que tiene la habilidad de reajustar las propiedades de un recurso (como su capacidad y tamaño de la cola) a medida que transcurre el tiempo (<em>run-time</em>).</p></li>
<li><p><strong>Fuente (<em>source</em>)</strong> es el proceso responsable de generar nuevas llegadas según un patrón de tiempos entre llegadas, y de integrarlas en el modelo de simulación.</p></li>
<li><p><strong>Llegada (<em>arrival</em>)</strong>.
Es un proceso capaz de interaccionar con los recursos o con otras entidades del modelo de simulación.
Puede tener atributos y valores de priorización asociados, y en general, tiene un tiempo de vida limitado.
Tras su creación, cada llegada es integrada en una trayectoria dada.</p></li>
<li><p><strong>Trayectoria (<em>trajectory</em>)</strong>.
Se trata de la secuenciación de actividades que definen el camino a seguir de cada una de las llegadas que acceden a ella.
El modelo de simulación se representa por un conjunto de trayectorias.</p></li>
<li><p><strong>Actividad (<em>activity</em>)</strong> es la unidad individual de acción que permite que las llegadas interactúen con los recursos y otras entidades, realicen rutinas mientras están en el sistema, retrocedan y avancen a lo largo de la trayectoria de forma dinámica, etc.</p></li>
</ul>
<p>Todos los procesos son susceptibles de ser representados a través de diagramas de flujo.
Es conveniente siempre representarlos, con el fin de ordenar y mostrar con claridad los caminos y secuenciaciones involucradas.
Para crear diagramas de flujo disponemos de la simbología estándar <a href="https://docs.google.com/document/d/1F7urSCA-82umRB8a85P67yOiS35HNmbuL1FpLjemQ8Q/edit?usp=sharing">ANSI para diagramas de flujo</a>).</p>
</div>
<div id="entornos-y-trayectorias" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Entornos y trayectorias<a class="anchor" aria-label="anchor" href="#entornos-y-trayectorias"><i class="fas fa-link"></i></a>
</h2>
<p>La simulación con <code>simmer</code>, aunque se puede basar en los eventos, funciona mejor orientada a los procesos, esto es, enfocada a la identificación de fuentes y procesos y a las interacciones entre ellos.
Utiliza dos elementos básicos:</p>
<ul>
<li>El <strong>entorno de simulación</strong> se almacena en un objeto simmer definido por el comando <code>env()</code>, gestiona los recursos (<em>resources</em>) y las fuentes de llegadas (<em>generators</em>), controla la ejecución de la simulación y contiene los resultados de la simulación.</li>
<li>Las <strong>trayectorias</strong>, definidas con el comando <code><a href="https://r-simmer.org/reference/trajectory.html">trajectory()</a></code>, que contienen las secuencias de acciones o actividades que van a experimentar las llegadas. Cada actividad viene descrita por un verbo que representa una funcionalidad concreta (bloque funcional). El conjunto de acciones disponibles en <code>simmer</code> lo estudiaremos en la sección <a href="@acciones">Acciones</a>.</li>
</ul>
<p>Simular con <code>simmer</code> consiste, simplemente, en construir un entorno de simulación en el que se añaden recursos que dan servicios y se generan llegadas que acceden a trayectorias en las que desarrollan ciertas actividades y son atendidas por los recursos.
Toda la sintaxis se encadena con el comando pipe <code>%&gt;%</code>.</p>
<p>La Figura <a href="simmerunidad.html#fig:simmerentorno">7.1</a> ilustra de un modo sencillo la dinámica de simulación con <code>simmer</code> a partir de entornos y trayectorias: el simulador es inicializado con <code>simmer</code> y monitorizado con <code>monitor</code>.
Cada simulador contiene entidades constituidas por procesos y recursos.
A los procesos acceden las llegadas, provenientes de fuentes y reguladas por gestores, que realizan una serie de actividades que definen trayectorias y son ejecutadas por los recursos.
Así mismo, los gestores pueden interaccionar con los recursos.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:simmerentorno"></span>
<img src="images/simmer_entorno.png" alt="Figura 2. Entorno de simulación en `simmer` [Fte: IBiDat](https://ibidat.es/portfolio-items/simmer-discrete-event-simulation-for-r/)" width="80%"><p class="caption">
Figura 7.1: Figura 2. Entorno de simulación en <code>simmer</code> <a href="https://ibidat.es/portfolio-items/simmer-discrete-event-simulation-for-r/">Fte: IBiDat</a>
</p>
</div>
<p>Aunque las trayectorias se definen de modo independiente a los entornos de simulación, se recomienda definir siempre el entorno en primer lugar (pues nombra recursos y llegadas), <code>env=simmer()</code>, para luego definir las trayectorias y completar el entorno con los recursos y las fuentes.
Hay que tener en cuenta que las trayectorias y los entornos van a usar elementos comunes, con lo que la sintaxis ha se ser construida y revisada en paralelo.</p>
<p>Para hacer correr la simulación utilizamos el comando <code><a href="https://r-simmer.org/reference/run.html">run()</a></code>, con el que podemos especificar cuándo parar.
El comando <code><a href="https://r-simmer.org/reference/reset.html">reset()</a></code> nos permite resetear una simulación.</p>
<p>Las trajectorias se pueden seccionar con el operador de selección <code>[]</code>, juntar con <code><a href="https://r-simmer.org/reference/join.html">join()</a></code> y modificar con el operador <code>=</code>. También podemos conocer el número de actividades con <code>get_n_activities(traj)</code>.</p>
<p>Hay muchas actividades disponibles en simmer para incorporar en trayectorias y que presentaremos categorizadas más adelante, según su funcionalidad.</p>
<p>Veamos un ejemplo de un modelo de simulación sencillo en el que llegan clientes a una tienda cada minuto (durante 3 minutos), miran los productos durante 5 minutos y se van.</p>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Se define la trayectoria "tienda" con la actividad que realizan los clientes</span>
<span class="va">tienda</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># Lanza un mensaje de aviso de llegada</span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Llega a la tienda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># mira productos 5min</span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Lanza un mensaje de aviso de llegada</span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Sale de la tienda"</span><span class="op">)</span>
<span class="co"># se lanza el entorno de simulación incluyendo el generador de llegadas </span>
<span class="co"># (clientes), que aparecen en tres instantes de tiempo,</span>
<span class="co"># y que son dirigidos a la trayectoria "tienda"</span>
<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>, <span class="va">tienda</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># se muestran los resultados en pantalla</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># se lanza el sistema</span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Source: cliente | monitored: 1 | n_generated: 0 }
## 1: cliente0: Llega a la tienda
## 2: cliente1: Llega a la tienda
## 3: cliente2: Llega a la tienda
## 6: cliente0: Sale de la tienda
## 7: cliente1: Sale de la tienda
## 8: cliente2: Sale de la tienda</code></pre>
<pre><code>## simmer environment: anonymous | now: 8 | next: 
## { Monitor: in memory }
## { Source: cliente | monitored: 1 | n_generated: 3 }</code></pre>
<p>Al visualizar el output, apreciamos que llegan tres clientes en los instantes 1,2,3.
Cada cliente permanece en la tienda durante 5 minutos inspeccionando la mercancía, y después sale en los instantes 6, 7 y 8 respectivamente.
En las actividades y generadores de llegadas hemos utilizado parámetros fijos, pero los podemos hacer aleatorios.
Adaptemos el ejemplo anterior a tiempos aleatorios uniformes entre llegadas y tiempos de permanencia aleatorios normales.</p>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tienda</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Llega a la tienda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># Cada cliente permanece en la tienda mirando productos aprox. 5min</span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Sale de la tienda"</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># el tiempo entre llegadas de los clientes es aleatorio entre 0 y 2 min.</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>, <span class="va">tienda</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># simulamos hasta el instante 10</span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> </code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Source: cliente | monitored: 1 | n_generated: 0 }
## 1.20152: cliente0: Llega a la tienda
## 1.51594: cliente1: Llega a la tienda
## 2.51149: cliente2: Llega a la tienda
## 3.76426: cliente0: Sale de la tienda
## 4.05654: cliente3: Llega a la tienda
## 4.12502: cliente4: Llega a la tienda
## 4.51636: cliente5: Llega a la tienda
## 5.29376: cliente6: Llega a la tienda
## 5.96187: cliente1: Sale de la tienda
## 6.65052: cliente7: Llega a la tienda
## 8.58992: cliente3: Sale de la tienda
## 8.6116: cliente8: Llega a la tienda
## 8.65991: cliente2: Sale de la tienda
## 8.88082: cliente4: Sale de la tienda
## 9.67203: cliente9: Llega a la tienda
## 9.73449: cliente10: Llega a la tienda</code></pre>
<pre><code>## simmer environment: anonymous | now: 10 | next: 10.9227434583744
## { Monitor: in memory }
## { Source: cliente | monitored: 1 | n_generated: 12 }</code></pre>
<p>Ahora vemos en la primera columna los instantes de tiempo en que llegan y se van los clientes.</p>
</div>
<div id="monitoreo" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Monitoreo<a class="anchor" aria-label="anchor" href="#monitoreo"><i class="fas fa-link"></i></a>
</h2>
<p>Al ejecutar un entorno de simulación, si no incluimos ninguna opción de visualización de mensajes en la trayectoria, obtenemos en pantalla un resumen escrito básico sobre recursos y llegadas.</p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trayectoria</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>,<span class="va">trayectoria</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<pre><code>## simmer environment: anonymous | now: 5 | next: 
## { Monitor: in memory }
## { Source: llegada | monitored: 1 | n_generated: 3 }</code></pre>
<p>Al añadir en la ejecución del entorno el comando <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> (antes de <code><a href="https://r-simmer.org/reference/run.html">run()</a></code>), se monitorizan los eventos que se van sucediendo en la simulación y dónde se almacenan (Monitor).</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>,<span class="va">trayectoria</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Source: llegada | monitored: 1 | n_generated: 0 }</code></pre>
<pre><code>## simmer environment: anonymous | now: 5 | next: 
## { Monitor: in memory }
## { Source: llegada | monitored: 1 | n_generated: 3 }</code></pre>
<p>El comando <code>invisible</code> (después de <code><a href="https://r-simmer.org/reference/run.html">run()</a></code>) depura la salida para no visualizar nada (salvo que hayamos incorporado mensajes en las trayectorias).</p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>,<span class="va">trayectoria</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<p>Si queremos visualizar mensajes específicos vinculados a las llegadas y actividades conforme se suceden, habremos de incluir mensajes en las trayectorias a través del comando <code><a href="https://r-simmer.org/reference/log_.html">log_()</a></code>.</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">trayectoria</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Llegada contabilizada."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada"</span>,<span class="va">trayectoria</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<pre><code>## 0.825735: llegada0: Llegada contabilizada.
## 1.07574: llegada1: Llegada contabilizada.
## 1.79639: llegada2: Llegada contabilizada.
## 3.3158: llegada3: Llegada contabilizada.
## 4.3945: llegada4: Llegada contabilizada.
## 4.93402: llegada5: Llegada contabilizada.</code></pre>
<p>Una vez lanzamos un sistema de simulación, disponemos de diversos métodos para extraer información de él y monitorizarla por ejemplo con el comando <code><a href="https://r-simmer.org/reference/log_.html">log_()</a></code>:</p>
<ul>
<li>
<code><a href="https://r-simmer.org/reference/now.html">now()</a></code> el tiempo de simulación actual</li>
<li>
<code>peek(n)</code> instantes de tiempo en los que acontecerán los siguientes <span class="math inline">\(n\)</span> eventos</li>
<li>
<code>get_*()</code> para obtener información de recursos, atributos y fuentes: <code>attribute</code>, <code>capacity</code>, <code>global</code>, <code>name</code>, <code>n_activities</code>, <code>n_generated</code>, <code>prioritization</code>, <code>queue_count</code>, <code>queue_size</code>, <code>resources</code>, <code>seized</code>, <code>server_count</code>, <code>sources</code>, <code>trajectory</code>.</li>
</ul>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/peek.html">peek</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6.315802 6.842251 6.842251</code></pre>
<p>Con el comando <code><a href="https://r-simmer.org/reference/run.html">stepn()</a></code> podemos hacer correr el sistema durante una única simulación adicional, que no se almacena en el objeto de simulación salvo que lo asignemos a él.</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">stepn</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## simmer environment: anonymous | now: 6.3158017488099 | next: 6.84225121299232
## { Monitor: in memory }
## { Source: llegada | monitored: 1 | n_generated: 7 }</code></pre>
<p>Los comandos para monitorizar se pueden aplicar a un único entorno de simulación o a una lista de entornos, y el objeto de retorno es siempre un data frame, incluso si no se encuentran datos.
Cada entorno de simulación procesado se trata como una replicación diferente, y se identifica como tal en una columna numérica denominada <em>replication</em> en el dataframe de retorno, con los índices de los entornos como valores.
Recuperamos llegadas, recursos y atributos del sistema con los comandos:</p>
<ul>
<li><p><code><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals()</a></code> devuelve la información temporal por llegada: nombre (<em>name</em>) de la llegada, tiempo de llegada (<em>start_time</em>), tiempo de salida (<em>end_time</em>), tiempo en la actividad sin estar en la cola (<em>activity_time</em>) y una etiqueta <em>finished</em> que indica si la llegada finalizó sus actividades.
Por defecto esta información se refiere al tiempo de vida completo de las llegadas, pero se puede obtener por recurso con el argumento <code>per_resource=TRUE</code>.</p></li>
<li><p><code><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources()</a></code> devuelve los cambios de estado en los recursos: nombre del recurso (<em>resource</em>), instante (<em>time</em>) del evento que desencadenó el cambio de estado, contador de unidades en servicio (<em>server</em>), contador de unidades en la cola (<em>queue</em>), capacidad (<em>capacity</em>), tamaño de la cola (<em>queue_size</em>), contador del sistema (<em>system=server+queue</em>), y límite del sistema (<em>limit=capacity+queue_size</em>).</p></li>
<li><p><code>get_mon_atributes()</code> devuelve los cambios de estado en los atributos: nombre (<em>name</em>) del atributo, instante (<em>time</em>) del evento que desencadenó el cambio de estado, nombre (<em>key</em>) que identifica el atributo y valor (<em>value</em>).</p></li>
</ul>
<!-- --><pre><code>llegadas=get_mon_arrivals(env) 
llegadas
atributos=get_mon_attributes(env)
atributos
recursos=get_mon_resources(env)
recursos</code></pre>
<p>Ejemplifiquemos su funcionamiento sobre el sistema sencillo de la tienda que ya vimos anteriormente, con tiempos para mirar al llegar a la tienda, seguidos de atención por dependientes.</p>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">tienda</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span>  <span class="st">"Llega a la tienda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># mira productos aprox. 5min</span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Es atendido"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="st">"Sale de la tienda"</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>, <span class="va">tienda</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># tiempo entre llegadas </span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># hay dos dependientes</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="co"># simulamos hasta ese instante</span></code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Resource: dependiente | monitored: TRUE | server status: 0(2) | queue status: 0(Inf) }
## { Source: cliente | monitored: 1 | n_generated: 0 }
## 0.873379: cliente0: Llega a la tienda
## 3.53125: cliente1: Llega a la tienda
## 4.55214: cliente2: Llega a la tienda
## 5.85743: cliente0: Es atendido
## 6.32317: cliente3: Llega a la tienda
## 9.09458: cliente1: Es atendido
## 9.30449: cliente4: Llega a la tienda
## 10.6975: cliente5: Llega a la tienda
## 10.8378: cliente6: Llega a la tienda
## 10.9381: cliente7: Llega a la tienda
## 15.2235: cliente8: Llega a la tienda
## 16.0339: cliente0: Sale de la tienda
## 16.0339: cliente3: Es atendido
## 18.2267: cliente9: Llega a la tienda
## 19.2013: cliente1: Sale de la tienda
## 19.2013: cliente2: Es atendido</code></pre>
<pre><code>## simmer environment: anonymous | now: 20 | next: 20.2303100284189
## { Monitor: in memory }
## { Resource: dependiente | monitored: TRUE | server status: 2(2) | queue status: 5(Inf) }
## { Source: cliente | monitored: 1 | n_generated: 11 }</code></pre>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">llegadas</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span> 
<span class="va">llegadas</span></code></pre></div>
<pre><code>##       name start_time end_time activity_time finished replication
## 1 cliente0  0.8733795 16.03392      15.16054     TRUE           1
## 2 cliente1  3.5312472 19.20127      15.67002     TRUE           1</code></pre>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">llegadas</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span>,ongoing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> 
<span class="va">llegadas</span></code></pre></div>
<pre><code>##         name start_time end_time activity_time finished replication
## 1   cliente0  0.8733795 16.03392      15.16054     TRUE           1
## 2   cliente1  3.5312472 19.20127      15.67002     TRUE           1
## 3   cliente8 15.2235215       NA            NA    FALSE           1
## 4   cliente9 18.2267091       NA            NA    FALSE           1
## 5   cliente7 10.9381036       NA            NA    FALSE           1
## 6   cliente6 10.8377775       NA            NA    FALSE           1
## 7   cliente5 10.6974726       NA            NA    FALSE           1
## 8   cliente3  6.3231729       NA            NA    FALSE           1
## 9   cliente2  4.5521389       NA            NA    FALSE           1
## 10 cliente10 -1.0000000       NA            NA    FALSE           1
## 11  cliente4  9.3044868       NA            NA    FALSE           1</code></pre>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">atributos</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_attributes</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
<span class="va">atributos</span></code></pre></div>
<pre><code>## [1] time  name  key   value
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recursos</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
<span class="va">recursos</span></code></pre></div>
<pre><code>##       resource      time server queue capacity queue_size system limit replication
## 1  dependiente  5.857429      1     0        2        Inf      1   Inf           1
## 2  dependiente  9.094584      2     0        2        Inf      2   Inf           1
## 3  dependiente 10.450857      2     1        2        Inf      3   Inf           1
## 4  dependiente 10.487502      2     2        2        Inf      4   Inf           1
## 5  dependiente 14.170490      2     3        2        Inf      5   Inf           1
## 6  dependiente 15.524331      2     4        2        Inf      6   Inf           1
## 7  dependiente 15.612112      2     5        2        Inf      7   Inf           1
## 8  dependiente 15.645231      2     6        2        Inf      8   Inf           1
## 9  dependiente 16.033918      2     5        2        Inf      7   Inf           1
## 10 dependiente 19.201269      2     4        2        Inf      6   Inf           1
## 11 dependiente 19.584398      2     5        2        Inf      7   Inf           1</code></pre>
<p>También podemos derivar el output de un entorno de simulación a ficheros ‘csv’ (con <code>monitor_csv</code>) o de otro tipo, como ‘.txt’ especificando los delimitadores (con <code>monitor_delim</code>), con todas las llegadas (<em>arrivals</em>), atributos (<em>attributes</em>), salidas (<em>releases</em>) y recursos (<em>resources</em>), almacenándolas en el directorio temporal <code><a href="https://rdrr.io/r/base/tempfile.html">tempdir()</a></code> o en nuestro propio directorio de trabajo.</p>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/monitor.html">monitor_csv</a></span><span class="op">(</span>path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># tempdir() lo podemos sustituir por nuestro directorio de trabajo</span>
<span class="va">mon</span>   <span class="co"># nos muestra la ubicación y nombre de los ficheros</span></code></pre></div>
<pre><code>## simmer monitor: to disk (delimited files)
## { arrivals: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_arrivals.csv }
## { releases: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_releases.csv }
## { attributes: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_attributes.csv }
## { resources: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_resources.csv }</code></pre>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env_mon</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span>mon<span class="op">=</span><span class="va">mon</span><span class="op">)</span>
<span class="va">tienda</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span>  <span class="st">"Llega a la tienda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># mira productos aprox. 5min</span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Es atendido"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="st">"Sale de la tienda"</span><span class="op">)</span>

<span class="va">env_mon</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>, <span class="va">tienda</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># tiempo entre llegadas </span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># hay dos dependientes</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="co"># simulamos hasta ese instante</span></code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: to disk (delimited files) }
##   { arrivals: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_arrivals.csv }
##   { releases: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_releases.csv }
##   { attributes: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_attributes.csv }
##   { resources: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_resources.csv }
## { Resource: dependiente | monitored: TRUE | server status: 0(2) | queue status: 0(Inf) }
## { Source: cliente | monitored: 1 | n_generated: 0 }
## 0.745177: cliente0: Llega a la tienda
## 3.33796: cliente1: Llega a la tienda
## 4.54453: cliente2: Llega a la tienda
## 4.68431: cliente3: Llega a la tienda
## 6.76511: cliente0: Es atendido
## 8.45616: cliente1: Es atendido
## 8.75457: cliente4: Llega a la tienda
## 11.3135: cliente5: Llega a la tienda
## 15.6846: cliente6: Llega a la tienda
## 16.559: cliente0: Sale de la tienda
## 16.559: cliente3: Es atendido
## 18.4753: cliente1: Sale de la tienda
## 18.4753: cliente2: Es atendido</code></pre>
<pre><code>## simmer environment: anonymous | now: 20 | next: 20.6662881595548
## { Monitor: to disk (delimited files) }
##   { arrivals: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_arrivals.csv }
##   { releases: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_releases.csv }
##   { attributes: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_attributes.csv }
##   { resources: /var/folders/m7/28kglwg91xjbzq3fpmfgdw4c0000gn/T//RtmpfmYclk/filed8735c3eeb59_resources.csv }
## { Resource: dependiente | monitored: TRUE | server status: 2(2) | queue status: 2(Inf) }
## { Source: cliente | monitored: 1 | n_generated: 8 }</code></pre>
<p>para a continuación cargar los datos de estos ficheros y trabajar sobre ellos,</p>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">llegadas</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">mon</span><span class="op">$</span><span class="va">handlers</span><span class="op">$</span><span class="va">arrivals</span><span class="op">)</span>
<span class="va">llegadas</span></code></pre></div>
<pre><code>##       name start_time end_time activity_time finished
## 1 cliente0  0.7451773 16.55902      15.81385        1
## 2 cliente1  3.3379605 18.47533      15.13737        1</code></pre>
<div class="sourceCode" id="cb658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># que contiene la misma información (salvo "replication") que</span>
<span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env_mon</span><span class="op">)</span></code></pre></div>
<pre><code>##       name start_time end_time activity_time finished replication
## 1 cliente0  0.7451773 16.55902      15.81385        1           1
## 2 cliente1  3.3379605 18.47533      15.13737        1           1</code></pre>
<p>Una vez extraída la información simulada para monitorizar el proceso y realizar análisis, con el paquete <code>simmer.plot</code> (Ucar and Smeets, 2019b) tenemos métodos de graficado para visualizar rápidamente el uso de un recurso o una llegada a lo largo del tiempo.</p>
<p>Para las <strong>llegadas</strong> se pintan gráficos de líneas, con tres opciones o métricas posibles:</p>
<ul>
<li>
<em>activity_time</em> es la cantidad de tiempo que consume en actividades cada llegada;</li>
<li>
<em>flow_time</em> es la cantidad de tiempo que consume cada llegada en el sistema, y se calcula con: ‘<em>flow = end_time - start_time</em>.’</li>
<li>
<em>waiting_time</em> es la cantidad de tiempo que una llegada espera a ser atendida o ejecutada, y se calcula con: ‘<em>waiting_time = flow_time - activity_time</em>.’</li>
</ul>
<div class="sourceCode" id="cb660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arrivals</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">arrivals</span>, metric<span class="op">=</span><span class="st">"waiting_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : span too small.
## fewer data values than degrees of freedom.</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : pseudoinverse used
## at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : neighborhood
## radius 0.015837</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : reciprocal
## condition number 1</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 19.217</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : There are other
## near singularities as well. 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger

## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger</code></pre>
<pre><code>## Warning: Computation failed in `stat_smooth()`:
## NA/NaN/Inf en llamada a una función externa (arg 5)</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-13-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">arrivals</span>, metric<span class="op">=</span><span class="st">"activity_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : span too small.
## fewer data values than degrees of freedom.</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : pseudoinverse used
## at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : neighborhood
## radius 0.015837</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : reciprocal
## condition number 1</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 19.217</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : There are other
## near singularities as well. 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger

## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger</code></pre>
<pre><code>## Warning: Computation failed in `stat_smooth()`:
## NA/NaN/Inf en llamada a una función externa (arg 5)</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-13-2.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">arrivals</span>, metric<span class="op">=</span><span class="st">"flow_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : span too small.
## fewer data values than degrees of freedom.</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : pseudoinverse used
## at 16.018</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : neighborhood
## radius 0.015837</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : reciprocal
## condition number 1</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : at 19.217</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : radius 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : all data on
## boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : There are other
## near singularities as well. 0.0002508</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger

## Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric, : zero-width
## neighborhood. make span bigger</code></pre>
<pre><code>## Warning: Computation failed in `stat_smooth()`:
## NA/NaN/Inf en llamada a una función externa (arg 5)</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-13-3.png" width="95%" style="display: block; margin: auto;"></div>
<p>Para los <strong>recursos</strong>, tenemos dos métricas de graficado:</p>
<ul>
<li>
<em>usage</em> muestra un gráfico de líneas con el tiempo promedio de uso (acumulado) de cada recurso, replication e item (por defecto queue, server y system, que es la suma de servidor y cola). Si <em>steps=TRUE</em>, se pinta un gráfico de escaleras con los valores instantáneos.</li>
<li>
<em>utilization</em> muestra un gráfico de barras con el promedio de uso del recurso (tiempo total en uso, dividido por el tiempo total de simulación). Para replicaciones múltiples, la barra representa la mediana y las barras de error los cuartiles. Si se proporciona una única replicación, la barra y la barra de error coinciden.</li>
</ul>
<p>Teniendo en cuenta que <code>get_mon</code> proporciona objetos data.frame, podemos utilizar cualquier otro tipo de gráfico específico y personalizado con las funciones gráficas habituales de R, y en particular de ‘ggplot2.’</p>
<div class="sourceCode" id="cb705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arrivals</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env_mon</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">arrivals</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">activity_time</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Skyblue"</span>,color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-15-1.png" width="95%" style="display: block; margin: auto;"></div>
</div>
<div id="fuentes-de-llegadas" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Fuentes de llegadas<a class="anchor" aria-label="anchor" href="#fuentes-de-llegadas"><i class="fas fa-link"></i></a>
</h2>
<p>Una fuente de llegadas, clientes o productos de un sistema de simulación es definida con tres parámetros principales:</p>
<ul>
<li>
<em>name_prefix</em>, el nombre con el que identificamos cada llegada que se genera</li>
<li>
<em>trajectory</em>, la trayectoria a la que accede</li>
<li>
<em>distribution</em>, la distribución de los tiempos entre llegadas.</li>
</ul>
<p>Hay dos tipos de fuentes: generadores y fuentes de datos (<em>dataframes</em>), a las que accedemos respectivamente con los comandos <code><a href="https://r-simmer.org/reference/add_generator.html">add_generator()</a></code> y <code><a href="https://r-simmer.org/reference/add_dataframe.html">add_dataframe()</a></code>.</p>
<ul>
<li>
<strong>Generadores</strong>, proporcionados con el comando <a href="https://r-simmer.org/reference/generators.html"><code>add_generator()</code></a>, que genera tiempos dinámicos entre llegadas a partir de una función (distribución) que define el usuario.</li>
</ul>
<p>Ejemplifiquemos las posibilidades de generación de tiempos de llegadas con el ejemplo anterior que ya realizamos, en el que al entrar cada cliente, pasa 5 minutos en el sistema y luego se marcha.</p>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># defino la función de los tiempos entre llegadas, U(0,2)</span>
<span class="va">distr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>

<span class="co"># definimos laa acciones que hace el cliente en la tienda</span>
<span class="va">tienda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># los tiempos entre llegadas se simulan de "distr"</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada_random"</span>, <span class="va">tienda</span>, <span class="va">distr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># las llegadas ocurren en los instantes 0, 1, 10, 30, 40 y 43</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada_at"</span>, <span class="va">tienda</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">43</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># los tiempos entre llegadas se simulan de "distr", empezando en el instante 1</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada_from"</span>, <span class="va">tienda</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">from</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">distr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># los tiempos entre llegadas se simulan de "distr", acabando en el instante 5</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada_to"</span>, <span class="va">tienda</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">to</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">distr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># los tiempos entre llegadas se simulan de "distr", empezando en 1 y acabando en 5</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llegada_from_to"</span>, <span class="va">tienda</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">from_to</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="va">distr</span>, every<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># monitorizamos todas las llegadas</span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                name start_time  end_time activity_time finished replication
## 1       llegada_at0   0.000000  5.000000             5     TRUE           1
## 2       llegada_to0   0.505994  5.505994             5     TRUE           1
## 3       llegada_at1   1.000000  6.000000             5     TRUE           1
## 4     llegada_from0   1.000000  6.000000             5     TRUE           1
## 5  llegada_from_to0   1.000000  6.000000             5     TRUE           1
## 6   llegada_random0   1.133789  6.133789             5     TRUE           1
## 7  llegada_from_to1   1.497077  6.497077             5     TRUE           1
## 8   llegada_random1   1.939551  6.939551             5     TRUE           1
## 9   llegada_random2   2.178522  7.178522             5     TRUE           1
## 10      llegada_to1   2.343600  7.343600             5     TRUE           1
## 11  llegada_random3   2.567912  7.567912             5     TRUE           1
## 12      llegada_to2   2.672739  7.672739             5     TRUE           1
## 13    llegada_from1   2.734700  7.734700             5     TRUE           1
## 14 llegada_from_to2   3.036338  8.036338             5     TRUE           1
## 15  llegada_random4   3.894325  8.894325             5     TRUE           1
## 16 llegada_from_to3   4.141093  9.141093             5     TRUE           1
## 17      llegada_to3   4.385889  9.385889             5     TRUE           1
## 18    llegada_from2   4.587793  9.587793             5     TRUE           1
## 19    llegada_from3   4.677028  9.677028             5     TRUE           1
## 20      llegada_to4   4.875325  9.875325             5     TRUE           1
## 21 llegada_from_to4   5.000000 10.000000             5     TRUE           1
## 22  llegada_random5   5.048456 10.048456             5     TRUE           1
## 23  llegada_random6   6.272161 11.272161             5     TRUE           1
## 24    llegada_from4   6.496737 11.496737             5     TRUE           1
## 25  llegada_random7   6.617279 11.617279             5     TRUE           1
## 26  llegada_random8   6.692181 11.692181             5     TRUE           1
## 27 llegada_from_to5   6.993783 11.993783             5     TRUE           1
## 28 llegada_from_to6   7.467738 12.467738             5     TRUE           1
## 29  llegada_random9   7.879289 12.879289             5     TRUE           1
## 30    llegada_from5   8.315619 13.315619             5     TRUE           1
## 31 llegada_from_to7   9.000000 14.000000             5     TRUE           1
## 32 llegada_from_to8   9.440001 14.440001             5     TRUE           1
## 33 llegada_random10   9.517035 14.517035             5     TRUE           1
## 34    llegada_from6   9.715277 14.715277             5     TRUE           1
## 35 llegada_random11   9.951204 14.951204             5     TRUE           1</code></pre>
<p>También podemos desencadenar llegadas a demanda desde otra trayectoria.
Sería el ejemplo de un operador, que en el momento en que ficha digitalmente como trabajador de la empresa, se incorpora a trabajar durante una jornada parcial de 3 horas:</p>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># jornada de trabajo</span>
<span class="va">t0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="co"># activa "Trabajar": la jornada de trabajo</span>
<span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"Trabajar"</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># simula llegadas al trabajo cuando "Trabajar" esté activado</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"Trabajar"</span>, <span class="va">t0</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">when_activated</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># simula una llegada a fichar</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"Fichado digital"</span>, <span class="va">t1</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##               name start_time end_time activity_time finished replication
## 1 Fichado digital0          8        8             0     TRUE           1
## 2        Trabajar0          8       11             3     TRUE           1</code></pre>
<p>La sintaxis que se utiliza para generar llegadas es:</p>
<pre><code>add_generator(.env, name_prefix, trajectory, distribution, mon = 1,
  priority = 0, preemptible = priority, restart = FALSE)</code></pre>
<p>El argumento <code>mon</code> permite especificar si queremos que el simulador monitoree las llegadas: 0 = sin monitoreo, 1 = monitoreo simple de llegadas simple, 2 = monitoreo simple y de atributos de las llegadas.
Por defecto tendremos <code>mon=1</code>.
En el argumento <code>distribution</code> se pueden utilizar funciones definidas por el usuario para los tiempos entre llegadas y también, como hemos visto, <code><a href="https://r-simmer.org/reference/generators.html">at()</a></code>, <code><a href="https://r-simmer.org/reference/generators.html">from()</a></code>, <code><a href="https://r-simmer.org/reference/generators.html">to()</a></code> y <code><a href="https://r-simmer.org/reference/generators.html">from_to()</a></code>.
Si hay un sistema de prioridades, se especificaría con <code>priority=1</code>, y qué hacer para las llegadas preferentes o prioritarias, en los argumentos <code>preemptible</code> y <code>restart</code>.</p>
<ul>
<li>
<strong>Fuentes de datos</strong> con tiempos entre llegadas, provenientes de un data frame que vincula el usuario con el comando <a href="https://r-simmer.org/reference/add_dataframe.html"><code>add_dataframe()</code></a>:</li>
</ul>
<!-- --><pre><code>add_dataframe(.env, name_prefix, trajectory, data, mon = 1, batch = 50,
  col_time = "time", time = c("interarrival", "absolute"),
  col_attributes = NULL, col_priority = "priority",
  col_preemptible = col_priority, col_restart = "restart")</code></pre>
<p>Ambos generadores o fuentes de llegadas se reprograman a sí mismos para ciclarse hasta agotar el tiempo de simulación, en el caso de que este supere el rango inicial.</p>
</div>
<div id="recursos" class="section level2" number="7.8">
<h2>
<span class="header-section-number">7.8</span> Recursos<a class="anchor" aria-label="anchor" href="#recursos"><i class="fas fa-link"></i></a>
</h2>
<p>Recordemos que un recurso, que proporciona servicio a las llegadas, en la simulación DES tiene dos componentes internos: un servidor y una cola.
Todo recurso va a ser definido por tres parámetros:</p>
<ul>
<li>el nombre (<em>name</em>) del recurso o servidor,</li>
<li>la capacidad (<em>capacity</em>) del recurso, y</li>
<li>el tamaño de la cola (<em>queue_size</em>) en la que esperan las llegadas a que haya algún recurso disponible; representa el aforo de la sala de espera; cuando es cero significa que no hay posibilidad de cola.</li>
</ul>
<p>Los recursos se definen con la sintaxis:</p>
<pre><code>add_resource(.env, name, capacity = 1, queue_size = Inf, mon = TRUE,
  preemptive = FALSE, preempt_order = c("fifo", "lifo"),
  queue_size_strict = FALSE, queue_priority = c(0, Inf))</code></pre>
<p>El argumento <code>capacity</code> indica cuántos servidores hay en el sistema, y <code>queue_size</code> el tamaño de la cola de espera.
Por defecto, los recursos son monitorizados (<code>mon=TRUE</code>) y no preferentes (<code>preemptive = FALSE</code>).
La preferencia significa que si aparece una llegada con prioridad alta, el recurso detendrá temporalmente el procesado de las llegadas que esté atendiendo y tengan menos prioridad, y atenderá la preferente.
En los recursos preferentes, <code>preemptive = TRUE</code> el parámetro <code>preempt_order</code> define qué llegada debe priorizarse según una política FIFO (<em>First in, first out</em>)o LIFO (<em>Last in, first out</em>).
Todas las llegadas con mayor preferencia son ubicadas en una cola especial que tiene mayor prioridad que la cola principal, y en consecuencia se atienden antes.
Además, el parámetro <code>queue_size_strict</code> controla si esta cola especial de llegadas preferentes debe ser tenida en cuenta para calcular el tamaño límite de la cola; si este parámetro impone el límite, entonces los rechazos se producirán en la cola principal.</p>
<p>Para ampliar información, consultar el Manual de Referencia sobre <a href="https://r-simmer.org/reference/add_resource.html"><code>add_resource</code></a>.</p>
<p>Cuando tenemos recursos en el sistema que dan un servicio, surgen dos acciones básicas que son: <code>seize</code> o asignación a un recurso, y <code>release</code> o desocupación del recurso.
Por supuesto, si una llegada no puede ser atendida por un servidor (recurso) libre, puede esperar en cola si hay hueco en la cola, o ser rechazada si no lo hay.</p>
<p>Transformemos el ejemplo anterior en clientes que llegan aleatoriamente a una tienda.
Ahora al llegar, cada cliente mira productos alrededor de 5 minutos, luego busca a un dependiente para ser atendido o espera hasta que uno esté desocupado, este lo atiende por aproximadamente 10 minutos y luego se va.
Supongamos que hay 2 dependientes en la tienda.</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">999</span><span class="op">)</span>
<span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Actividades que se desarrollan en la tienda</span>
<span class="va">tienda</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span>  <span class="st">"Llega a la tienda"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># mira productos aprox. 5min</span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># es asignado a un dependiente </span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="st">"Busca un dependiente"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># que lo antiende aprox. 10min.</span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Es atendido"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># desocupa al dependiente</span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">1</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># sale de la tienda</span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="st">"Sale de la tienda"</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># simulación (uniforme(0,5) del tiempo entre llegadas de clientes</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>, <span class="va">tienda</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># dimensionamiento de recursos: dos dependientes</span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"dependiente"</span>,<span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># simulamos hasta ese instante</span>
  <span class="co"># monitorizamos los recursos (dependientes)</span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Resource: dependiente | monitored: TRUE | server status: 0(2) | queue status: 0(Inf) }
## { Source: cliente | monitored: 1 | n_generated: 0 }
## 1.94536: cliente0: Llega a la tienda
## 4.86066: cliente1: Llega a la tienda
## 5.6328: cliente0: Busca un dependiente
## 5.6328: cliente0: Es atendido
## 8.68238: cliente1: Busca un dependiente
## 8.68238: cliente1: Es atendido
## 8.79439: cliente2: Llega a la tienda
## 11.55: cliente3: Llega a la tienda
## 11.9157: cliente2: Busca un dependiente
## 12.0631: cliente4: Llega a la tienda
## 14.2341: cliente0: Sale de la tienda
## 14.2341: cliente2: Es atendido
## 15.9421: cliente4: Busca un dependiente
## 16.1694: cliente5: Llega a la tienda
## 17.3468: cliente3: Busca un dependiente
## 18.9358: cliente6: Llega a la tienda
## 18.9865: cliente1: Sale de la tienda
## 18.9865: cliente4: Es atendido</code></pre>
<pre><code>##      resource      time server queue capacity queue_size system limit replication
## 1 dependiente  5.632797      1     0        2        Inf      1   Inf           1
## 2 dependiente  8.682379      2     0        2        Inf      2   Inf           1
## 3 dependiente 11.915736      2     1        2        Inf      3   Inf           1
## 4 dependiente 14.234133      2     0        2        Inf      2   Inf           1
## 5 dependiente 15.942074      2     1        2        Inf      3   Inf           1
## 6 dependiente 17.346796      2     2        2        Inf      4   Inf           1
## 7 dependiente 18.986475      2     1        2        Inf      3   Inf           1</code></pre>
<p>Visualizamos a los clientes: cuándo llegan, cuándo son atendidos por un dependiente y cuándo se van de la tienda.
Para los dependientes (recursos) vemos los instantes de tiempo (time) en los que inician un servicio o se les añade algún cliente en cola, el número de dependientes ocupados (server) y el número de clientes esperando ser atendidos (queue).</p>
</div>
<div id="acciones" class="section level2" number="7.9">
<h2>
<span class="header-section-number">7.9</span> Acciones<a class="anchor" aria-label="anchor" href="#acciones"><i class="fas fa-link"></i></a>
</h2>
<p>Las acciones posibles para definir trayectorias las presentamos a continuación, categorizadas según su funcionalidad:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="28%">
<col width="71%">
</colgroup>
<thead><tr class="header">
<th>Funciones</th>
<th>comandos</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>atributos en llegadas</td>
<td>set_attribute, get_attribute, set_prioritization, get_prioritization</td>
</tr>
<tr class="even">
<td>interacción con recursos</td>
<td>seize, release, select, set_capacity, set_queue_size,</td>
</tr>
<tr class="odd">
<td>interacción con fuentes</td>
<td>activate, deactivate, set_trajectory, set_source</td>
</tr>
<tr class="even">
<td>ramificación</td>
<td>branch</td>
</tr>
<tr class="odd">
<td>retrasos</td>
<td>timeout, timeout_from_attribute, time_out_fromglobal</td>
</tr>
<tr class="even">
<td>clonación y sincronización</td>
<td>clone, synchronize</td>
</tr>
<tr class="odd">
<td>bucles</td>
<td>rollback</td>
</tr>
<tr class="even">
<td>ejecución en lotes</td>
<td>batch, separate</td>
</tr>
<tr class="odd">
<td>programación asíncrona</td>
<td>send, wait, trap, untrap</td>
</tr>
<tr class="even">
<td>renuncias</td>
<td>leave, renege_in, renege_if, renege_abort</td>
</tr>
<tr class="odd">
<td>comunicación entre llegadas</td>
<td>send, trap, untrap, wait</td>
</tr>
<tr class="even">
<td>depuración</td>
<td>log_, stop_if</td>
</tr>
</tbody>
</table></div>
<p>La Figura 3 muestra con mucha claridad las principales acciones disponibles en <code>simmer</code>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:simmertray"></span>
<img src="images/simmer_trajectory.png" alt="Figura 3. Principales acciones en trayectorias `simmer`. [Fte: IBiDat](https://ibidat.es/portfolio-items/simmer-discrete-event-simulation-for-r/)" width="100%"><p class="caption">
Figura 7.2: Figura 3. Principales acciones en trayectorias <code>simmer</code>. <a href="https://ibidat.es/portfolio-items/simmer-discrete-event-simulation-for-r/">Fte: IBiDat</a>
</p>
</div>
</div>
<div id="atributos" class="section level2" number="7.10">
<h2>
<span class="header-section-number">7.10</span> Atributos<a class="anchor" aria-label="anchor" href="#atributos"><i class="fas fa-link"></i></a>
</h2>
<p>Las llegadas pueden almacenar y modificar características específicas o atributos con el comando <code><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute()</a></code>.
Los atributos consisten en pares <code>(key,value)</code> que por defecto se asignan por llegada, salvo que se definan globalmente con <code><a href="https://r-simmer.org/reference/set_attribute.html">set_global()</a></code>.
Además, pueden ser vectores o funciones que devuelvan vectores.
Sirven por ejemplo si queremos asignar costes a cada llegada, o identificar la ruta que siguen si hay varias posibles, etc.</p>
<p>La especificación de atributos es una acción más que se desarrolla dentro de una trayectoria a las llegadas que son dirigidas a ella.
Se especifican con el comando <a href="https://r-simmer.org/reference/set_attribute.html"><code>set_attribute()</code></a>:</p>
<pre><code>set_attribute(keys, values, mod = c(NA, "+", "*"), init = 0)</code></pre>
<p>donde ‘key’ es el nombre del atributo o característica que asignamos a las llegadas, y’value’ es el valor numérico que se le asigna (cuando queramos asignar atributos textuales habremos de codificarlos a numéricos).
Con ‘mod’ opcionalmente se pueden modificar los atributos (por ejemplo un contador que suma uno en cada llegada utilizaría mod=“+”), que se inicializaría en el valor eespecificado en ‘ini.’</p>
<p>Para visualizar el valor de un atributo que previamente hemos asignado podemos usar el comando <a href="https://r-simmer.org/reference/get_n_generated.html"><code>get_attribute()</code></a>.
Cuando lanzamos un proceso, si queremos visualizar los atributos asignados a cada una de las llegadas, utilizaremos el comando <a href="https://r-simmer.org/reference/get_mon.html"><code>get_mon_attributes()</code></a> asegurándonos antes de que hemos incluido en las condiciones de monitorización de las llegadas a las que les hemos asignado esos atributos, la opción ‘mon=2’ (en <code><a href="https://r-simmer.org/reference/add_generator.html">add_generator()</a></code>).</p>
<p>Por ejemplo, el siguiente modelo define la llegada de un sujeto al que se le da el atributo ‘peso=60,’ lo divulga, y tras comer sube un kilo y vuelve a comunicarlo.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">traj</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># asignamos el atributo numérico a peso</span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"peso"</span>,<span class="fl">60</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hoy peso"</span>,<span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>,<span class="st">"peso"</span><span class="op">)</span>, <span class="st">"kg. Me voy a comer."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># a continuación lo modificamos sumándole 1</span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"peso"</span>,<span class="fl">1</span>,mod<span class="op">=</span><span class="st">"+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># y por último lo visualizamos</span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Mi peso ahora es"</span>,<span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>,<span class="st">"peso"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"peso"</span>,<span class="va">traj</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_attributes</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 1: peso0: Hoy peso 60 kg. Me voy a comer.
## 1: peso0: Mi peso ahora es 61</code></pre>
<pre><code>##   time  name  key value replication
## 1    1 peso0 peso    60           1
## 2    1 peso0 peso    61           1</code></pre>
<p>Las llegadas además, están sujetas a tres posibles valores de prioridad para acceder a los recursos:</p>
<ul>
<li><p><strong>prioridad</strong> (<em>priority</em>).
Se aplica a las llegadas.
Un valor más alto implica mayor prioridad.
El valor por defecto que se asigna a todas las llegadas es 0, esto es, la mínima prioridad posible.</p></li>
<li><p><strong>preferente</strong> (<em>preemptible</em>).
Se aplica a los recursos y establece la mínima prioridad con que se accede a dicho recurso.
Si un recurso tiene cierto valor de preferencia y aparece una llegada con prioridad mayor a ese valor de preferencia, esta llegada se antepone en cola a cualquier otra que tenga prioridad inferior; las actividades en curso no se interrumpen. Sólo las llegadas con prioridad más alta pueden desencadenar una preferencia en el servicio o suspensión inesperada por tener llegadas con mayor prioridad.</p></li>
<li><p><strong>reinicio</strong> (<em>restart</em>), cuando se ha producido un servicio con preferencia, indica si al finalizar la actividad con la llegada prioritaria, el recurso ha de reanudar (TRUE) la actividad previa que hubo de suspender o no (0).</p></li>
</ul>
<p>Estas características se definen con el comando <a href="https://r-simmer.org/reference/set_prioritization.html"><code>set_prioritization()</code></a>, y se recuperan con el comando <a href="https://r-simmer.org/reference/get_n_generated.html"><code>get_prioritization()</code></a>.</p>
<pre><code>set_prioritization(.trj, values, mod = c(NA, "+", "*"))</code></pre>
<p>El argumento <code>values=c(priority,preemptible,restart)</code> espera un vector numérico con tres elementos que representen la prioridad, preferencia y reinicio que han de aplicarse en una trayectoria dada antes de acceder a algún recurso.
El argumento <code>mod</code> permite de nuevo modificar automáticamente estos valores en cada llegada.</p>
<p>Simulemos un proceso en el que llegan pacientes al triaje de un servicio de urgencias de un hospital en diferentes instantes de tiempo, que resultan ser graves o no con cierta probabilidad. Cuando llega un paciente grave (prioridad=1), es derivado inmediatamente a un médico y accede al servicio de atención tan pronto acabe la atención al paciente que está atendiendo en ese momento. Tras atenderlo, el médico vuelve a atender al resto de pacientes por orden de prioridad.</p>
<p>Especificamos en este caso, para cada llegada, una simulación <span class="math inline">\(Ber(p)\)</span> que establece si el paciente está grave (valor 1). La preferencia del recurso se fija también a 1, para garantizar que dará preferencia a todas las llegadas con prioridad mayor o igual a 1. No se da valor a <code>restart</code>, asumiendo que por defecto continuará con los pacientes en el orden de llegada-prioridad.</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">triaje</span> <span class="op">=</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_prioritization.html">set_prioritization</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0.4</span><span class="op">)</span>,<span class="fl">1</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># guardamos como atributo la prioridad asignada</span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"Prioridad"</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_prioritization</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># se redirige al médico</span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"medico"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># que tarda cierto tiempo en atenderlo</span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"medico"</span>,<span class="fl">1</span><span class="op">)</span>
  

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"paciente"</span>,<span class="va">triaje</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,mon<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"medico"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<pre><code>## simmer environment: anonymous | now: 31.4096241788118 | next: 
## { Monitor: in memory }
## { Resource: medico | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
## { Source: paciente | monitored: 2 | n_generated: 5 }</code></pre>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#visualizamos el output</span>
<span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_attributes</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##        name replication start_time  end_time activity_time finished time       key value
## 1 paciente0           1          0  5.908214      5.908214     TRUE    0 Prioridad     0
## 2 paciente1           1          1 28.711210      6.147810     TRUE    1 Prioridad     0
## 3 paciente2           1          2  8.088557      2.180343     TRUE    2 Prioridad     1
## 4 paciente3           1          3 31.409624      2.698414     TRUE    3 Prioridad     0
## 5 paciente4           1          4 22.563400     14.474843     TRUE    4 Prioridad     1</code></pre>
</div>
<div id="interacción-con-recursos" class="section level2" number="7.11">
<h2>
<span class="header-section-number">7.11</span> Interacción con recursos<a class="anchor" aria-label="anchor" href="#interacci%C3%B3n-con-recursos"><i class="fas fa-link"></i></a>
</h2>
<p>Las dos actividades principales para interaccionar con recursos son <code><a href="https://r-simmer.org/reference/seize.html">seize()</a></code> -acceso- y <code><a href="https://r-simmer.org/reference/seize.html">release()</a></code> -salida-.
Un recurso o conjunto de recursos (<em>amount</em>) entran en funcionamiento con <code><a href="https://r-simmer.org/reference/seize.html">seize()</a></code> y dejan de funcionar con <code><a href="https://r-simmer.org/reference/seize.html">release()</a></code>.</p>
<pre><code>seize(.trj, resource, amount = 1, continue = NULL, post.seize = NULL,reject = NULL)
release(.trj, resource, amount = 1)</code></pre>
<p>La actividad <code><a href="https://r-simmer.org/reference/seize.html">seize()</a></code> es especial en el sentido de que el resultado o salida depende del estado del recurso.
Una llegada, cuando accede a un recurso, puede aprovecharlo con éxito desde el momento en que accede y continuar su camino en la trayectoria, pero también puede ponerse en cola (si el recurso está ocupado) o ser rechazada y despedida de la trayectoria.
Para manejar estos casos especiales con total flexibilidad, <code><a href="https://r-simmer.org/reference/seize.html">seize()</a></code> soporta la especificación de dos sub-trayectorias opcionales:</p>
<ul>
<li>
<code>post.seize</code>, que es la actividad que sigue despues de un <em>seize</em> exitoso, y</li>
<li>
<code>reject</code>, que es la actividad que sigue si la llegada ha sido rechazada.</li>
</ul>
<p>Como en todas las actividades que soportan la definición de sub-trayectorias, hay un parámetro booleano llamado <em>continue</em> (=TRUE o FALSE). Para cada sub-trayectoria, este parámetro controla si las llegadas deberían continuar a la actividad que sigue a <code><a href="https://r-simmer.org/reference/seize.html">seize()</a></code> en la trayectoria principal después de ejecutar la sub-trayectoria.</p>
<p>Para ejemplificar su uso consideramos un ambulatorio médico al que llegan pacientes.
Si al llegar el paciente, el doctor está disponible, es atendido por este durante 5 minutos.
Si no está disponible, es rechazado y derivado a consulta de enfermería, donde es atendido siempre 8 minutos, al haber 10 enfermeras disponibles.
En ambos casos el paciente se va del ambulatorio al terminar la consulta a la que haya entrado.</p>
<div class="sourceCode" id="cb727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">traj</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Llega el "</span>,<span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_name</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span>
    <span class="st">"doctor"</span>,<span class="fl">1</span>,continue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>,
    post.seize<span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="st">"Paciente aceptado"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Pasa a consulta con el doctor"</span><span class="op">)</span>, 
    reject<span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="st">"Paciente rechazado"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"El doctor está ocupado y es derivado a enfermería"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
      <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"nurse"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Pasa a consulta con la enfermera"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"nurse"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"El"</span>,<span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_name</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>, <span class="st">"sale de enfermería"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"doctor"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"El doctor ya está libre"</span><span class="op">)</span>

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"doctor"</span>,capacity<span class="op">=</span><span class="fl">1</span>,queue_size<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
   <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"nurse"</span>,capacity<span class="op">=</span><span class="fl">10</span>,queue_size<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"paciente"</span>,<span class="va">traj</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 0: paciente0: Llega el  paciente0
## 0: paciente0: Pasa a consulta con el doctor
## 1: paciente1: Llega el  paciente1
## 1: paciente1: El doctor está ocupado y es derivado a enfermería
## 1: paciente1: Pasa a consulta con la enfermera
## 5: paciente0: El doctor ya está libre
## 5: paciente2: Llega el  paciente2
## 5: paciente2: Pasa a consulta con el doctor
## 8: paciente3: Llega el  paciente3
## 8: paciente3: El doctor está ocupado y es derivado a enfermería
## 8: paciente3: Pasa a consulta con la enfermera
## 9: paciente1: El paciente1 sale de enfermería
## 10: paciente2: El doctor ya está libre
## 16: paciente3: El paciente3 sale de enfermería</code></pre>
<pre><code>## simmer environment: anonymous | now: 16 | next: 
## { Monitor: in memory }
## { Resource: doctor | monitored: TRUE | server status: 0(1) | queue status: 0(0) }
## { Resource: nurse | monitored: TRUE | server status: 0(10) | queue status: 0(0) }
## { Source: paciente | monitored: 1 | n_generated: 4 }</code></pre>
<p>A la hora de asignar un recurso, podemos hacerlo especificando explícitamente el nombre del recurso (si tenemos varios), o hacerlo de forma dinámica especificando la política a seguir.
Esto lo podemos hacer con la actividad <code><a href="https://r-simmer.org/reference/select.html">select()</a></code>, a través de los argumentos <em>resources</em> y <em>policy</em>.</p>
<pre><code>select(.trj, resources, policy = c("shortest-queue",
  "shortest-queue-available", "round-robin", "round-robin-available",
  "first-available", "random", "random-available"), id = 0)</code></pre>
<p>Hay varias políticas implementadas internamente a las que se puede acceder por su nombre:</p>
<ul>
<li>‘shortest-queue’: se selecciona el recurso con la cola más corta</li>
<li>‘round-robin’: se seleccionarán los recursos de una forma cíclica</li>
<li>‘first-available’: se selecciona el recurso que queda disponible el primero</li>
<li>‘random’: se selecciona un recurso aleatoriamente.</li>
</ul>
<p>El parámetro <em>resources</em> también puede ser dinámico e incluso existe la posibilidad de definir políticas específicas.
Una vez que un recurso es seleccionado, hay versiones especiales de las actividades mencionadas para interaccionar con los recursos sin especificar su nombre, como son <code><a href="https://r-simmer.org/reference/seize.html">seize_selected()</a></code>, <code><a href="https://r-simmer.org/reference/set_capacity.html">set_capacity_selected()</a></code>, etc.</p>
<p>Pongamos como ejemplo una consulta médica con 3 doctores, que atienden a los pacientes de un modo ordenado secuencial conforme llegan a la consulta.</p>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">simmer</span><span class="fu">::</span><span class="fu"><a href="https://r-simmer.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"doctor"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"round-robin"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize_selected</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release_selected</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"doctor1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"doctor2"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"doctor3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="va">traj</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   resource time server queue capacity queue_size system limit replication
## 1  doctor1    0      1     0        1        Inf      1   Inf           1
## 2  doctor2    1      1     0        1        Inf      1   Inf           1
## 3  doctor3    2      1     0        1        Inf      1   Inf           1
## 4  doctor1    5      0     0        1        Inf      0   Inf           1
## 5  doctor2    6      0     0        1        Inf      0   Inf           1
## 6  doctor3    7      0     0        1        Inf      0   Inf           1</code></pre>
</div>
<div id="interacción-con-fuentes" class="section level2" number="7.12">
<h2>
<span class="header-section-number">7.12</span> Interacción con fuentes<a class="anchor" aria-label="anchor" href="#interacci%C3%B3n-con-fuentes"><i class="fas fa-link"></i></a>
</h2>
<p>Hay cuatro actividades específicas para modificar las fuentes de llegadas.
Una llegada puede activar <code><a href="https://r-simmer.org/reference/activate.html">activate()</a></code> o desactivar <code><a href="https://r-simmer.org/reference/activate.html">deactivate()</a></code> una fuente, pero también puede modificar la trayectoria a la que se adhieren las llegadas que aparecen (derivarlas a otras trayectorias), con <code><a href="https://r-simmer.org/reference/set_trajectory.html">set_trajectory()</a></code>, o especificar una nueva distribución entre-llegadas con <code><a href="https://r-simmer.org/reference/set_trajectory.html">set_source()</a></code>.
Para seleccionar dinámicamente una fuente, el parámetro que especifica el nombre de la fuente en todos estos métodos puede ser dinámico.</p>
<pre><code>activate(.trj, sources)
deactivate(.trj, sources)
set_trajectory(.trj, sources, trajectory)
set_source(.trj, sources, object)  </code></pre>
<p>En el ejemplo a continuación, una llegada, al acceder a la trayectoria, desactiva la fuente que genera llegadas cada segundo, deja transcurrir 1 segundo y después vuelve a activarla.</p>
<div class="sourceCode" id="cb734"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traj</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/activate.html">deactivate</a></span><span class="op">(</span><span class="st">"dummy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"dummy"</span><span class="op">)</span> 

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"dummy"</span>,<span class="va">traj</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##     name start_time end_time activity_time finished replication
## 1 dummy0          1        2             1     TRUE           1
## 2 dummy1          3        4             1     TRUE           1
## 3 dummy2          5        6             1     TRUE           1
## 4 dummy3          7        8             1     TRUE           1</code></pre>
<p>En este otro ejemplo se define un simulador que genera llamadas cada 2 segundos y las redirige a la trayectoria ‘traj2.’ Una vez allí, la fuente de llamadas se modifica para que a partir de que la primera llamada finalice (estando 2 segundos en ‘traj2’), se generen llamadas cada segundo y se redirijan estas a la trayectoria ‘traj1.’</p>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">traj2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_trajectory.html">set_source</a></span><span class="op">(</span><span class="st">"llamada"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_trajectory.html">set_trajectory</a></span><span class="op">(</span><span class="st">"llamada"</span>, <span class="va">traj1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"llamada"</span>, <span class="va">traj2</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##       name start_time end_time activity_time finished replication
## 1 llamada0          2        4             2     TRUE           1
## 2 llamada1          3        4             1     TRUE           1
## 3 llamada2          4        5             1     TRUE           1</code></pre>
</div>
<div id="ramificación" class="section level2" number="7.13">
<h2>
<span class="header-section-number">7.13</span> Ramificación<a class="anchor" aria-label="anchor" href="#ramificaci%C3%B3n"><i class="fas fa-link"></i></a>
</h2>
<p>Una rama (branch) es un punto en una trayectoria en el cual se pueden seguir una o más sub-trayectorias.
<code>simmer</code> soporta dos tipos de ramificación:</p>
<ul>
<li>La actividad <code><a href="https://r-simmer.org/reference/branch.html">branch()</a></code> coloca la llegada en una de las sub-trayectorias que dependen de alguna condición evaluada en un parámetro dinámico llamado <em>option</em> y que ha de devolver un valor entero entre 0 y N. Si es 0, salta la ramificación y continúa a la siguiente actividad. Cualquier valor entre 1 y N hace que la llegada siga la correspondientes subtrayectoria.</li>
</ul>
<p>Es el equivalente de una condición <em>if/else</em>, es decir, si el valor de <em>option</em> es ‘i,’ entonces se ejecutará la sub-trayectoria ‘i.’</p>
<p>El argumento <code>continue</code> es un vector booleano (TRUE/FALSE) de dimensión N que indica si la llegada debe continuar o no a la trayectoria principal después de completar cada sub-trayectoria.</p>
<ul>
<li>Por otro lado, la actividad <code><a href="https://r-simmer.org/reference/clone.html">clone()</a></code> genera n ramas paralelas (clonadas) y replica la llegada n-1 veces, colocando cada una de ellas en las n sub-trayectorias creadas.
<code><a href="https://r-simmer.org/reference/clone.html">clone()</a></code> es la única actividad de sub-trayectorias que no acepta un parámetro <em>continue</em>.
Por defecto todos los clones continúan en la trayectoria principal después de esta actividad.
Para borrar todos los clones excepto uno, se utiliza la actividad <code><a href="https://r-simmer.org/reference/clone.html">synchronize()</a></code>.</li>
</ul>
<!-- --><pre><code>branch(.trj, option, continue, ...)
clone(.trj, n, ...)
synchronize(.trj, wait = TRUE, mon_all = FALSE)</code></pre>
<p>En el ejemplo a continuación simulamos un juego en el que el jugador lanza una moneda.
Si llega durante la primera hora (<em>now(env)=1</em>), gana un caramelo y se va, y si no, pierde dos caramelos que ha de regalar a María y a José.</p>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">traj</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/branch.html">branch</a></span><span class="op">(</span>
    option<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://r-simmer.org/reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>, continue<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>, <span class="co">#si 1 la 1ª trayectoria y se va; si 2 la 2ª trayectoria y sigue</span>
      <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_name</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="st">"Ha llegado el instante"</span>,<span class="fu"><a href="https://r-simmer.org/reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="st">", gana un caramelo y se va."</span><span class="op">)</span><span class="op">)</span>, 
      <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_name</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="st">"Ha llegado el instante"</span>,<span class="fu"><a href="https://r-simmer.org/reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="st">"y regala dos caramelos"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-simmer.org/reference/clone.html">clone</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, 
    <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"uno a María"</span><span class="op">)</span>, 
    <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"otro a José"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="https://r-simmer.org/reference/clone.html">synchronize</a></span><span class="op">(</span><span class="op">)</span> 
  
<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"Jugador"</span>,<span class="va">traj</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<pre><code>## 1: Jugador0: Jugador0 Ha llegado el instante 1 , gana un caramelo y se va.
## 2: Jugador1: Jugador1 Ha llegado el instante 2 y regala dos caramelos
## 2: Jugador1: uno a María
## 2: Jugador1: otro a José</code></pre>
</div>
<div id="bucles" class="section level2" number="7.14">
<h2>
<span class="header-section-number">7.14</span> Bucles<a class="anchor" aria-label="anchor" href="#bucles"><i class="fas fa-link"></i></a>
</h2>
<p>Hay un comando llamado <code><a href="https://r-simmer.org/reference/rollback.html">rollback()</a></code> útil para moverse hacia atrás en una trayectoria y ejecutar bucles sobre una serie de actividades.
Esta actividad provoca que la llegada retroceda un cierto número de actividades <em>amount</em> (que pueden ser dinámicas) un cierto número de veces <em>times</em>.
Si se utiliza una función de chequeo <em>check</em>, el parámetro <em>times</em> es ignorado y la llegada determina si debe retroceder cada vez que choca con <em>rollback</em>.</p>
<pre><code>rollback(.trj, amount, times = Inf, check = NULL)</code></pre>
<p>En el siguiente ejemplo, un jugador accede a un reto de resistencia en el que ha de levantar pesas y mantenerlas.
Por cada 5 minutos que aguante, recibirá una recompensa de 25€.
El jugador es capaz de aguantar 30 minutos, pero la máxima recompensa a recibir es de 100€, por lo que se detendrá cuando consiga a esa cantidad.</p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"var"</span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Tiempo de resistencia:"</span>,<span class="fu"><a href="https://r-simmer.org/reference/now.html">now</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="st">". Ganancia="</span>, <span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"var"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/set_attribute.html">set_attribute</a></span><span class="op">(</span><span class="st">"var"</span>, <span class="fl">25</span>, mod<span class="op">=</span><span class="st">"+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/rollback.html">rollback</a></span><span class="op">(</span><span class="fl">3</span>, check<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://r-simmer.org/reference/get_n_generated.html">get_attribute</a></span><span class="op">(</span><span class="va">env</span>, <span class="st">"var"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">100</span><span class="op">)</span> 

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"dummy"</span>, <span class="va">traj</span>, <span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">invisible</span></code></pre></div>
<pre><code>## 0: dummy0: Tiempo de resistencia: 0 . Ganancia= 0
## 5: dummy0: Tiempo de resistencia: 5 . Ganancia= 25
## 10: dummy0: Tiempo de resistencia: 10 . Ganancia= 50
## 15: dummy0: Tiempo de resistencia: 15 . Ganancia= 75
## 20: dummy0: Tiempo de resistencia: 20 . Ganancia= 100</code></pre>
</div>
<div id="ejecución-en-lotes" class="section level2" number="7.15">
<h2>
<span class="header-section-number">7.15</span> Ejecución en lotes<a class="anchor" aria-label="anchor" href="#ejecuci%C3%B3n-en-lotes"><i class="fas fa-link"></i></a>
</h2>
<p>La ejecución en lotes o <em>batching</em> consiste en acumular varias llegadas antes de que puedan continuar su camino en la trayectoria de modo unitario.
Esto significa, por ejemplo, que si 10 llegadas en un lote intenta acceder a una unidad de cierto recurso, sólo una unidad puede ser asignada, y no las 10.
Un lote se puede descomponer con <code><a href="https://r-simmer.org/reference/batch.html">separate()</a></code>, salvo que se marque como <code>permanent=TRUE</code>.</p>
<p>Por defecto todas las llegadas que acceden a un lote se juntan en él, y esperan hasta que se consigue el número esperado de llegadas <em>n</em>.
Sin embargo, las llegadas pueden evitar unirse al lote bajo alguna restricción si se proporciona una función booleana opcional, <em>rule</em>.
También un lote se puede agrupar para acceder a un recurso antes de acumular el tamaño del lote, si se especifica un tiempo límite para acceder con <em>timeout</em>.
Los lotes se comparten sólo por llegadas que se añaden a la misma trayectoria directamente.
Siempre que se necesite un lote compartido globalmente, se ha de especificar un nombre con <em>name</em>.</p>
<pre><code>batch(.trj, n, timeout = 0, permanent = FALSE, name = "", rule = NULL)
separate(.trj)</code></pre>
<p>Un ejemplo de sistema en el que puede tener sentido la ejecución por lotes es la visita guiada a un museo, en la que son precisos 5 visitantes para asignar un guía e iniciar la visita.
Si en 10 minutos no se han conseguido los visitantes, se iniciará la visita igualmente con los visitantes disponibles.
La visita dura 5 minutos y, puesto que hay un único guía, será preciso esperar a su finalización para empezar la siguiente.
Los tiempos entre llegadas provienen de una distribución exponencial de media 5.</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">visita</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/batch.html">batch</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">5</span>,timeout<span class="op">=</span><span class="fl">10</span>,name<span class="op">=</span><span class="st">"visitaguiada"</span>,permanent<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"guia"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Comienza la visita con el guía"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"guia"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Visita terminada"</span><span class="op">)</span> 
  

<span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"guia"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"visitante"</span>, <span class="va">visita</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">50</span><span class="op">)</span> </code></pre></div>
<pre><code>## simmer environment: anonymous | now: 0 | next: 0
## { Monitor: in memory }
## { Resource: guia | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
## { Source: visitante | monitored: 1 | n_generated: 0 }
## 14.3965: batch_visitaguiada: Comienza la visita con el guía
## 19.3965: batch_visitaguiada: Visita terminada
## 25.0774: batch_visitaguiada: Comienza la visita con el guía
## 30.0774: batch_visitaguiada: Visita terminada
## 39.3721: batch_visitaguiada: Comienza la visita con el guía
## 44.3721: batch_visitaguiada: Visita terminada</code></pre>
<pre><code>## simmer environment: anonymous | now: 50 | next: 52.8456166019689
## { Monitor: in memory }
## { Resource: guia | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
## { Source: visitante | monitored: 1 | n_generated: 11 }</code></pre>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></code></pre></div>
<pre><code>##         name start_time end_time activity_time finished replication
## 1 visitante0   4.396467 19.39647             5     TRUE           1
## 2 visitante1   9.535182 19.39647             5     TRUE           1
## 3 visitante2  15.077402 30.07740             5     TRUE           1
## 4 visitante3  18.904553 30.07740             5     TRUE           1
## 5 visitante4  24.119116 30.07740             5     TRUE           1
## 6 visitante5  29.372144 44.37214             5     TRUE           1
## 7 visitante6  34.084774 44.37214             5     TRUE           1
## 8 visitante7  38.811458 44.37214             5     TRUE           1</code></pre>
</div>
<div id="programación-asíncrona" class="section level2" number="7.16">
<h2>
<span class="header-section-number">7.16</span> Programación asíncrona<a class="anchor" aria-label="anchor" href="#programaci%C3%B3n-as%C3%ADncrona"><i class="fas fa-link"></i></a>
</h2>
<p>Hay ciertos métodos que permiten eventos asíncronos:</p>
<ul>
<li><p>La actividad <code><a href="https://r-simmer.org/reference/send.html">send()</a></code> emite una o más señales (<em>signals</em>) a todas las llegadas que se suscriben a ellas.
Las señales se pueden desencadenar inmediatamente o después de cierto retraso (<em>delay</em>).
En ese caso, los dos parámetros, <em>signals</em> y <em>delay</em>, pueden ser dinámicos.</p></li>
<li><p>Las llegadas pueden bloquearse y esperar con <code><a href="https://r-simmer.org/reference/send.html">wait()</a></code> hasta que se recibe cierta señal.</p></li>
<li><p>Con <code><a href="https://r-simmer.org/reference/send.html">trap()</a></code> las llegadas pueden suscribirse a señales (<em>signals</em>) y (opcionalmente) asignar un manipulador (de señales) <em>handler</em>.
Si se proporciona el <em>handler</em>, la llegada detiene la atividad actual hasta que recibe la señal.
Después, la actividad continúa desde el punto de interrupción.
Sin embargo, si la llegada está esperando en un recurso de cola, las señales atrapadas se ignoran.
Lo mismo ocurre con un lote: todas las señales suscritas antes de entrar a un lote son ignoradas.</p></li>
<li><p>Finalmente la actividad <code><a href="https://r-simmer.org/reference/send.html">untrap()</a></code>se puede utilizar para cancelar la suscripción a <em>signals</em>.</p></li>
</ul>
<!-- --><pre><code>send(.trj, signals, delay = 0)
wait(.trj)
trap(.trj, signals, handler = NULL, interruptible = TRUE)
untrap(.trj, signals)</code></pre>
<p>Por defecto los manipuladores de señales (<em>signal handlers</em>) pueden ser interrumpidos también por otras señales, lo que significa que un manipulador (<em>handler</em>) puede permanecer reiniciándose si se están emitiendo suficientes señales.
Si se necesita un manipulador que no pueda ser interrumpido, hay que utilizar el parámetro <code>interruptible=FALSE</code> en <code><a href="https://r-simmer.org/reference/send.html">trap()</a></code>.</p>
<p>En el ejemplo a continuación, una inteligencia artificial reclama una clave de acceso al usuario para desbloquear un recurso digital y permitirle el acceso.
El usuario proporciona la clave de acceso al cabo de 5 segundos.
La IA recibe la clave y desbloquea el recurso.</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ia.acceso</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Solicito clave de acceso"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/send.html">trap</a></span><span class="op">(</span><span class="st">"clave"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/send.html">wait</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Clave recibida y acceso permitido"</span><span class="op">)</span>

<span class="va">usuario</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Clave enviada"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/send.html">send</a></span><span class="op">(</span><span class="st">"clave"</span><span class="op">)</span> 
  
<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"ia.acceso"</span>,<span class="va">ia.acceso</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"usuario"</span>,<span class="va">usuario</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<pre><code>## 0: ia.acceso0: Solicito clave de acceso
## 5: usuario0: Clave enviada
## 5: ia.acceso0: Clave recibida y acceso permitido</code></pre>
</div>
<div id="renuncias" class="section level2" number="7.17">
<h2>
<span class="header-section-number">7.17</span> Renuncias<a class="anchor" aria-label="anchor" href="#renuncias"><i class="fas fa-link"></i></a>
</h2>
<p>Además de ser rechazadas cuando tratan de acceder a un recurso, las llegadas pueden dejar una trayectoria en cualquier momento, síncrona o asíncronamente.
En principio, renunciar significa que una llegada abandona la trayectoria en un momento dado.
La actividad más simple que permite esto es <code><a href="https://r-simmer.org/reference/renege.html">leave()</a></code>, que inmediatamente desencadena la acción dada alguna probabilidad.
Además, <code><a href="https://r-simmer.org/reference/renege.html">renege_in()</a></code> y <code><a href="https://r-simmer.org/reference/renege.html">renege_if()</a></code> desencadena la renuncia asíncronamente después de algún tiempo <em>timeout=t</em> o si se recibe una señal, respectivamente, salvo que la acción sea abortada con <code><a href="https://r-simmer.org/reference/renege.html">renege_abort()</a></code>.
Los dos métodos <code><a href="https://r-simmer.org/reference/renege.html">renege_in()</a></code> y <code><a href="https://r-simmer.org/reference/renege.html">renege_if()</a></code> aceptan una subtrayectoria opcional, <em>out</em>, que se ejecuta directamente antes de abandonar la trayectoria.</p>
<pre><code>leave(.trj, prob, out = NULL, keep_seized = TRUE)
renege_in(.trj, t, out = NULL, keep_seized = FALSE)
renege_if(.trj, signal, out = NULL, keep_seized = FALSE)
renege_abort(.trj)</code></pre>
<p>En el ejemplo siguiente los clientes llegan a un banco con un solo empleado, del que se</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">banco</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"He llegado al banco"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># se marcha si no es atendido en 5 minutos</span>
  <span class="fu"><a href="https://r-simmer.org/reference/renege.html">renege_in</a></span><span class="op">(</span>
    <span class="fl">5</span>,
    out<span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"He colmado mi paciencia. Me voy..."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"empleado"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co"># me quedo si soy atendido en 5 minutos</span>
  <span class="fu"><a href="https://r-simmer.org/reference/renege.html">renege_abort</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"Me están atendiendo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"empleado"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/log_.html">log_</a></span><span class="op">(</span><span class="st">"He terminado"</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"empleado"</span>,<span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>,<span class="va">banco</span>,<span class="fu"><a href="https://r-simmer.org/reference/generators.html">at</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<pre><code>## 0: cliente0: He llegado al banco
## 0: cliente0: Me están atendiendo
## 1: cliente1: He llegado al banco
## 6: cliente1: He colmado mi paciencia. Me voy...
## 10: cliente0: He terminado</code></pre>
</div>
<div id="ejemplos" class="section level2" number="7.18">
<h2>
<span class="header-section-number">7.18</span> Ejemplos<a class="anchor" aria-label="anchor" href="#ejemplos"><i class="fas fa-link"></i></a>
</h2>
<p>El concepto de trayectoria desarrollado en <code>simmer</code> da lugar a un modo natural de simular una amplia variedad de problemas relacionados con Cadenas de Markov continuas en el tiempo (CTMC), procesos de nacimiento-muerte y sistemas de colas.</p>
<div id="proceso-industrial" class="section level3" number="7.18.1">
<h3>
<span class="header-section-number">7.18.1</span> Proceso industrial<a class="anchor" aria-label="anchor" href="#proceso-industrial"><i class="fas fa-link"></i></a>
</h3>
<p>Utilizamos la ilustración de un proceso industrial de Pidd (1988), Section 5.3.1, base de la introducción del artículo de Ucar et al (2019), en el que describe de modo completo la simulación del proceso con <code>simmer</code>, y que traducimos y comentamos a continuación.</p>
<p>Consideramos un negocio de trabajos de ingeniería, en la que hay varias máquinas idénticas.
Cada máquina es capaz de procesar cualquier trabajo que llegue.
Hay un suministro de trabajos sin perspectivas de escasez.
Los trabajos se asignan a la primera máquina disponible.
El tiempo en completar un trabajo es variable, pero depende de la máquina que se utilice.
Las máquinas están a cargo de los operarios, que las revisa y realizan una serie de tareas sobre ellas.</p>
<p>El proceso está pues constituido por dos tipos de recursos:</p>
<ul>
<li>máquinas, a las que llegan trabajos (jobs)</li>
<li>operarios, a los que llegan tareas (tasks)</li>
</ul>
<p>Respecto a cómo ocupan su tiempo de operatividad, distinguimos entre <strong>estados</strong> y <strong>actividades</strong>.
Estas últimas se refieren a tareas que conllevan cierto tiempo para ser completadas.
En la Figura</p>
<p>Las actividades que realizan los operarios son:</p>
<ul>
<li>RESET: resetear/reinicializar la máquina, si no muestra desgaste que afecte a su funcionalidad</li>
<li>RETOOL: reparar la máguina si aprecia algún desgaste que afecta al funcionamiento. Después de una reparación (RETOOL) y antes de reiniciar el trabajo, toda máquina ha de ser reinicializada (RESET).</li>
<li>AWAY: salir un rato para atender sus necesidades personales.</li>
</ul>
<p>La actividad que llevan a cabo las máquinas es la propia realización del trabajo (RUNNING).</p>
<p>Se pueden identificar dos clases de procesos o fuentes de llegadas, que generan:</p>
<ul>
<li>los <em>trabajos de tienda</em> (shop jobs), que usan las máquinas y las desgastan,</li>
<li>las <em>tareas personales</em> que realizan los operarios que se ausentan (AWAY).</li>
</ul>
<p>En la Figura 1 está representado el flujo de trabajo de este sistema basado en máquinas (a la izquierda) y operarios (a la derecha).
En círculos los estados posibles de los recursos y en rectángulos las actividades a completar.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:job-cycle"></span>
<img src="images/job-cycle.png" alt="Figura 1. Ciclo de trabajo del sistema descrito en Pidd (1988)" width="80%"><p class="caption">
Figura 7.3: Figura 1. Ciclo de trabajo del sistema descrito en Pidd (1988)
</p>
</div>
<p>La forma de simular este sistema con <code>simmer</code> consiste en considerar las máquinas y operarios como recursos y describir como trayectorias los ciclos de los trabajos de tienda y de las tareas personales.</p>
<p>En primer lugar inicializamos un nuevo entorno de simulación y definimos el tiempo de compleción de las diferentes actividades, que vamos a definir según distribuciones exponenciales.
Asímismo, se definen los tiempos entre llegadas para los trabajos y las tareas, con NEW_JOB y NEW_TASK respectivamente.
Consideraremos también una probabilidad 0.2 para que una máquina haya de ser reparada después de hacer un trabajo (CHECK_WORN).</p>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inicializamos una semilla para reproducir siempre las mismas simulaciones</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="co"># e inicializamos el entorno de simulación</span>
<span class="va">env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="st">"JobShop"</span><span class="op">)</span>

<span class="co"># Definimos cómo se simularán los tiempos de las actividades</span>
<span class="va">RUNNING</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">RETOOL</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>
<span class="va">RESET</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>
<span class="va">AWAY</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="co"># chequeo de desgaste y necesidad de reparación</span>
<span class="va">CHECK_WORN</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.2</span> <span class="co"># da FALSE/TRUE</span>
<span class="co"># y las llegadas de trabajos y tareas personales</span>
<span class="va">NEW_JOB</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>
<span class="va">NEW_TASK</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>La trayectoria de un trabajo (‘job’) que llega a la tienda, empieza por ocupar (seize) una máquina que está preparada (estado READY).
La máquina opera durante cierto tiempo aleatorio (RUNNING) en el que está resolviendo un trabajo.
Cuando la máquina finaliza este tiempo, se chequea (CHECK_WORN) para comprobar si hay que cambiar piezas o no.
El chequeo se realiza a través de una ramificación en la que si hay que reparar (con probabilidad 0.2), la máquina accede a la reparación que lleva a cabo el operario durante un tiempo RETOOL; si no, continua con la reinicialización durante un tiempo RESET, también desarrollada por el operario.
Finaliza el servicio con la compleción del trabajo del operario y del trabajo de la máquina.</p>
<p>Por otro lado, las tareas personales que realizan los operadores, los mantienen ocupados durante un tiempo AWAY.</p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">job</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"máquina"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">RUNNING</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/branch.html">branch</a></span><span class="op">(</span>
    <span class="va">CHECK_WORN</span>, continue<span class="op">=</span><span class="cn">TRUE</span>, 
      <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">RETOOL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">RESET</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"máquina"</span><span class="op">)</span>

<span class="va">task</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="va">AWAY</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"operario"</span><span class="op">)</span></code></pre></div>
<p>Una vez que han sido definidas las trayectorias de los procesos, de las máquinas y de los operarios, dimensionamos el sistema con 10 máquinas idénticas y 5 operarios, y creamos también un generador de trabajos (jobs) y otro de tareas personales (tasks).
Dejamos correr el sistema durante 1000 unidades de tiempo.</p>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"máquina"</span>,<span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"operario"</span>,<span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"job"</span>,<span class="va">job</span>,<span class="va">NEW_JOB</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"task"</span>,<span class="va">task</span>,<span class="va">NEW_TASK</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">invisible</span></code></pre></div>
<p>El simulador monitoriza en pantalla todos los cambios de estado y tiempos de vida de todos los procesos, lo que nos permite realizar cualquier tipo de análisis sin demasiado esfuerzo adicional.
Por ejemplo, podríamos extraer el histórico de los estados de los recursos para analizar el número medio de máquinas/operarios utilizados, así como el número de trabajos/tareas esperando ser asignados.</p>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">server</span>,<span class="va">queue</span><span class="op">)</span><span class="op">~</span><span class="va">resource</span>, <span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span>,<span class="va">mean</span><span class="op">)</span></code></pre></div>
<pre><code>##   resource   server     queue
## 1  máquina 7.987438 1.0355590
## 2 operario 3.505732 0.4441298</code></pre>
</div>
<div id="sistemas-de-colas" class="section level3" number="7.18.2">
<h3>
<span class="header-section-number">7.18.2</span> Sistemas de colas<a class="anchor" aria-label="anchor" href="#sistemas-de-colas"><i class="fas fa-link"></i></a>
</h3>
<p>Veamos cómo implementar con <code>simmer</code> una cola M/M/1 según el ejemplo mostrado en <a href="https://www.r-bloggers.com/2016/04/simulating-queueing-systems-with-simmer/">FishyOperations, 2016</a>.
Las viñetas de simmer incluyen más ejemplos de sistemas M/M/c/k (<a href="https://r-simmer.org/articles/simmer-06-queueing.html">Ucar, 2020a</a>), redes de colas y modelos de Markov de tiempo continuo CTMC (<a href="https://r-simmer.org/articles/simmer-07-ctmc.html">Ucar, 2020b</a>).</p>
<p>En la notación de Kendall (Kendall, 1953), un sistema M/M/1 tiene una distribución de llegadas exponencial con media <span class="math inline">\(\lambda\)</span>, (<strong>M</strong>/M/1), un único servidor (M/M/<strong>1</strong>), y un tiempo de servicio exponencial de media <span class="math inline">\(\mu\)</span>, (M/<strong>M</strong>/1).
Por ejemplo, la gente llega a un cajero automático aproximadamente cada <span class="math inline">\(\lambda\)</span> minutos, espera su turno en la calle y saca dinero durante aproximadamente <span class="math inline">\(\mu\)</span> minutos.
Se definen entonces los parámetros básicos del sistema cuando <span class="math inline">\(\rho&lt;1\)</span> (para que no se sature el sistema):</p>
<ul>
<li>utilización del servidor, <span class="math inline">\(\rho=\lambda/\mu\)</span>
</li>
<li>promedio de clientes en el sistema (cola y cajero), <span class="math inline">\(N=\rho/(1-\rho)\)</span>
</li>
<li>tiempo medio en el sistema (ley de Little), <span class="math inline">\(T=N/\lambda\)</span>.</li>
</ul>
<p>Si <span class="math inline">\(\rho&gt;1\)</span>, el sistema es inestable pues hay más llegadas de las que el servidor es capaz de gestionar y la cola crecerá indefinidamente.</p>
<p>La simulación de este sistema con simmer es muy sencilla.</p>
<div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">lambda</span><span class="op">=</span><span class="fl">2</span>
<span class="va">mu</span><span class="op">=</span><span class="fl">4</span>
<span class="va">rho</span><span class="op">=</span><span class="va">lambda</span><span class="op">/</span><span class="va">mu</span>

<span class="va">mm1.cajero</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"cajero"</span>,amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"cajero"</span>,amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">mm1.env</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"cajero"</span>,capacity<span class="op">=</span><span class="fl">1</span>,queue_size<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>,<span class="va">mm1.cajero</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">2000</span><span class="op">)</span> </code></pre></div>
<p>Después de la especificación de los parámetros (<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\mu\)</span>), el primer bloque de código define la trayectoria: cada llegada será asignada al recurso, sacará dinero durante un tiempo variable que responderá a una distribución exponencial con media <span class="math inline">\(\mu\)</span> y dejará el cajero.</p>
<p>El segundo bloque de código hace una instancia al entorno de simulación, crea el recurso, define el generador de llegadas de clientes y lanza la simulación durante 2000 unidades de tiempo.</p>
<p>A continuación visualizamos los datos simulados de funcionamiento del sistema.
En el primer gráfico, la evolución temporal de los recursos: cola y servidor.
En el segundo gráfico el tiempo de espera a lo largo del periodo de simulación, y en el tercer gráfico el tiempo de servicio a lo largo del periodo de simulación.</p>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resources</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">mm1.env</span><span class="op">)</span>
<span class="va">arrivals</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">mm1.env</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resources</span>, metric<span class="op">=</span><span class="st">"usage"</span>, <span class="st">"cajero"</span>, items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"server"</span>,<span class="st">"queue"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-35-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">arrivals</span>, metric<span class="op">=</span><span class="st">"waiting_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-35-2.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">arrivals</span>, metric<span class="op">=</span><span class="st">"activity_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-35-3.png" width="95%" style="display: block; margin: auto;"></div>
<p>Si queremos inferir sobre el funcionamiento del sistema a largo plazo, necesitaremos muestras, obtenidas de varias réplicas.
La replicación es recomendable llevarla a cabo con la librería <em>parallel</em>, que permite lanzar en paralelo varias réplicas simultáneas.</p>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#library(parallel)</span>
<span class="va">mm1.envs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span> 
     <span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"cajero"</span>,capacity<span class="op">=</span><span class="fl">1</span>,queue_size<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"cliente"</span>,<span class="va">mm1.cajero</span>,<span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">100</span>,<span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="fl">1000</span><span class="op">/</span><span class="va">lambda</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
       <span class="fu"><a href="https://r-simmer.org/reference/wrap.html">wrap</a></span><span class="op">(</span><span class="op">)</span>
     <span class="op">}</span>, mc.set.seed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Al recuperar las llegadas con <code>get_mon_arrivals</code>, obtenemos un data.frame con todas las llegadas, el instante de llegada (<em>start_time</em>) y salida (<em>end_time</em>), así como el tiempo en servicio -sin contar espera- (<em>activity_time</em>), un indicador de si ha finalizado la actividad (<em>finished</em>) y un índice de replicación (<em>replication</em>).</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm1.arrivals</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">mm1.envs</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mm1.arrivals</span><span class="op">)</span></code></pre></div>
<pre><code>##       name start_time  end_time activity_time finished replication
## 1 cliente0  0.3373840 0.3988817    0.06149772     TRUE           1
## 2 cliente1  0.8873295 1.0936262    0.20629668     TRUE           1
## 3 cliente2  1.0175261 1.3095587    0.21593254     TRUE           1
## 4 cliente3  1.2768201 1.7538044    0.44424568     TRUE           1
## 5 cliente4  1.6875986 1.9712527    0.21744829     TRUE           1
## 6 cliente5  1.8805297 2.1871458    0.21589316     TRUE           1</code></pre>
<p>Con varias réplicas podríamos, por ejemplo, calcular el tiempo medio en el sistema (<em>end_time-start_time</em>), y con todas las medias, testar si el tiempo medio es superior o inferior a cualquier valor que marquemos, utilizando en este caso un test t-Student:</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm1.data</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">mm1.envs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">end_time</span><span class="op">-</span><span class="va">start_time</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mm1.data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">replication</span>,y<span class="op">=</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-38-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mm1.data</span><span class="op">$</span><span class="va">m</span>,mu<span class="op">=</span><span class="fl">0.5</span>,alternative <span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  mm1.data$m
## t = -0.51444, df = 99, p-value = 0.696
## alternative hypothesis: true mean is greater than 0.5
## 95 percent confidence interval:
##  0.4906473       Inf
## sample estimates:
## mean of x 
## 0.4977877</code></pre>
<p>O estudiar la utilización de los recursos,</p>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm1.resources</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">mm1.envs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mm1.resources</span>, metric<span class="op">=</span><span class="st">"utilization"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-39-1.png" width="95%" style="display: block; margin: auto;"></div>
<p>O incluso testar si el tamaño de la cola (o de sujetos en el sistema) ha sido cero (o cualquier otro valor),</p>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm1.data</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">mm1.envs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n.cola<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">queue</span><span class="op">)</span>,n.sistema<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">system</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mm1.data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">replication</span>,y<span class="op">=</span><span class="va">n.cola</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">n.sistema</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">n.sistema</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Replicación"</span>,y<span class="op">=</span><span class="st">"Usuarios"</span>,caption<span class="op">=</span><span class="st">"Figura x. Usuarios en cola (negro) y en el sistema (azul)."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-40-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mm1.data</span><span class="op">$</span><span class="va">n.cola</span>,mu<span class="op">=</span><span class="fl">0</span>,alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  mm1.data$n.cola
## t = 72.742, df = 99, p-value &lt; 2.2e-16
## alternative hypothesis: true mean is greater than 0
## 95 percent confidence interval:
##  0.7300316       Inf
## sample estimates:
## mean of x 
## 0.7470844</code></pre>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mm1.data</span><span class="op">$</span><span class="va">n.sistema</span>,mu<span class="op">=</span><span class="fl">1</span>,alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  mm1.data$n.sistema
## t = 44.214, df = 99, p-value &lt; 2.2e-16
## alternative hypothesis: true mean is greater than 1
## 95 percent confidence interval:
##  1.477677      Inf
## sample estimates:
## mean of x 
##  1.496315</code></pre>
</div>
<div id="gasolinera" class="section level3" number="7.18.3">
<h3>
<span class="header-section-number">7.18.3</span> Gasolinera<a class="anchor" aria-label="anchor" href="#gasolinera"><i class="fas fa-link"></i></a>
</h3>
<p>El ejemplo de la gasolinera es ofrecido en <a href="https://r-simmer.org/articles/simmer-07-ctmc.html">Ucar (2020b)</a> como una ejemplificación de un proceso de cadena de markov continuo en el tiempo.
Una gasolinera tiene un único surtidor y no dispone de espacio de espera para los vehículos (si un vehículo llega mientras otro está utilizando el surtidor, ha de marcharse).
Los vehículos llegan a la gasolinera según un proceso de Poisson de razón <span class="math inline">\(\lambda=3/20\)</span> vehículos por minuto.
De los vehículos que llegan, el 75% son coches y el resto motocicletas.
El tiempo de carga de combustible responde a una distribución exponencial con media 8 minutos para los coches y 3 para las motocicletas.</p>
<p>Recordemos que un proceso de Poisson de parámetro <span class="math inline">\(\lambda\)</span> implica una distribución de Poisson <span class="math inline">\(Po(\lambda t)\)</span> para el número de usuarios del sistema transcurrido un tiempo <span class="math inline">\(t\)</span> y una distribución <span class="math inline">\(Exp(\lambda)\)</span> para los tiempos entre llegadas de los usuarios.</p>
<p>Puesto que se trata de un proceso continuo en el tiempo, definimos una función que ejecuta el proceso hasta un instante <span class="math inline">\(t\)</span>.
El único surtidor de la gasolinera constituye el recurso del proceso, con capacidad 1 y tamaño de la cola 0, y las llegadas de vehículos se generan según una distribución <span class="math inline">\(Exp(\lambda)\)</span>.
Al producirse una llegada, se deriva al surtidor, especificando <code>amount=1</code> para provocar que si está ocupado, el vehículo se marcha (es rechazado).
Puesto que el tiempo de recarga de combustible depende de si el vehículo es coche o motocicleta, y estos llegan en una proporción 3 a 1 (75% coches-25% motos), el tiempo de permanencia en el surtidor especificado con <code>timeout</code> se genera con probabilidad 0.75 con una <span class="math inline">\(Exp(1/8)\)</span> y con probabilidad 0.25 con una <span class="math inline">\(Exp(1/3)\)</span>.
Transcurrido ese tiempo, el vehículo abandona el sistema.</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">recarga</span><span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">vehiculo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-simmer.org/reference/trajectory.html">trajectory</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">seize</a></span><span class="op">(</span><span class="st">"surtidor"</span>, amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/timeout.html">timeout</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>  <span class="co"># coche</span>
      <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>               <span class="co"># moto</span>
    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/seize.html">release</a></span><span class="op">(</span><span class="st">"surtidor"</span>, amount<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="fu"><a href="https://r-simmer.org/reference/simmer.html">simmer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_resource.html">add_resource</a></span><span class="op">(</span><span class="st">"surtidor"</span>, capacity<span class="op">=</span><span class="fl">1</span>, queue_size<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/add_generator.html">add_generator</a></span><span class="op">(</span><span class="st">"vehiculo"</span>, <span class="va">vehiculo</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://r-simmer.org/reference/run.html">run</a></span><span class="op">(</span>until<span class="op">=</span><span class="va">t</span><span class="op">)</span>
 <span class="op">}</span></code></pre></div>
<p>Definiendo los valores de los parámetros, hacemos correr el sistema hasta el instante <span class="math inline">\(t=5000\)</span>, y visualizamos llegadas y recurso.</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">=</span><span class="fl">5000</span>
<span class="va">lambda</span><span class="op">=</span><span class="fl">3</span><span class="op">/</span><span class="fl">20</span>
<span class="va">mu</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">8</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>
<span class="va">p</span><span class="op">=</span><span class="fl">0.75</span>
 
<span class="va">gasolinera</span><span class="op">=</span><span class="fu">recarga</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> 
<span class="va">llegadas</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_arrivals</a></span><span class="op">(</span><span class="va">gasolinera</span><span class="op">)</span>
<span class="va">surtidor</span><span class="op">=</span><span class="fu"><a href="https://r-simmer.org/reference/get_mon.html">get_mon_resources</a></span><span class="op">(</span><span class="va">gasolinera</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">llegadas</span>, metric<span class="op">=</span><span class="st">"activity_time"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-42-1.png" width="95%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">surtidor</span>, <span class="st">"usage"</span>,<span class="st">"surtidor"</span>,items<span class="op">=</span><span class="st">"system"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="07-simmer_files/figure-html/unnamed-chunk-42-2.png" width="95%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="referencias" class="section level2" number="7.19">
<h2>
<span class="header-section-number">7.19</span> Referencias<a class="anchor" aria-label="anchor" href="#referencias"><i class="fas fa-link"></i></a>
</h2>
<p>Bache SM, Wickham H (2014).
magrittr: A Forward-Pipe Operator for R.
R package version 1.5.
Available at <a href="https://CRAN.R-project.org/package=magrittr" class="uri">https://CRAN.R-project.org/package=magrittr</a>.</p>
<p>Banks J (2005).
Discrete-Event System Simulation.
Prentice-Hall International Series in Industrial and Systems Engineering.
Pearson Prentice Hall.</p>
<p>Canadilla, P. (2019).
Analysis of Queueing Networks and Models.
Package ‘queueing.’
Available at <a href="https://cran.r-project.org/web/packages/queueing/" class="uri">https://cran.r-project.org/web/packages/queueing/</a>.</p>
<p>Chubaty AM, McIntire EJB (2019).
SpaDES: Develop and Run Spatially Explicit Discrete Event Simulation Models.
R package version 2.0.3.
Available at <a href="https://CRAN.R-project.org/package=SpaDES" class="uri">https://CRAN.R-project.org/package=SpaDES</a>.</p>
<p>Ebert A (2018).
queuecomputer: Computationally Efficient Queue Simulation.
R package version 0.8.3.
Available at <a href="https://CRAN.R-project.org/package=queuecomputer" class="uri">https://CRAN.R-project.org/package=queuecomputer</a>.</p>
<p>Ebert A, Wu P, Mengersen K, Ruggeri F (2017).
Computationally Efficient Simulation of Queues: The R Package queuecomputer.” arXiv:1703.02151. ArXiv.org E-Print Archive. Available at <a href="http://arxiv.org/abs/1703.02151" class="uri">http://arxiv.org/abs/1703.02151</a>.</p>
<p>FishyOperations in R-Bloggers (2016).
Simulating queueing systems with simmer.
Available at <a href="https://www.r-bloggers.com/2016/04/simulating-queueing-systems-with-simmer/" class="uri">https://www.r-bloggers.com/2016/04/simulating-queueing-systems-with-simmer/</a>.</p>
<p>Kendall DG (1953).
Stochastic Processes Occurring in the Theory of Queues and their Analysis by the Method of the Imbedded Markov Chain.” The Annals of Mathematical Statistics, 24(3), 338-354. Available at <a href="https://doi.org/10.1214/aoms/1177728975" class="uri">https://doi.org/10.1214/aoms/1177728975</a>.</p>
<p>Lauwens B (2017).
SimJulia.jl: Combined Continuous-Time / Discrete-Event Process Ori-ented Simulation Framework Written in Julia.
Julia package version 0.5.
Available at <a href="https://github.com/BenLauwens/SimJulia.jl" class="uri">https://github.com/BenLauwens/SimJulia.jl</a>.</p>
<p>Law AM, Kelton WD (2000).
Simulation Modeling and Analysis.
McGraw-Hill Series in Industrial Engineering and Management Science.
McGraw-Hill.</p>
<p>Pidd M (1988).
Computer Simulation in Management Science.
John Wiley &amp; Sons.</p>
<p>Shannon RE (1975).
Systems Simulation: The Art and Science.
Prentice-Hall.</p>
<p>Team SimPy (2017).
SimPy: Discrete-Event Simulation for Python.
Python package version 3.0.9.
Available at <a href="https://simpy.readthedocs.io/en/stable" class="uri">https://simpy.readthedocs.io/en/stable</a>.</p>
<p>Ucar, I., Smeets, B., Azcorra, A.
(2019).
“simmer: Discrete-Event Simulation for R.” <em>Journal of Statistical Software</em>, <em>90</em>(2), 1-30.
Available at <a href="https://doi.org/10.18637/jss.v090.i02" class="uri">https://doi.org/10.18637/jss.v090.i02</a>.</p>
<p>Ucar, I., Smeets, B.
(2019a).
simmer: Discrete-Event Simulation for R.
R package version 4.3.0.
Available at <a href="https://CRAN.R-project.org/package=simmer" class="uri">https://CRAN.R-project.org/package=simmer</a>.</p>
<p>Ucar, I., Smeets, B.
(2019b).
simmer.plot: Plotting Methods for simmer.
R package version 0.1.15.
Available at <a href="https://CRAN.R-project.org/package=simmer.plot" class="uri">https://CRAN.R-project.org/package=simmer.plot</a>.</p>
<p>Ucar, I., Smeets, B.
(2020c) simmer: DES for R.
Available at <a href="https://r-simmer.org/" class="uri">https://r-simmer.org/</a>.
Documentation is available at <a href="https://r-simmer.org/reference/" class="uri">https://r-simmer.org/reference/</a>.</p>
<p>Ucar, I.
(2020a).
Queueing systems, in simmer: DES for R.
Available at <a href="https://r-simmer.org/articles/simmer-06-queueing.html" class="uri">https://r-simmer.org/articles/simmer-06-queueing.html</a>.</p>
<p>Ucar, I.
(2020b).
Continuous-Time Markov Chains, in simmer: DES for R.
Available at <a href="https://r-simmer.org/articles/simmer-07-ctmc.html" class="uri">https://r-simmer.org/articles/simmer-07-ctmc.html</a>.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="SIMSIST.html"><span class="header-section-number">6</span> Aplicaciones prácticas</a></div>
<div class="next"><a href="bibliograf%C3%ADa.html">Bibliografía</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#simmerunidad"><span class="header-section-number">7</span> Simulación DES con simmer</a></li>
<li><a class="nav-link" href="#simulaci%C3%B3n-1"><span class="header-section-number">7.1</span> Simulación</a></li>
<li><a class="nav-link" href="#simulaci%C3%B3n-des"><span class="header-section-number">7.2</span> Simulación DES</a></li>
<li><a class="nav-link" href="#software-1"><span class="header-section-number">7.3</span> Software</a></li>
<li><a class="nav-link" href="#conceptos-clave"><span class="header-section-number">7.4</span> Conceptos clave</a></li>
<li><a class="nav-link" href="#entornos-y-trayectorias"><span class="header-section-number">7.5</span> Entornos y trayectorias</a></li>
<li><a class="nav-link" href="#monitoreo"><span class="header-section-number">7.6</span> Monitoreo</a></li>
<li><a class="nav-link" href="#fuentes-de-llegadas"><span class="header-section-number">7.7</span> Fuentes de llegadas</a></li>
<li><a class="nav-link" href="#recursos"><span class="header-section-number">7.8</span> Recursos</a></li>
<li><a class="nav-link" href="#acciones"><span class="header-section-number">7.9</span> Acciones</a></li>
<li><a class="nav-link" href="#atributos"><span class="header-section-number">7.10</span> Atributos</a></li>
<li><a class="nav-link" href="#interacci%C3%B3n-con-recursos"><span class="header-section-number">7.11</span> Interacción con recursos</a></li>
<li><a class="nav-link" href="#interacci%C3%B3n-con-fuentes"><span class="header-section-number">7.12</span> Interacción con fuentes</a></li>
<li><a class="nav-link" href="#ramificaci%C3%B3n"><span class="header-section-number">7.13</span> Ramificación</a></li>
<li><a class="nav-link" href="#bucles"><span class="header-section-number">7.14</span> Bucles</a></li>
<li><a class="nav-link" href="#ejecuci%C3%B3n-en-lotes"><span class="header-section-number">7.15</span> Ejecución en lotes</a></li>
<li><a class="nav-link" href="#programaci%C3%B3n-as%C3%ADncrona"><span class="header-section-number">7.16</span> Programación asíncrona</a></li>
<li><a class="nav-link" href="#renuncias"><span class="header-section-number">7.17</span> Renuncias</a></li>
<li>
<a class="nav-link" href="#ejemplos"><span class="header-section-number">7.18</span> Ejemplos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#proceso-industrial"><span class="header-section-number">7.18.1</span> Proceso industrial</a></li>
<li><a class="nav-link" href="#sistemas-de-colas"><span class="header-section-number">7.18.2</span> Sistemas de colas</a></li>
<li><a class="nav-link" href="#gasolinera"><span class="header-section-number">7.18.3</span> Gasolinera</a></li>
</ul>
</li>
<li><a class="nav-link" href="#referencias"><span class="header-section-number">7.19</span> Referencias</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Simulación de Procesos y Sistemas</strong>" was written by true, true. It was last built on 2022-04-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
